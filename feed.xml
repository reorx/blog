<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Reorxâ€™s Forge</title><link>https://reorx.com/</link><description>Recent content on Reorxâ€™s Forge</description><image><url>https://reorx.com/forge.png</url><link>https://reorx.com/forge.png</link></image><generator>Hugo -- gohugo.io</generator><lastBuildDate>Thu, 19 May 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://reorx.com/feed.xml" rel="self" type="application/rss+xml"/><item><title>æ­å»º umami æ”¶é›†ä¸ªäººç½‘ç«™ç»Ÿè®¡æ•°æ®</title><link>https://reorx.com/blog/deploy-umami-for-personal-website/</link><pubDate>Thu, 19 May 2022 00:00:00 +0000</pubDate><guid>https://reorx.com/blog/deploy-umami-for-personal-website/</guid><description>æ•™ä½ å¦‚ä½•å…è´¹æ­å»ºå’Œä½¿ç”¨ç¾ä¸½çš„ umami ç½‘ç«™ç»Ÿè®¡æœåŠ¡ï¼Œå’Œ Google Analytics è¯´å†è§ã€‚</description><content:encoded><![CDATA[<p>è·ç¦»åšå®¢ç¬¬ä¸€ç¯‡æ–‡ç« å‘å¸ƒæ­£å¥½ä¸€ä¸ªæœˆï¼Œæˆ‘æƒ³æŸ¥çœ‹ä¸€ä¸‹ç½‘ç«™çš„ç»Ÿè®¡æ•°æ®ï¼Œåœ¨ Google Analytics ä¸Šæ“ä½œäº†ä¸€ç•ªï¼Œå‘è§‰è‡ªå·±å·²æ— æ³•å¿å—è¿™ä¸ªå¤æ‚ä¸”è¿Ÿç¼“çš„è€æ—§äº§å“ï¼Œè¿™è®©æˆ‘å¼€å§‹æ€è€ƒæœ‰æ²¡æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æˆ‘é¦–å…ˆæƒ³åˆ°çš„æ˜¯åˆ‡æ¢åˆ°å¦ä¸€å®¶ hosting çš„ç½‘ç«™ç»Ÿè®¡æœåŠ¡ï¼Œå¦‚æœå¯ä»¥çš„è¯ï¼Œæœ€å¥½èƒ½æœ‰å…è´¹é¢åº¦ã€‚ç„¶è€Œå¼€å…¬å¸å¹¶ä¸æ˜¯åšæ…ˆå–„ï¼ŒGoogle ä¹‹æ‰€ä»¥å¼€æ”¾ Analytics å…è´¹ä½¿ç”¨ï¼Œé™¤äº†æœ¬èº«ä½“é‡è¶³å¤Ÿå¤§ã€è¾¹é™…æˆæœ¬å¤Ÿä½ä¹‹å¤–ï¼Œä¹Ÿå› ä¸ºç½‘ç«™ç»Ÿè®¡ä¸å…¶æ ¸å¿ƒçš„å¹¿å‘Šä¸šåŠ¡æ˜¯å¯†ä¸å¯åˆ†çš„ï¼ŒGoogle ä¹äºè®©å°½å¯èƒ½å¤šçš„ç½‘ç«™ä½¿ç”¨ Analyticsï¼Œä»¥å¾—åˆ°å¯ä»¥æ¨åŠ¨å¹¿å‘Šå’Œæœç´¢ä¸šåŠ¡å‘å±•çš„æ•°æ®ã€‚æœä¸å…¶ç„¶ï¼Œç›®å‰é£è¯„æ¯”è¾ƒå¥½çš„æœåŠ¡å¦‚ <a href="https://usefathom.com/pricing">fathom</a> éƒ½æ²¡æœ‰å…è´¹å¥—é¤ï¼Œä»·æ ¼ä¹Ÿä¸ä¾¿å®œï¼›<a href="https://plausible.io/#pricing">plausible</a> ä»·æ ¼è¾ƒä½ï¼Œå¹¶ä¸”æä¾›å¼€æºå¯éƒ¨ç½²çš„ç‰ˆæœ¬ï¼Œè¿™è®©æˆ‘å¼€å§‹è€ƒè™‘è‡ªå»ºç»Ÿè®¡æœåŠ¡çš„å¯è¡Œæ€§ã€‚</p>
<p>è¦é€‰æ‹©ä¸€ä¸ª self-hosted ç½‘ç«™ç»Ÿè®¡æœåŠ¡ï¼Œæˆ‘æœ‰ä»¥ä¸‹å‡ ä¸ªè€ƒé‡ï¼š</p>
<ul>
<li><strong>å®ç°è¯­è¨€</strong>ï¼šæˆ‘éå¸¸å€¾å‘äº JavaScript çš„å®ç°ï¼Œè¿™å¹¶éå‡ºäºæˆ‘å¯¹å®ƒæ›´åŠ ç†Ÿæ‚‰æˆ–è€…åçˆ±ï¼Œè€Œæ˜¯å› ä¸ºè¿‘å¹´æ¥ Cloudflare åœ¨ serverless å’Œ edge computing é¢†åŸŸä¸æ–­æ·±è€•ï¼Œæ¨åŠ¨äº†ä¸€ç³»åˆ—åŸºäº JavaScript çš„è¿è¡Œç¯å¢ƒå’ŒåŸºç¡€è®¾æ–½çš„å‘å±•ï¼Œæœ€è¿‘è¿˜è”åˆ Vercel ç­‰å‹å•†æˆç«‹äº† <a href="https://blog.cloudflare.com/introducing-the-wintercg/">WinterCG</a> ç¤¾åŒºç»„ç»‡ï¼Œè®©æˆ‘çœ‹åˆ°äº† JavaScript ä¸€ç«™å¼äº‘ç«¯å¼€å‘éƒ¨ç½²çš„æœªæ¥ã€‚æˆ‘è‡ªå·±ä¹Ÿå°è¯•è¿‡ Workers å¼€å‘ï¼Œä½“éªŒå¾ˆå¥½ï¼Œå…è´¹é¢åº¦å……è£•ã€‚å¦‚æœä¸€ä¸ªæœåŠ¡æ˜¯ JavaScript å®ç°ï¼Œå°±æœ‰åœ¨ Workers ä¸Šéƒ¨ç½²çš„å¯èƒ½æ€§ã€‚</li>
<li><strong>æ•°æ®åº“</strong>ï¼šæœ€å¥½æ˜¯ SQLiteã€‚SQLite çš„å­˜å‚¨åŸºäºå•æ–‡ä»¶ï¼Œéå¸¸é€‚åˆå°å‹æœåŠ¡çš„å¼€å‘éƒ¨ç½²ã€‚<a href="https://litestream.io/">Litestream</a> çš„å­˜åœ¨è®©åŸºäº S3 ç­‰å¯¹è±¡å­˜å‚¨çš„ä½æˆæœ¬æ•°æ®åº“ç»´æŠ¤æˆä¸ºå¯èƒ½ã€‚</li>
<li><strong>ä¾¿äºéƒ¨ç½²</strong>ï¼šæœ‰å®˜æ–¹ç»´æŠ¤çš„ docker imageï¼Œæˆ–æä¾› PaaS/Serverless å¹³å°çš„ä¸€é”®éƒ¨ç½²æ¨¡æ¿</li>
<li><strong>å°Šé‡æ•°æ®éšç§</strong>ï¼šå…¶å® self-hosted ç»Ÿè®¡æœåŠ¡äº§ç”Ÿçš„ç›®çš„ä¹‹ä¸€å°±æ˜¯ä¸ºäº†æŠµåˆ¶å•†ä¸šæœåŠ¡æ»¥ç”¨ç”¨æˆ·æ•°æ®ï¼Œå› æ­¤è¿™ä¸€ç‚¹å¤§éƒ¨åˆ†é¡¹ç›®éƒ½å¯ä»¥æ»¡è¶³ï¼Œç¨åŠ æ³¨æ„å³å¯ã€‚</li>
<li><strong>ublock</strong>ï¼šä½œä¸ºä¸€ä¸ª webmasterï¼Œè‚¯å®šå¸Œæœ›ç»Ÿè®¡æ•°æ®è¶Šç²¾ç¡®è¶Šå¥½ï¼Œå› æ­¤è¿™ä¸ªæœåŠ¡å¾—æœ‰ç»•è¿‡ ublock æ‹¦æˆªçš„èƒ½åŠ›ã€‚è™½ç„¶æˆ‘ä¸ªäººä¹Ÿä¼šä½¿ç”¨ ublock æ‹¦æˆªå„ç§ trackerï¼Œä½† self-hosted ç»Ÿè®¡æœåŠ¡æœ¬èº«ä¸ä¼šè¿‡åº¦æ”¶é›†ç”¨æˆ·æ•°æ®ï¼Œæ›´ä¸ä¼šå°†å…¶ç”¨äºå•†ä¸šç›®çš„ï¼Œå¯ä»¥ç†ç›´æ°”å£®åœ°æƒ³åŠæ³•ç¡®ä¿å…¶æ­£å¸¸åŠ è½½ã€‚</li>
</ul>
<p>ç»è¿‡ä¸€ç•ªè°ƒæŸ¥ï¼Œæˆ‘é€‰æ‹©äº† umamiï¼Œå®ƒåŸºæœ¬æ»¡è¶³ä»¥ä¸Šæ‰€æœ‰éœ€æ±‚ï¼š</p>
<ul>
<li>å‰åç«¯å…¨éƒ¨ä½¿ç”¨ TypeScript å’Œ Next.js å¼€å‘</li>
<li>æ•°æ®åº“æ˜¯ PostgreSQLï¼Œæˆ‘æ¯”è¾ƒå–œæ¬¢ï¼Œå¯ä»¥æ¥å—</li>
<li>é¡¹ç›®é¡µé¢æœ‰ä¸ªå¤§å¤§çš„ â€œDeploy on Railwayâ€ï¼Œä¹Ÿæœ‰ docker image</li>
<li>é¡¹ç›® Slogan å°±æ˜¯ â€œprivacy focusedâ€
<blockquote>
<p>Umami does not collect any personally identifiable information and anonymizes all data collected.</p>
</blockquote>
</li>
<li>æä¾› <code>TRACKER_SCRIPT_NAME</code> ç¯å¢ƒå˜é‡ç”¨äºè‡ªå®šä¹‰ script åç§°ï¼Œå¯ä»¥ç»•è¿‡ ublock çš„é»˜è®¤è§„åˆ™</li>
</ul>
<p>æ‹©æ—¥ä¸å¦‚æ’æ—¥ï¼Œé€‰å®šå·¥å…·åæˆ‘ç«‹åˆ»å¼€å§‹å°è¯•éƒ¨ç½²ã€‚umami çš„éƒ¨ç½²æµç¨‹æ˜¯å¦‚æ­¤é¡ºæ»‘ï¼ŒåªèŠ±äº†å¤§æ¦‚ 15 åˆ†é’Ÿï¼Œæˆ‘å°±ç¡®ä¿¡è‡ªå·±åšäº†ä¸€ä¸ªååˆ†æ­£ç¡®çš„é€‰æ‹©ã€‚</p>
<h2 id="éƒ¨ç½²è¯´æ˜">éƒ¨ç½²è¯´æ˜</h2>
<p>æˆ‘ä¹‹å‰å°±å¯¹ Railway æœ‰æ‰€äº†è§£ï¼Œæ‰€ä»¥ç›´æ¥ç‚¹å‡» â€œDeploy on Railwayâ€ æŒ‰é’®å¼€å§‹éƒ¨ç½²æµç¨‹ã€‚</p>
<p><a href="https://railway.app">Railway</a> æ˜¯ä¸€ä¸ª PaaS å¹³å°ï¼Œå¯è¿è¡Œ JavaScript, Python, Go ç­‰å¤šç§è¯­è¨€ï¼Œæä¾› Redis, MySQL, MongoDB ç­‰ä¸»æµæ•°æ®åº“å­˜å‚¨ã€‚ç”±äºæ”¯æŒå…¨é¢ã€ç•Œé¢å‹å¥½ï¼ŒåŠ ä¸Šå’Œ Cloudflare ä¸€æ ·æœ‰å……è£•çš„<a href="https://railway.app/pricing">å…è´¹é¢åº¦</a>ï¼Œè¶³å¤Ÿä¸ªäººé¡¹ç›®å…è´¹ä½¿ç”¨ï¼ŒRailway ä¸€ç›´æ˜¯æˆ‘å¿ƒä¸­æœ€å¥½çš„ PaaS ä¹‹ä¸€ã€‚å¦‚æœä½ æœ‰å…´è¶£ï¼Œæ¬¢è¿é€šè¿‡æˆ‘çš„ <a href="https://railway.app?referralCode=XkWaVV">referral link</a> æ³¨å†Œã€‚</p>
<p>umani æœ‰ä¸€ç¯‡ <a href="https://umami.is/docs/running-on-railway">Running on Railway</a> æ–‡æ¡£ï¼Œæˆ‘éµç…§è¿™ä¸ªæµç¨‹å¾ˆå¿«å°±å®Œæˆäº†åˆæ­¥éƒ¨ç½²ã€‚å…¶å®åªæœ‰ä¸€ä¸ª <code>HASH_SALT</code> éœ€è¦è¾“å…¥ï¼Œå…¶ä»–åªéœ€ç‚¹ç‚¹ç‚¹å³å¯ã€‚</p>
<p>Railway Project åˆ›å»ºåï¼Œåœ¨ç®¡ç†ç•Œé¢å¯ä»¥çœ‹åˆ°ä¸¤ä¸ª blockï¼Œå·¦è¾¹æ˜¯æ•°æ®åº“å®ä¾‹ï¼Œå³è¾¹æ˜¯ umami çš„åç«¯æœåŠ¡ã€‚</p>
<p><img loading="lazy" src="/blog/deploy-umami-for-personal-website/images/railway.png" alt=""  /></p>
<h3 id="å®‰è£…ä¾èµ–">å®‰è£…ä¾èµ–</h3>
<p>åœ¨ç­‰å¾… umami çš„é•œåƒæ„å»ºå’Œéƒ¨ç½²çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‘½ä»¤è¡Œè¿›è¡Œä¸€äº›å…¶ä»–å·¥ä½œã€‚</p>
<p>æ‰“å¼€å‘½ä»¤è¡Œï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… Railway CLI å’Œ pgsql ä¸¤ä¸ªè½¯ä»¶ä¾èµ–ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">brew install railwayapp/railway/railway
brew install libpg
</code></pre></div><p>å®Œæˆåï¼Œå°† libpg çš„ bin è·¯å¾„æ·»åŠ åˆ° PATH ä¸­ï¼Œåœ¨ <code>.zshrc</code> æˆ– <code>.bashrc</code> ä¸­æ·»åŠ ä¸€è¡Œ:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$PATH</span><span class="s2">:/opt/homebrew/opt/libpq/bin&#34;</span>
</code></pre></div><p>ä½ å¯ä»¥é€šè¿‡æ‰§è¡Œ <code>type pgsql</code> ç¡®è®¤ <code>pgsql</code> æ˜¯å¦å­˜åœ¨ã€‚</p>
<h3 id="æ›´æ–°æ•°æ®åº“">æ›´æ–°æ•°æ®åº“</h3>
<p>Railway åœ¨åˆ›å»º Project æ—¶ï¼Œä¼šå°† umami çš„ä»£ç å¤åˆ¶åˆ°åœ¨ä½ çš„ GitHub è´¦æˆ·æ‰€åˆ›å»ºçš„åä¸º <code>umami</code> çš„ä»“åº“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†æ­¤ä»“åº“ clone ä¸‹æ¥:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">git clone git@github.com:username/umami.git
</code></pre></div><p>è¿›å…¥ umami ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç™»å½• Railway CLI å¹¶å®Œæˆé“¾æ¥:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">cd</span> umami
railway login
railway link
</code></pre></div><p>è¿™ä¸€æ­¥å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ <code>railway variables</code> çœ‹åˆ° umami æœåŠ¡çš„ç¯å¢ƒå˜é‡ï¼Œç¡®è®¤ CLI å¯ä»¥è®¿é—®åˆ°çº¿ä¸Šæ•°æ®ã€‚</p>
<pre tabindex="0"><code>DATABASE_URL:        postgresql://postgres:xxxxxxxxx@containers-us-west.railway.app:6595/railway
DISABLE_TELEMETRY:   1
HASH_SALT:           xxXXxxXXxxXXxx
HOSTNAME:
PGDATABASE:          railway
PGHOST:              containers-us-west.railway.app
PGPASSWORD:          xxXXxxXXxxXXxx
PGPORT:              6595
PGUSER:              postgres
PORT:                3000
</code></pre><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä¸º umami åˆ›å»ºè¡¨æ ¼ã€æ·»åŠ åˆå§‹æ•°æ®ã€‚æ³¨æ„è¦å°† bash variable æ›¿æ¢ä¸ºä¸Šæ–‡ä¸­çš„æ•°æ®:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">railway run psql -h <span class="nv">$PGHOST</span> -U <span class="nv">$PGUSER</span> -d <span class="nv">$PGDATABASE</span> -f sql/schema.postgresql.sql
</code></pre></div><h3 id="é…ç½®æœåŠ¡">é…ç½®æœåŠ¡</h3>
<p>æ•°æ®åº“åˆå§‹åŒ–å®Œæ¯•åï¼Œå›åˆ° Project ç®¡ç†ç•Œé¢ï¼Œç¡®è®¤ umami éƒ¨ç½²å®Œæ¯•ï¼Œå³å¯æ‰“å¼€æœåŠ¡çš„ä¸»é¡µã€‚</p>
<h4 id="æ›´æ¢å¯†ç ">æ›´æ¢å¯†ç </h4>
<p>ä½¿ç”¨åˆå§‹ç”¨æˆ·åå¯†ç  <code>admin:umami</code> ç™»å½•è¿›å»ï¼Œç„¶åç«‹åˆ»åˆ° Settings &gt; Accounts ç•Œé¢æ›´æ¢ä¸€ä¸ªå¼ºå¯†ç ã€‚</p>
<h4 id="ç»‘å®šä¸ªäººåŸŸå">ç»‘å®šä¸ªäººåŸŸå</h4>
<p>åœ¨ Project ç®¡ç†ç•Œé¢ç‚¹å‡» umamiï¼Œé€‰æ‹© Settingsï¼Œåœ¨ Service Domains ä¸‹æ·»åŠ ä¸ªäººåŸŸåã€‚æ¯”å¦‚æˆ‘ä½¿ç”¨çš„æ˜¯ <code>oishii.reorx.com</code>ã€‚</p>
<p><img loading="lazy" src="/blog/deploy-umami-for-personal-website/images/railway-1.png" alt=""  /></p>
<p>æ‰“å¼€åŸŸåçš„ DNS æœåŠ¡å•†ï¼Œæ ¹æ® Railway ä¸­çš„æç¤ºï¼Œä¸ºè‡ªå®šä¹‰åŸŸåæ·»åŠ  CNAME è®°å½•ã€‚</p>
<p><img loading="lazy" src="/blog/deploy-umami-for-personal-website/images/cloudflare.png" alt=""  /></p>
<p>ç­‰å¾…å‡ åˆ†é’Ÿï¼Œç”Ÿæ•ˆå Railway ä¸­ä¼šæ˜¾ç¤ºä¸Šå›¾æ‰€ç¤ºçš„ âœ… ç¬¦å·ã€‚</p>
<h4 id="ä¿®æ”¹è„šæœ¬åç§°">ä¿®æ”¹è„šæœ¬åç§°</h4>
<p>ä¸ºäº†é¿å… umami è¢« ublock è¯¯æ€ï¼ˆæœ‰çš„è§„åˆ™é›†ä¸­æœ‰åŒ¹é… umami çš„æ­£åˆ™ï¼‰ï¼Œè¿˜éœ€è¦ä¸ºå®ƒçš„ç»Ÿè®¡è„šæœ¬æ›´æ¢ä¸€ä¸ªåç§°ã€‚<a href="https://umami.is/docs/environment-variables">Environment variables</a> æ–‡æ¡£ä¸­çš„ <code>TRACKER_SCRIPT_NAME</code> æä¾›äº†è¿™ä¸€åŠŸèƒ½ã€‚</p>
<p>å†æ¬¡è¿›å…¥ Railwayï¼Œæ‰“å¼€ umami çš„ Variables é€‰é¡¹å¡ï¼ŒæŒ‰ä¸‹å›¾æ‰€ç¤ºæ·»åŠ ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä½¿ç”¨çš„åç§°ä¸º <code>oishii</code>ï¼Œå¯ä»¥æ›´æ¢ä¸ºä»»æ„é tracker ç‰¹å¾è¯æ±‡ã€‚</p>
<p><img loading="lazy" src="/blog/deploy-umami-for-personal-website/images/railway-2.png" alt=""  /></p>
<p>å®Œæˆè¿™ä¸€æ­¥åï¼Œéœ€è¦é‡æ–°æ„å»º umami çš„é•œåƒï¼Œç›®å‰æˆ‘è¿˜æ²¡æœ‰æ‰¾åˆ°è§¦å‘ rebuild çš„ç®€å•æ–¹æ³•ï¼Œåªèƒ½é€šè¿‡ä¿®æ”¹ Dockerfile å®ç°:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff">RUN yarn next telemetry disable
<span class="gi">+# Ensures `yarn build` will always run when BUILD_TIME is different
</span><span class="gi">+ARG BUILD_TIME
</span><span class="gi"></span>RUN yarn build
</code></pre></div><p>åœ¨ <code>yarn build</code> ä¹‹å‰å¢åŠ ä¸€è¡Œ <code>ARG BUILD_TIME</code>ï¼Œè¿™æ ·å½“æ­¤å‚æ•°ä¸åŒæ—¶ï¼Œå°±ä¼šè§¦å‘ <code>yarn build</code> åŠä¹‹åçš„å‘½ä»¤é‡æ–°æ‰§è¡Œã€‚</p>
<p>ä¿å­˜ä¿®æ”¹ï¼Œç„¶åæ‰§è¡Œ <code>railway up</code>ï¼Œç­‰å¾…é•œåƒæ„å»ºå’Œéƒ¨ç½²å®Œæˆã€‚</p>
<h2 id="æ¥å…¥ä¸ªäººç½‘ç«™">æ¥å…¥ä¸ªäººç½‘ç«™</h2>
<p>ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬é‡æ–°ä½¿ç”¨è‡ªå®šä¹‰åŸŸåå’Œä¿®æ”¹åçš„å¯†ç ç™»å½• umamiã€‚</p>
<p>è¦è¿›è¡Œç»Ÿè®¡ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…æ˜¯æ·»åŠ ä¸€ä¸ª Websiteã€‚æ“ä½œéå¸¸ç®€å•ï¼Œè¯»è€…å¯ä»¥å‚è€ƒ <a href="https://umami.is/docs/add-a-website">Add a website</a> æ–‡æ¡£æ¥è¿›è¡Œã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ Enable share URL é€‰é¡¹ï¼Œå¦‚æœä½ æƒ³å°†è‡ªå·±ç½‘ç«™çš„ç»Ÿè®¡æ•°æ®åˆ†äº«å‡ºå»ï¼Œåˆ™éœ€è¦å‹¾é€‰ä¹‹ã€‚ä½ å¯ä»¥åœ¨ <a href="https://oishii.reorx.com/share/jKljpE4T/reorx.com">https://oishii.reorx.com/share/jKljpE4T/reorx.com</a> è®¿é—®æœ¬ç«™çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<p>æ·»åŠ å®Œæˆåï¼Œç‚¹å‡»ç½‘ç«™åˆ—è¡¨ä¸­å¯¹åº”ç½‘ç«™çš„ Get tracking code æŒ‰é’®ï¼Œåœ¨æµ®çª—ä¸­è·å¾—éœ€è¦åŠ å…¥åˆ°ç½‘ç«™ HTML ä¸­çš„ä»£ç ã€‚</p>
<p><img loading="lazy" src="/blog/deploy-umami-for-personal-website/images/umami.png" alt=""  /></p>
<p>éœ€è¦æ³¨æ„å°† <code>src</code> ç»“å°¾çš„ <code>umami.js</code> æ›¿æ¢ä¸º <code>$TRACKER_SCRIPT_NAME.js</code>ã€‚</p>
<p>å¤åˆ¶ä»£ç å¹¶æ·»åŠ åˆ°è‡ªå·±ä¸ªäººç½‘ç«™çš„ <code>&lt;head&gt;</code> æ ‡ç­¾ä¸‹çš„ä»»æ„ä½ç½®ï¼Œç”±äºä½¿ç”¨äº† <code>defer</code> å±æ€§ï¼Œè¿™ä¸ª script ä¸ä¼šå¯¹ç½‘é¡µåŠ è½½é€ æˆé˜»å¡ã€‚</p>
<p>ç½‘ç«™æ›´æ–°å®Œæˆåï¼Œå‘¼æœ‹å”¤å‹ç‚¹å‡»è®¿é—®ä¸€ç•ªï¼Œå°±å¯ä»¥çœ‹åˆ° umami æ¸…æ™°ã€ç¾è§‚çš„ç»Ÿè®¡æ•°æ®äº†ã€‚</p>
<p><img loading="lazy" src="/blog/deploy-umami-for-personal-website/images/umami-1.png" alt=""  /></p>
]]></content:encoded></item><item><title>Frontend Guide 01: Webpack babel-loader ä½¿ç”¨æŒ‡å—</title><link>https://reorx.com/blog/migrate-from-ts-loader-to-babel-loader/</link><pubDate>Wed, 18 May 2022 00:00:00 +0000</pubDate><guid>https://reorx.com/blog/migrate-from-ts-loader-to-babel-loader/</guid><description>Frontend Guide ç³»åˆ—çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œè®²è¿°æˆ‘ä¸ºä½•ä» ts-loader è¿ç§»åˆ° babel-loaderï¼Œä»¥åŠæˆ‘çš„ babel-loader è¯¦ç»†é…ç½®æ–¹æ¡ˆè¯´æ˜ã€‚</description><content:encoded><![CDATA[<h2 id="å¼•å­">å¼•å­</h2>
<p>å¤§çº¦åœ¨ä¸¤ä¸ªæœˆå‰ï¼Œä¸ºäº†åšå‡ºä¸€æ¬¾å±äºè‡ªå·±çš„äº§å“ï¼Œæˆ‘æ­£å¼å¼€å§‹å­¦ä¹  TypeScript å’Œ React å¼€å‘<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>ã€‚è™½ç„¶æ¥è§¦ JavaScript æ—¶é—´ä¸çŸ­äº†ï¼Œä½†ä¸€ç›´çƒ­è¡·äºä½¿ç”¨ Vanilla JSï¼Œä¹Ÿæ²¡æœ‰æ­£å¼åšè¿‡æ¯”è¾ƒä¸¥è‚ƒçš„é¡¹ç›®ã€‚å› æ­¤ï¼Œæˆ‘æŠŠè‡ªå·±å®šä½ä¸ºä¸€ä¸ªå‰ç«¯æ–°æ‰‹ï¼Œå†³å®šä» 0 å¼€å§‹å­¦ä¹ ç°ä»£åŒ–å‰ç«¯å¼€å‘ã€‚</p>
<p>è¿™ä¸¤ä¸ªæœˆæ¥ï¼Œæˆ‘åœ¨å­¦ä¹ å®è·µè¿‡ç¨‹ä¸­ç´¯è®¡äº†ä¸€äº›è‡ªå·±çš„å¿ƒå¾—å’Œä½“ä¼šï¼Œç®—ä¸ä¸Šé«˜æ·±ï¼Œä½†åº”è¯¥å¯ä»¥ä¸ºåŒæ ·åœ¨å­¦ä¹ ä¸­çš„æ–°æ‰‹èµ·åˆ°å‚è€ƒä½œç”¨ã€‚ä»è¿™ç¯‡æ–‡ç« å¼€å§‹ï¼Œæˆ‘ä¼šé€ä¸€å°†æˆ‘è®¤ä¸ºæœ‰ä»·å€¼çš„éƒ¨åˆ†å†™æˆåšå®¢ï¼Œå½’ç±»äº #frontend-guide æ ‡ç­¾ä¸‹ï¼Œå¹¶åœ¨æœªæ¥çš„å­¦ä¹ ä¸­æŒç»­æ›´æ–°ã€‚ä½œä¸ºä¸€ä¸ªéä¸“ä¸šçš„å‰ç«¯å­¦ä¹ è€…ï¼Œè¿™äº›æ–‡ç« ä¸­ä¸€å®šä¼šå‡ºç°é”™è¯¯å’Œç–æ¼ï¼Œè¯·è¯»è€…æœ‹å‹ä»¬ä¸åæŒ‡æ­£ï¼Œå¦‚æœèƒ½ä»æ‰¹è¯„ä¸­å­¦åˆ°ä»€ä¹ˆï¼Œå°†ä¼šæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§æ”¶è·ã€‚</p>
<p>å…ˆå¤§è‡´åˆ—ä¸¾ä¸€äº›å¯å†™çš„è¯é¢˜ï¼Œä»¥ä½œå¤‡å¿˜ï¼š</p>
<ul>
<li>å¦‚ä½•æ„å»ºä¸€ä¸ªæœ€åŸºæœ¬çš„ TypeScript é¡¹ç›®
<ul>
<li>ä»‹ç» package.json å’ŒåŸºæœ¬çš„ devDependencies</li>
<li>ä»‹ç» tsconfig.json ä¸­å¿…é¡»äº†è§£çš„é€‰é¡¹</li>
<li>tsc å’Œ esbuild</li>
</ul>
</li>
<li>å¦‚ä½•ä½¿ç”¨ jest è¿›è¡Œç»†ç²’åº¦çš„ TDD</li>
<li>ä»é›¶å¼€å§‹æ„å»ºè‡ªå·±çš„ React project template
<ul>
<li>ä¸ä½¿ç”¨ create-react-app æœ‰å“ªäº›å¥½å¤„</li>
<li>webpack</li>
<li>babel: modular import and hot reload</li>
<li>config and APP_ENV</li>
</ul>
</li>
<li>å¦‚ä½•æ„å»ºä¸€ä¸ªæœ€åŸºæœ¬çš„ monorepo
<ul>
<li>npm workspace</li>
<li>tsconfig reference</li>
<li>webpack: resolve alias and tsconfig paths plugin</li>
</ul>
</li>
<li>TypeScript caveats and cheatsheet</li>
<li>å¦‚ä½•ä½¿ç”¨ TypeScript å’Œ React å¼€å‘ Chrome Extension</li>
<li>Mobx ä½¿ç”¨æŒ‡å—</li>
<li>å®ç°ä¸€ä¸ªç®€å•çš„ useFetch Hook</li>
<li>å¦‚ä½•ä½¿ç”¨ swr è°ƒç”¨ HTTP API</li>
<li>å¦‚ä½•ä½¿ç”¨ Protobuf å’Œ TypeScript å°è£… HTTP API</li>
</ul>
<h2 id="ts-loader">ts-loader</h2>
<p>åœ¨ç°ä»£åŒ–å‰ç«¯é¡¹ç›®ä¸­ï¼ŒTypeScript å› å…¶é™æ€ç±»å‹çš„ç‰¹æ€§ï¼Œä¸ºä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¥å£®æ€§å¸¦æ¥äº†æå¤§çš„æå‡ï¼Œå·²é€æ¸æˆä¸ºå‰ç«¯å¼€å‘çš„æ ‡å‡†è¯­è¨€ã€‚ä½† TypeScript ä¸èƒ½ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œå› æ­¤åœ¨é¡¹ç›®æ„å»ºæµç¨‹ä¸­éœ€è¦å¼•å…¥ <a href="https://en.wikipedia.org/wiki/Source-to-source_compiler">transpiler</a> æ¥å°†å…¶ç¼–è¯‘ä¸ºæµè§ˆå™¨å¯ç”¨çš„ JavaScriptã€‚<a href="https://github.com/TypeStrong/ts-loader">ts-loader</a> å°±æ˜¯ä¸º Webpack è®¾è®¡çš„ transpiler ä¹‹ä¸€ã€‚</p>
<p>è¿‡å»çš„å¼€å‘ç”Ÿæ¶¯ä¸­ï¼Œæˆ‘è™½ç„¶ä¸æ˜¯ä¸“ä¸šçš„å‰ç«¯ï¼Œä¹Ÿå¯¹ JavaScript ä¸–ç•Œä¸­çš„åŸºçŸ³ babel æœ‰æ‰€è€³é—»ç›®è§ã€‚ä½†åœ¨è¿™æ¬¡ä»é›¶å¼€å§‹å­¦ä¹  TypeScript å¼€å‘æ—¶ï¼Œå› ä¸ºå¯¹ babel æœ‰ç§è¿‡äºå¤æ‚çš„å°è±¡ï¼Œæˆ‘é€‰æ‹©äº† ts-loader ä½œä¸ºç¬¬ä¸€ä¸ªå­¦ä¹ å’Œä¸Šæ‰‹çš„æ’ä»¶ã€‚</p>
<p>ts-loader çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œæ–‡æ¡£ä¹Ÿè¶³å¤Ÿæ¸…æ™°ï¼Œå¦‚æœä½ çš„é¡¹ç›®æœ¬èº«æœ‰æ­£ç¡®é…ç½® <code>tsconfig.json</code> å¹¶å¯ä»¥ä½¿ç”¨ <code>tsc -b</code> å®Œæˆç¼–è¯‘ï¼Œé‚£ä¹ˆåœ¨ webpack ä¸­å¼•å…¥ ts-loader åä¸éœ€è¦é¢å¤–çš„é…ç½®å³å¯å·¥ä½œã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä»½ä½¿ç”¨ ts-loader çš„ <code>webpack.config.js</code> ç¤ºä¾‹:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">entry</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">index</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">srcDir</span><span class="p">,</span> <span class="s1">&#39;index.tsx&#39;</span><span class="p">),</span>
  <span class="p">},</span>
  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">path</span><span class="o">:</span> <span class="nx">destDir</span><span class="p">,</span>
    <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;[name].bundle.js&#39;</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.tsx?$/</span><span class="p">,</span>
        <span class="nx">loader</span><span class="o">:</span> <span class="s1">&#39;ts-loader&#39;</span><span class="p">,</span>
        <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ç»è¿‡ä¸€æ®µæ—¶é—´çš„ä½¿ç”¨ï¼Œæˆ‘å‘ç°äº†å¯¹ ts-loader ä¸å¤ªæ»¡æ„çš„å‡ ä¸ªåœ°æ–¹ï¼š</p>
<ul>
<li>
<p>å¶å°”å‡ºç°è«åçš„é”™è¯¯</p>
<p>æœ‰çš„æ—¶å€™ï¼Œå½“å¯¹ TypeScript æºæ–‡ä»¶è¿›è¡Œäº†æŸç§å˜æ›´ï¼Œæˆ–è®¸æ˜¯å¤§é‡çš„ç±»å‹å˜åŒ–ï¼Œæˆ–è®¸æ˜¯æ–‡ä»¶é‡å‘½åå’Œç§»åŠ¨ç›®å½•ï¼Œå¯èƒ½ä¼šè§¦å‘ ts-loader æŠ¥é”™ï¼Œä½†æ­¤æ—¶ VSCode çš„é™æ€æ£€æŸ¥å™¨å´æ²¡æœ‰æ˜¾ç¤ºå‡ºä»»ä½•é—®é¢˜ï¼ˆæ‰€æœ‰æºæ–‡ä»¶ï¼‰ï¼Œé‡å¯ webpack serve ä¹Ÿæ— æµäºäº‹ã€‚è¿™æ—¶åªèƒ½é€šè¿‡åˆ é™¤æ‰€æœ‰ä¸æ„å»ºè¿‡ç¨‹å’Œç»“æœæœ‰å…³çš„æ–‡ä»¶ï¼Œå¦‚ <code>build</code>, <code>dist</code>, <code>**/*.d.ts</code>, <code>*.tsbuildinfo</code>ï¼Œé‡æ–°è¿è¡Œæ‰å¯ä»¥æ¶ˆé™¤è¿™ä¸ªä¸å­˜åœ¨çš„é”™è¯¯ã€‚</p>
</li>
<li>
<p>éš¾ä»¥ Debug æŸäº› transpiling è¿‡ç¨‹ä¸­çš„é”™è¯¯</p>
<p>å¦‚æœä½ çš„ <code>tsconfig.json</code> ä¸­è®¾ç½®äº† <code>noEmit: true</code> æˆ– <code>noEmitOnError: true</code>, é‚£ä½ å¾ˆæœ‰å¯èƒ½ä¼šçœ‹åˆ° <code>Error: TypeScript emitted no output forâ€¦</code> è¿™æ ·çš„æŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸º ts-loader åœ¨å°† TypeScript è½¬æ¢æˆ JavaScript æ—¶æ— æ³•æˆåŠŸï¼Œäºæ˜¯æ²¡æœ‰è¾“å‡º js æ–‡ä»¶ã€‚ä½†å…·ä½“æ˜¯ä»€ä¹ˆé”™è¯¯ï¼Œå®Œå…¨æ— æ³•ææ¸…æ¥šã€‚æˆ‘åœ¨ GitHub ä¸Šè·Ÿè¸ªäº†ä¸€ä¸ª <a href="https://github.com/TypeStrong/ts-loader/issues/1257">issue</a>, ç›®å‰ä»ç„¶æ²¡æœ‰æ”¶è·ã€‚</p>
</li>
<li>
<p>é¡¹ç›®å†…å¤šä¸ª package å¼•ç”¨å¿…é¡»ç”Ÿæˆæè¿°æ–‡ä»¶</p>
<p>å¦‚æœæƒ³åœ¨é¡¹ç›®å†…æƒ³è¦æ‹†åˆ†å¤šä¸ª package å¹¶äº’ç›¸å¼•ç”¨ï¼Œéœ€è¦ä½¿ç”¨ TypeScript çš„ <a href="https://www.typescriptlang.org/docs/handbook/project-references.html">Project References</a> åŠŸèƒ½ï¼Œè€Œ <code>declaration</code>  å¿…é¡»è®¾ç½®ä¸º trueï¼Œæ­¤æ—¶ ts-loader ä¼šä¸ºè¢«å¼•ç”¨çš„åŒ…ç”Ÿæˆ <code>.d.ts</code> çš„æè¿°æ–‡ä»¶ï¼Œä½¿æ–‡ä»¶æµè§ˆå™¨å˜å¾—æ··ä¹±ã€‚</p>
</li>
<li>
<p>åœ¨æ’ä»¶ç”Ÿæ€ä¸­ä¸æ˜¯ä¸€ç­‰å…¬æ°‘</p>
<p>ä¸€äº›ä¼˜åŒ–é¡¹ç›®å¼€å‘æµç¨‹çš„æ’ä»¶ï¼Œå¦‚ <a href="https://github.com/pmmmwh/react-refresh-webpack-plugin">react-refresh-webpack-plugin</a>, ä¼˜å…ˆæ”¯æŒ babel è€Œé ts-loaderï¼›<a href="https://github.com/umijs/babel-plugin-import">babel-plugin-import</a> çš„ ts-loader å®ç° <a href="https://github.com/Brooooooklyn/ts-import-plugin">ts-import-plugin</a> è¿œä¸å¦‚å…¶æœ¬èº«æµè¡Œã€‚</p>
</li>
</ul>
<p>äºæ˜¯æˆ‘å†³å®šå¯¹ babel-loader è¿›è¡Œä¸€æ¬¡å°è¯•ã€‚</p>
<h2 id="babel-loader">babel-loader</h2>
<p><a href="https://github.com/babel/babel-loader">babel-loader</a> çš„é¡¹ç›®é¡µé¢æœ‰è¯¦ç»†çš„å®‰è£…é…ç½®è¯´æ˜ï¼Œåœ¨æ­¤ä¸åšèµ˜è¿°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåœ¨ TypeScript + React é¡¹ç›®ä¸­å·¥ä½œçš„æœ€å°åŒ–é…ç½®ç¤ºä¾‹:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.tsx?$/</span><span class="p">,</span>
        <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
        <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nx">loader</span><span class="o">:</span> <span class="s1">&#39;babel-loader&#39;</span><span class="p">,</span>
            <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
              <span class="nx">presets</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">[</span><span class="s1">&#39;@babel/preset-env&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">targets</span><span class="o">:</span> <span class="s2">&#34;defaults&#34;</span> <span class="p">}],</span>
                <span class="s1">&#39;@babel/preset-typescript&#39;</span><span class="p">,</span>
                <span class="p">[</span><span class="s1">&#39;@babel/preset-react&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;runtime&#39;</span><span class="o">:</span> <span class="s1">&#39;automatic&#39;</span><span class="p">}]</span>
              <span class="p">],</span>
            <span class="p">},</span>
          <span class="p">},</span>
        <span class="p">],</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>é…ç½®å®Œæˆåï¼Œä»£ç é¡ºåˆ©ç¼–è¯‘ï¼Œéšåæˆ‘å¼€å§‹äº†å¯¹æ„å»ºé…ç½®ä¼˜åŒ–çš„æ¢ç´¢ã€‚</p>
<h3 id="webpack-bundle-analyzer">webpack-bundle-analyzer</h3>
<p>æˆ‘é¦–å…ˆæƒ³åˆ°çš„æ˜¯å¯¹æ„å»ºå‡ºçš„ bundle çš„å¤§å°è¿›è¡Œæ£€æŸ¥ï¼Œä¸€çœ‹ç«Ÿç„¶æœ‰ 7MB ä¹‹å¤§ï¼Œäºæ˜¯å®‰è£…äº† <a href="https://github.com/webpack-contrib/webpack-bundle-analyzer">webpack-bundle-analyzer</a>, å¯¹ bundle ä¸­æ‰€åŒ…å«çš„ä¾èµ–è¿›è¡Œåˆ†æã€‚</p>
<p>ä¸‹é¢æ˜¯å¼•å…¥ webpack-bundle-analyzer ä¹‹åçš„ <code>webpack.config.js</code> æ–‡ä»¶ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡ <code>WEBPACK_USE_ANALYZE</code> åˆ¤æ–­æ˜¯å¦è¿›å…¥åˆ†ææ¨¡å¼å¹¶ä¿®æ”¹ webpack é…ç½®ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">useAnalyze</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">WEBPACK_USE_ANALYZE</span>

<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{...}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">useAnalyze</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">BundleAnalyzerPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack-bundle-analyzer&#39;</span><span class="p">).</span><span class="nx">BundleAnalyzerPlugin</span><span class="p">;</span>

  <span class="nx">config</span><span class="p">.</span><span class="nx">mode</span> <span class="o">=</span> <span class="s1">&#39;development&#39;</span>
  <span class="nx">config</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">BundleAnalyzerPlugin</span><span class="p">({</span>
      <span class="nx">analyzerPort</span><span class="o">:</span> <span class="mi">18888</span><span class="p">,</span>
    <span class="p">})</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span>
</code></pre></div><p>è¿è¡Œ <code>WEBPACK_USE_ANALYZE=1 webpack</code> åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹åˆ†æç»“æœã€‚</p>
<p><img loading="lazy" src="/blog/migrate-from-ts-loader-to-babel-loader/images/webpack-analyze.png" alt=""  /></p>
<p>åŸæ¥ tabler-icons-react ä¸€ä¸ªåº“å°±å äº† 5.28MBï¼Œå…¶ä»–åº“ä¸­ lodash ä¹Ÿä¸ç®—æ­£å¸¸ï¼Œä¼¼ä¹å’Œ tabler-icons-react ä¸€æ ·è¢«å®Œæ•´åŒ…å«è¿›æ¥äº†ã€‚</p>
<h3 id="babel-plugin-import">babel-plugin-import</h3>
<p><a href="https://github.com/konradkalemba/tabler-icons-react">tabler-icons-react</a> æ˜¯ä¸€ä¸ª SVG å›¾æ ‡åº“ï¼Œæˆ‘åªæ˜¯ä½¿ç”¨äº†å…¶ä¸­ä¸€éƒ¨åˆ†å›¾æ ‡ã€‚lodash æ˜¯éå¸¸é€šç”¨çš„å·¥å…·å‡½æ•°åº“ï¼ŒåŒæ ·çš„ï¼Œæˆ‘åªå¯¹å…¶ä¸­ä¸€éƒ¨åˆ†å‡½æ•°è¿›è¡Œäº†å¼•ç”¨ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•æŒ‰éœ€åŠ è½½ä¾èµ–ä¸­çš„æ¨¡å—ï¼Œåªè¾“å‡ºè¢« import åˆ°çš„éƒ¨åˆ†å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ <a href="https://github.com/umijs/babel-plugin-import">babel-plugin-import</a>ã€‚</p>
<p>ç»§ç»­ä¿®æ”¹ <code>webpack.config.js</code>ï¼Œä¸º babel-loader å¢åŠ  plugins:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nx">loader</span><span class="o">:</span> <span class="s1">&#39;babel-loader&#39;</span><span class="p">,</span>
    <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">[</span><span class="s1">&#39;import&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">libraryName</span><span class="o">:</span> <span class="s1">&#39;tabler-icons-react&#39;</span><span class="p">,</span>
        <span class="nx">libraryDirectory</span><span class="o">:</span> <span class="s1">&#39;dist/icons&#39;</span><span class="p">,</span>
      <span class="p">}],</span>
      <span class="p">[</span><span class="s1">&#39;import&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">libraryName</span><span class="o">:</span> <span class="s1">&#39;lodash&#39;</span><span class="p">,</span>
        <span class="nx">libraryDirectory</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="nx">camel2DashComponentName</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="p">}],</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>å†æ¬¡è¿è¡Œ <code>WEBPACK_USE_ANALYZE=1 webpack</code> ï¼Œå¯ä»¥çœ‹å‡º bundle ç»“æ„æœ‰äº†æ˜¾è‘—çš„æ”¹è¿›ï¼ˆçº¢è‰²çš„éƒ¨åˆ†æ˜¯ tabler-icons-react å’Œ lodashï¼‰:</p>
<p><img loading="lazy" src="/blog/migrate-from-ts-loader-to-babel-loader/images/webpack-analyze-2.png" alt=""  /></p>
<blockquote>
<p><a href="https://github.com/lodash/babel-plugin-lodash">babel-plugin-lodash</a> ä¹Ÿå¯ä»¥å®ç° lodash çš„æŒ‰éœ€åŠ è½½ï¼Œä½†å®ƒæ˜¯ä¸“ä¸º lodash å¼€å‘çš„ï¼Œä¸å…·å¤‡ babel-plugin-import çš„é€šç”¨æ€§ã€‚</p>
</blockquote>
<h3 id="babelpreset-env">@babel/preset-env</h3>
<p><a href="https://babeljs.io/docs/en/babel-preset-env">@babel/preset-env</a> æ˜¯ babel ä¸­æœ€é‡è¦çš„ä¸€ä¸ª presetã€‚æ‰€è°“ presetï¼Œå³é¢„è®¾é…ç½®çš„å°è£…ï¼Œè®©éœ€æ±‚ç›¸è¿‘çš„ç”¨æˆ·å¯ä»¥ä¸ç”¨å…³æ³¨ç»†èŠ‚ç›´æ¥ä½¿ç”¨ï¼Œpreset-env æä¾›äº†éå¸¸ä¸°å¯Œçš„é€‰é¡¹ï¼Œè®©ä½¿ç”¨è€…å¯ä»¥å¿«é€Ÿå®šåˆ¶å‡ºç¬¦åˆç›®æ ‡éœ€æ±‚çš„ç¼–è¯‘ç»“æœã€‚</p>
<p>é¦–å…ˆè¦å…³æ³¨çš„æ˜¯ <a href="https://babeljs.io/docs/en/options#targets">targets</a> é€‰é¡¹ï¼Œå®ƒå†³å®šäº† babel æ‰€ç¼–è¯‘å‡ºçš„ JavaScript èƒ½å¦åœ¨ç‰¹å®šå¹³å°ä¸Šè¿è¡Œã€‚<code>targets</code> æ”¯æŒ <a href="https://github.com/ai/browserslist">browserslist</a> è¯­æ³•ï¼Œä¸Šæ–‡ä¸­æˆ‘ä»¬çš„åˆå§‹é…ç½® <code>['@babel/preset-env', { targets: &quot;defaults&quot; }],</code> ä»£è¡¨ä½¿ç”¨ browserslist çš„ defaults æŸ¥è¯¢<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>ï¼Œè™½ç„¶å¯ä»¥ç¼–è¯‘ï¼Œä½†åœ¨æµè§ˆå™¨ä¸­æ˜¯æ— æ³•è¿è¡Œçš„ï¼Œä¼šäº§ç”Ÿ
<code>Uncaught ReferenceError: regeneratorRuntime is not defined</code> é”™è¯¯ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>ä¸ºäº†ç»Ÿä¸€ä¸åŒæµè§ˆå™¨çš„ JavaScript å®ç°å·®å¼‚ï¼Œä½¿ ES2015+ ä»£ç å¯ä»¥æ­£ç¡®è¿è¡Œï¼Œbabel ä¼šæ ¹æ® targets å†³å®šæ˜¯å¦éœ€è¦åœ¨ç¼–è¯‘ç»“æœä¸­æ³¨å…¥ polyfillã€‚
æœ€æ—©è¿™ä¸€åŠŸèƒ½ç”± <a href="https://babeljs.io/docs/en/babel-polyfill">@babel/polyfill</a> å®ç°ï¼Œä½†å®ƒåœ¨ babel 7.4.0 ä¹‹åè¢«åºŸå¼ƒï¼Œç”± <a href="https://github.com/zloirock/core-js">core-js </a> æ¥æ›¿ã€‚æˆ‘ä»¬çš„ä»£ç ä¹‹æ‰€ä»¥è¿è¡ŒæŠ¥é”™ï¼Œå°±æ˜¯å› ä¸ºæ²¡æœ‰æŒ‡å®š preset-env ä½¿ç”¨ core-jsï¼Œå¯¼è‡´ç”¨äºæ¨¡æ‹Ÿ ES2015+ è¿è¡Œç¯å¢ƒçš„ <code>regeneratorRuntime</code> ç¼ºå¤±ã€‚</p>
<p>ä¿®æ”¹åçš„ preset-env é…ç½®å¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="p">[</span><span class="s2">&#34;@babel/preset-env&#34;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">targets</span><span class="o">:</span> <span class="s2">&#34;defaults&#34;</span><span class="p">,</span>
  <span class="nx">corejs</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="nx">useBuiltIns</span><span class="o">:</span> <span class="s1">&#39;usage&#39;</span><span class="p">,</span>
<span class="p">}]</span>
</code></pre></div><p>é‡æ–°ç¼–è¯‘ï¼Œä»£ç å³å¯æˆåŠŸè¿è¡Œã€‚å¹¶ä¸”é€šè¿‡ webpack-bundle-analyzer å¯ä»¥å‘ç° bundle ä¸­å¤šå‡ºäº† core-js çš„éƒ¨åˆ†ã€‚</p>
<p>å¦‚æœæƒ³åœ¨å¯¹æµè§ˆå™¨çš„æ”¯æŒä¸Šæ¿€è¿›ä¸€äº›ï¼Œå¯ä»¥å°è¯•å°† targets è®¾ä¸º <code>{browsers: '&gt; 5%'}</code>ï¼Œå³ä»…æ”¯æŒå æœ‰ç‡è¶…è¿‡ 5% çš„æµè§ˆå™¨ï¼Œä½ ä¼šå‘ç° bundle ä¸­ core-js çš„éƒ¨åˆ†ä¼šå†æ¬¡æ¶ˆå¤±ï¼Œå› ä¸ºè¿™äº›æµè§ˆå™¨ä¸éœ€è¦ core-js å°±æœ‰å®Œæ•´çš„ ES2015 æ”¯æŒã€‚</p>
<h3 id="react-refresh-webpack-plugin">react-refresh-webpack-plugin</h3>
<p>webpack æä¾› <a href="https://webpack.js.org/concepts/hot-module-replacement/">HMR</a> çƒ­æ›´æ–°åŠŸèƒ½ï¼Œä¸éœ€è¦åˆ·æ–°é¡µé¢å³å¯å°†æ”¹åŠ¨åæ˜ åˆ°é¡µé¢ä¸­ã€‚åœ¨ babel-loader ä¸­ï¼Œéœ€è¦é€šè¿‡ <a href="https://github.com/pmmmwh/react-refresh-webpack-plugin">react-refresh-webpack-plugin</a> æ’ä»¶æ¥å®ç° React JSX çš„çƒ­æ›´æ–°ã€‚</p>
<p>é¦–å…ˆè¦åœ¨ devServer ä¸­å¼€å¯ <code>hot</code> é€‰é¡¹:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">devServer</span><span class="o">:</span> <span class="p">{</span>
    <span class="c1">// Enable hot reloading
</span><span class="c1"></span>    <span class="nx">hot</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ç„¶åä¸º webpack æ·»åŠ  <code>ReactRefreshWebpackPlugin</code> æ’ä»¶:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">ReactRefreshWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@pmmmwh/react-refresh-webpack-plugin&#39;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">ReactRefreshWebpackPlugin</span><span class="p">(),</span>
  <span class="p">],</span>
<span class="p">}</span>
</code></pre></div><p>æœ€åä¸º babel-loader æ·»åŠ  <code>react-refresh/babel</code> æ’ä»¶ï¼Œé€šè¿‡ <code>isDevelopment</code> å†³å®šæ˜¯å¦å­˜åœ¨:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nx">loader</span><span class="o">:</span> <span class="s1">&#39;babel-loader&#39;</span><span class="p">,</span>
  <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
      <span class="nx">isDevelopment</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;react-refresh/babel&#39;</span>
    <span class="p">].</span><span class="nx">filter</span><span class="p">(</span><span class="nb">Boolean</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="summary">Summary</h3>
<p>å°†ä»¥ä¸Šæ’ä»¶å’ŒæŠ€å·§ç»¼åˆèµ·æ¥ï¼Œæœ€ç»ˆæˆ‘çš„ babel-loader é…ç½®å¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.tsx?$/</span><span class="p">,</span>
        <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
        <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nx">loader</span><span class="o">:</span> <span class="s1">&#39;babel-loader&#39;</span><span class="p">,</span>
            <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
              <span class="nx">presets</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">[</span><span class="s1">&#39;@babel/preset-env&#39;</span><span class="p">,</span> <span class="p">{</span>
                  <span class="nx">targets</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">browsers</span><span class="o">:</span> <span class="s1">&#39;&gt; 5%&#39;</span><span class="p">,</span>
                  <span class="p">},</span>
                  <span class="nx">corejs</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
                  <span class="nx">useBuiltIns</span><span class="o">:</span> <span class="s1">&#39;usage&#39;</span><span class="p">,</span>
                <span class="p">}],</span>
                <span class="s1">&#39;@babel/preset-typescript&#39;</span><span class="p">,</span>
                <span class="p">[</span><span class="s1">&#39;@babel/preset-react&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;runtime&#39;</span><span class="o">:</span> <span class="s1">&#39;automatic&#39;</span><span class="p">}]</span>
              <span class="p">],</span>
              <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">[</span><span class="s1">&#39;import&#39;</span><span class="p">,</span> <span class="p">{</span>
                  <span class="nx">libraryName</span><span class="o">:</span> <span class="s1">&#39;tabler-icons-react&#39;</span><span class="p">,</span>
                  <span class="nx">libraryDirectory</span><span class="o">:</span> <span class="s1">&#39;dist/icons&#39;</span><span class="p">,</span>
                <span class="p">}],</span>
                <span class="p">[</span><span class="s1">&#39;import&#39;</span><span class="p">,</span> <span class="p">{</span>
                  <span class="nx">libraryName</span><span class="o">:</span> <span class="s1">&#39;lodash&#39;</span><span class="p">,</span>
                  <span class="nx">libraryDirectory</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                  <span class="nx">camel2DashComponentName</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="p">}],</span>
                <span class="nx">isDevelopment</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;react-refresh/babel&#39;</span>
              <span class="p">].</span><span class="nx">filter</span><span class="p">(</span><span class="nb">Boolean</span><span class="p">),</span>
            <span class="p">},</span>
          <span class="p">},</span>
        <span class="p">],</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>å®ƒå®ç°äº†ï¼š</p>
<ul>
<li>è¾“å‡ºæ”¯æŒç°ä»£ä¸»æµæµè§ˆå™¨çš„ JavaScript</li>
<li>æŒ‰éœ€åŠ è½½ tabler-icons-react å’Œ lodash æ¨¡å—</li>
<li>React JSX å¼€å‘çƒ­æ›´æ–°</li>
</ul>
<p>å¦‚æœä½ æƒ³çœ‹åˆ°ä¸€ä¸ªå¯è¿è¡Œçš„ä¾‹å­ï¼Œè¯·å‚è€ƒæˆ‘çš„æœ€å°åŒ– React é¡¹ç›®æ¨¡æ¿ <a href="https://github.com/reorx/minireact">reorx/minireact</a>ï¼Œå…¶ä¸­æœ‰å®Œæ•´çš„ <a href="https://github.com/reorx/minireact/blob/6e5b086e309cdbe7132c268ba8cf1e6e5d5ab32e/webpack.config.js">webpack.config.js</a> æ–‡ä»¶ã€‚</p>
<h2 id="revision">Revision</h2>
<ul>
<li>2022-05-18: created</li>
</ul>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>å¼€å§‹å­¦ä¹ æ—¶çš„æ¨æ–‡: <a href="https://twitter.com/novoreorx/status/1500385952942157828">å­¦ä¹ äº†ä¿©å°æ—¶å¦‚ä½•å¼€å§‹ä¸€ä¸ª TypeScript é¡¹ç›®ï¼Œç°åœ¨å·²ç»ä¸çœäººäº‹äº†</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>æ ¹æ® browerslist æ–‡æ¡£ï¼Œ<code>defaults</code> ä»£è¡¨ <code>&gt; 0.5%, last 2 versions, Firefox ESR, not dead</code>ï¼Œæ˜¯ä¸€ä¸ªéå¸¸å®½æ³›çš„è§„åˆ™ï¼Œå¯è¦†ç›–å…¨ä¸–ç•Œæ‰€æœ‰æµè§ˆå™¨ä¸­çš„ <a href="https://browserslist.dev/?q=ZGVmYXVsdHM%3D">90%</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></content:encoded></item><item><title>Google I/O 2022 Web Platform æ–°ç‰¹æ€§å±•ç¤ºè§‚çœ‹ç¬”è®°</title><link>https://reorx.com/blog/notes-on-google-io-2022-web-platform-presentation/</link><pubDate>Wed, 18 May 2022 00:00:00 +0000</pubDate><guid>https://reorx.com/blog/notes-on-google-io-2022-web-platform-presentation/</guid><description>äº†è§£ Web æ–°æŠ€æœ¯ä»æœªå¦‚æ­¤å……æ»¡ä¹è¶£ã€‚</description><content:encoded><![CDATA[<p>å‡ å¤©å‰ä¸´ç¡æ—¶çœ‹äº† 2022 Google IO çš„ä¸€ä¸ª presentation: <a href="https://www.youtube.com/watch?v=5b4YcLB4DVI">What&rsquo;s new for the web platform</a>, ä¸¤ä½ Google å‘˜å·¥çš„è§£è¯´è®©äº†è§£ Web æ–°æŠ€æœ¯çš„è¿‡ç¨‹å˜å¾—å……æ»¡ä¹è¶£ï¼Œäºæ˜¯åšäº†äº›ç¬”è®°åœ¨ <a href="https://threadreaderapp.com/thread/1525875286096904192.html">Twitter thread</a> ä¸­ã€‚è¿™ç¯‡æ–‡ç« å¯¹ç¬”è®°è¿›è¡Œäº†æ•´ç†ï¼Œå¹¶ä¸ºæ¯ä¸ªç‰¹æ€§é™„åŠ è¯¦ç»†è¯´æ˜çš„é“¾æ¥ã€‚</p>
<div class="tweet social-quote">
  <div class="title">
    <svg role="img" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>

    
  </div>

  <blockquote class="twitter-tweet" data-dnt="true"><p lang="zh" dir="ltr">å¼€ä¸ªä¸²è®°å½•ä¸‹è§‚çœ‹ Google IO What&#39;s new for the web platform ä¸­å‘ç°çš„æœ‰è¶£çš„ feature<a href="https://t.co/LZPGGn7NHZ">https://t.co/LZPGGn7NHZ</a></p>&mdash; Reorx (@novoreorx) <a href="https://twitter.com/novoreorx/status/1525875286096904192?ref_src=twsrc%5Etfw">May 15, 2022</a></blockquote>

</div>


<h2 id="html">HTML</h2>
<h3 id="dialog"><code>&lt;dialog&gt;</code></h3>
<p><a href="https://web.dev/building-a-dialog-component/">https://web.dev/building-a-dialog-component/</a></p>
<p><code>&lt;dialog&gt;</code> å’Œ <code>&lt;selectmenu&gt;</code>ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰ UI Kit éƒ½ä¼šåœ¨ç»„ä»¶åº“é‡Œå®ç°çš„åŠŸèƒ½ï¼Œç»ˆäºè¢« HTML åŸç”Ÿå®ç°äº†ã€‚å¦‚æœ HTML èƒ½å¤šä¸€äº›è¿™ç§å¸¸ç”¨çš„äº¤äº’ç»„ä»¶ï¼Œæˆ‘ä¼šå¾ˆä¹æ„æ‰‹å†™ Vanilla JS æ¥ä½¿ç”¨å®ƒä»¬ã€‚</p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-dialog.png" alt=""  /></p>
<h3 id="selectmenu"><code>&lt;selectmenu&gt;</code></h3>
<p><a href="https://open-ui.org/prototypes/selectmenu">https://open-ui.org/prototypes/selectmenu</a></p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-selectmenu.png" alt=""  /></p>
<h3 id="input-typedatetile-local"><code>&lt;input type=datetile-local&gt;</code></h3>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/datetime-local">https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/datetime-local</a></p>
<p>è®°å¾— 7 å¹´å‰åœ¨è±Œè±†èšå·¥ä½œæ—¶ï¼Œå› ä¸ºè¿™ä¸ªæ ‡ç­¾ä¸è¢« Firefox æ”¯æŒï¼Œè¢«è¿«æ‰¾äº†ä¸€ä¸ª JavaScript åº“æ¥ä»£æ›¿ (Pikaday, I still remember)ã€‚å¦‚ä»Šç»ˆäºå¯ä»¥åœ¨ä¸»æµæµè§ˆå™¨ä¸Šå…¨é¢é€šç”¨ï¼Œå¤ªä¸å®¹æ˜“äº†ğŸ˜­ã€‚</p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-datetime-local.png" alt=""  /></p>
<h2 id="css">CSS</h2>
<h3 id="has-selector"><code>:has</code> selector</h3>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:has">https://developer.mozilla.org/en-US/docs/Web/CSS/:has</a></p>
<p>ç”¨äºå£°æ˜çˆ¶å­å…ƒç´ å…³ç³»çš„ :has é€‰æ‹©å™¨ï¼è¿™ä¸ªåŠŸèƒ½å‰é˜µå­æ­£å¥½æœç´¢è¿‡ï¼Œç°åœ¨åªèƒ½ç”¨ JavaScript å®ç°ã€‚</p>
<p>å›¾ä¸­çš„ä»£ç å¯ä»¥è§£é‡Šä¸ºï¼Œåœ¨åŒ…å« <code>&lt;figcaption&gt;</code> çš„ <code>&lt;figure&gt;</code> å…ƒç´ ä¸­ï¼Œå°†å…¶ children ä¸­çš„ <code>&lt;img&gt;</code> å¢åŠ  1rem çš„ bottom marginã€‚</p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-has.png" alt=""  /></p>
<h3 id="aspect-ratio">Aspect ratio</h3>
<p><a href="https://web.dev/aspect-ratio/">https://web.dev/aspect-ratio/</a></p>
<p>CSS aspect-radioï¼Œä½¿å…ƒç´ ä¿æŒå›ºå®šçš„å®½é«˜æ¯”ã€‚è¿™æ˜¯æ›¾ç»åœ¨ <code>&lt;img&gt;</code> æ ‡ç­¾ä¸Šçš„å®éªŒç‰¹æ€§ï¼Œå¦‚ä»Šç»ˆäºè¢«æ‰€æœ‰å…ƒç´ æ”¯æŒäº†ã€‚</p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-aspect-ratio.png" alt=""  /></p>
<h3 id="cascade-layer">Cascade Layer</h3>
<p><a href="https://developer.chrome.com/blog/cascade-layers/">https://developer.chrome.com/blog/cascade-layers/</a></p>
<p>Cascade Layers, ç»™ CSS åŠ ä¸Šäº†å±‚çº§çš„æ¦‚å¿µï¼Œlayer å¯ä»¥è‡ªç”±æ’åˆ—é¡ºåºï¼Œåé¢çš„æ¯”å‰é¢çš„æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ (specificity)ï¼›è¿˜å±•ç¤ºäº†ä¸‹è¶Šæ¥è¶Šå¤æ‚çš„ CSS ä¼˜å…ˆçº§å…³ç³»å›¾ï¼Œå…¶å®ä¹Ÿå¯ä»¥æŠŠæ¯ä¸€çº§éƒ½å½“åšä¸€ä¸ª layerã€‚</p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-cascade-layer.png" alt=""  /></p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-cascade-layer-1.png" alt=""  /></p>
<h3 id="container-queries">Container queries</h3>
<p>Container queriesï¼Œåœ¨å“åº”å¼ä¸­èƒ½å¤Ÿå‘æŒ¥é‡è¦ä½œç”¨ï¼Œä½†æˆ‘åŸºæœ¬æ²¡å¬æ‡‚ï¼Œæœªæ¥åº”è¯¥ä¼šå½±å“ä¸€äº› CSS æ¡†æ¶çš„ APIï¼Œåˆ°æ—¶å€™å†æ¥å­¦ä¹ å§ã€‚</p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-container-queries.png" alt=""  /></p>
<h3 id="accent-color">Accent color</h3>
<p><a href="https://web.dev/accent-color/">https://web.dev/accent-color/</a></p>
<p>CSS accent-colorï¼Œä¸º HTML åŸºæœ¬å…ƒç´ è®¾å®šä¸€ä¸ªç»Ÿä¸€çš„è‰²è°ƒï¼Œä¸»æµæµè§ˆå™¨åœ¨ä¸€å¹´å†…éƒ½äº‰å…ˆæååœ°å®ç°äº†ğŸ˜‚ï¼Œæ¯•ç«Ÿè¿™æ˜¯æœ€èƒ½ä½“ç°è‡ªå·±é¢œå€¼çš„åŠŸèƒ½ã€‚ä¸çŸ¥é“èƒ½ä¸èƒ½å’Œæ“ä½œç³»ç»Ÿçš„ accent-color äº’é€šï¼Œè¿™æ ·ä½“éªŒå°±æ›´ä¸€è‡´äº†ã€‚</p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-accent-color.png" alt=""  /></p>
<h2 id="javascript">JavaScript</h2>
<h3 id="arrayprototypeat">Array.prototype.at</h3>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/at">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/at</a></p>
<p>Array å¢åŠ äº† at æ–¹æ³•ï¼ŒJavaScript ç»ˆäºå¯ä»¥ç”¨ç±»ä¼¼ Python <code>list[-1]</code> çš„å†™æ³•äº†ã€‚è¿™æ›¾ç»æ˜¯æˆ‘åˆšå­¦ä¹  JavaScript æ—¶è§‰å¾—å®ƒä¸å¦‚ Python æœ€ä¸»è¦çš„åŸå› ã€‚</p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-array-at.png" alt=""  /></p>
<h3 id="urlpattern">URLPattern</h3>
<p><a href="https://web.dev/urlpattern/">https://web.dev/urlpattern/</a></p>
<p>æ–°ç±»å‹ URLPatternï¼Œå®šä¹‰ URL è·¯å¾„ä¸­çš„å‚æ•°å¹¶è§£æå‡ºå¯¹åº”çš„ objectã€‚routing library ä¸ç”¨å†å†™éº»çƒ¦çš„æ­£åˆ™äº†</p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-urlpattern.png" alt=""  /></p>
<h3 id="structuredclone">structuredClone</h3>
<p><a href="https://web.dev/structured-clone/">https://web.dev/structured-clone/</a></p>
<p>æœ‰äº† structuredClone, å†ä¹Ÿä¸ç”¨å†™ JSON.parse JSON.stringify è¿™ç§æ‰­æ›²å¿ƒæ™ºçš„ä»£ç äº†ï¼Œéå¸¸é€‚åˆåœ¨é¢è¯•å®˜é—®åˆ° deep clone çš„é—®é¢˜æ—¶åå°†ä¸€å†›ã€‚è¿˜å¯ä»¥ç”¨æ¥ clone å…¶ä»–æ•°æ®ç»“æ„å¦‚ blobs, bitmaps, typed arraysã€‚</p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-structuredclone.png" alt=""  /></p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-structuredclone-1.png" alt=""  /></p>
<h3 id="createimagebitmap">createImageBitmap</h3>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/createImageBitmap">https://developer.mozilla.org/en-US/docs/Web/API/createImageBitmap</a></p>
<p>createImageBitmap, æŠŠ blob ç›´æ¥è½¬åŒ–æˆ Image å¯¹è±¡ï¼Œæ”¹å–„äº†ä¸€ç›´ä»¥æ¥å¤æ‚è€Œè„†å¼±çš„å†™æ³•ã€‚</p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-blob.png" alt=""  /></p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-blob-1.png" alt=""  /></p>
<h2 id="miscellaneous">Miscellaneous</h2>
<h3 id="chips">CHIPS</h3>
<p><a href="https://developer.chrome.com/docs/privacy-sandbox/chips/">https://developer.chrome.com/docs/privacy-sandbox/chips/</a></p>
<p>CHIPS å…¨ç§° Cookies Having Independent Partitioned State, æ˜¯ Cookie åœ¨å®‰å…¨ç­–ç•¥ä¸Šçš„æ–°ç‰¹æ€§ï¼Œä¸º Set-Cookie å¢åŠ äº† <code>Partitioned</code> å…³é”®è¯ã€‚å¯ä»¥ä½¿ç‰¹å®š cookie åœ¨ iframe ä¸­åªç”¨äºå½“å‰ç«™ç‚¹ã€‚è‡ªä¸¤å¹´å‰ <code>SameSite</code> å…³é”®è¯æ¨å¹¿åï¼Œthird-party cookie åªèƒ½é€‰æ‹©å…¨æœ‰æˆ–è€…å…¨æ— ï¼Œè¿™æ¬¡ç»ˆäºæœ‰äº†ä¸€ä¸ªæŠ˜ä¸­çš„é€‰æ‹©ã€‚</p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-chips.png" alt=""  /></p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-chips-1.png" alt=""  /></p>
<h3 id="window-controls-overlay">Window controls overlay</h3>
<p><a href="https://web.dev/window-controls-overlay/">https://web.dev/window-controls-overlay/</a></p>
<p>Window controls overlay æ˜¯ä¸€ç»„ <a href="https://developer.mozilla.org/en-US/docs/Web/Manifest">Web app manifests</a>, CSS, JavaScript API çš„é›†åˆï¼Œå®ç°äº†å®šåˆ¶ PWA çª—å£åœ¨ window bar éƒ¨åˆ†åŒºåŸŸçš„æ˜¾ç¤ºæ•ˆæœï¼Œç”¨äºè·å¾—æ›´æœ‰æ²‰æµ¸æ„Ÿçš„ä½¿ç”¨ä½“éªŒã€‚</p>
<p><img loading="lazy" src="/blog/notes-on-google-io-2022-web-platform-presentation/images/google-io-2022-web-wco.png" alt=""  /></p>
]]></content:encoded></item><item><title>PyYAML ä½¿ç”¨æŠ€å·§</title><link>https://reorx.com/blog/python-yaml-tips-zh/</link><pubDate>Sun, 15 May 2022 00:00:00 +0000</pubDate><guid>https://reorx.com/blog/python-yaml-tips-zh/</guid><description>åˆ†äº«æˆ‘åœ¨ Python ä¸‹ä½¿ç”¨ PyYAML çš„æŠ€å·§å’Œä»£ç ç‰‡æ®µï¼Œå¹¶ä»‹ç»å‡ ä¸ªç›¸å…³çš„åº“ã€‚</description><content:encoded><![CDATA[<blockquote>
<p>è‹±æ–‡ç‰ˆ: <a href="https://reorx.com/blog/python-yaml-tips/">Tips that may save you from the hell of PyYAML</a>
</p>
</blockquote>
<p>YAML æ˜¯ä¸€ä¸ªè¢«å¹¿æ³›ä½¿ç”¨çš„æ•°æ®åºåˆ—åŒ–å’Œé…ç½®è¯­è¨€ï¼Œä½œä¸ºä¸€ä¸ªå¼€å‘è€…ï¼Œæ€»æ˜¯ä¸å…å’Œå®ƒæ‰“äº¤é“ã€‚
ä½†å¤„ç† YAML æ–‡æ¡£ï¼Œå°¤å…¶æ˜¯ä½¿ç”¨ PyYAML çš„è¿‡ç¨‹æ€»æ˜¯éå¸¸ç—›è‹¦ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« åˆ†äº«æˆ‘åœ¨ Python ä¸‹ä½¿ç”¨ PyYAML çš„æŠ€å·§å’Œä»£ç ç‰‡æ®µï¼Œå¹¶ä»‹ç»å‡ ä¸ªç›¸å…³çš„åº“ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæœ¬æ–‡ä¸­çš„ä»£ç ä»…ä¿è¯åœ¨ Python 3 ä¸‹æ­£å¸¸å·¥ä½œ</p>
</blockquote>
<h2 id="æ€»æ˜¯ä½¿ç”¨-safe_loadsafe_dump">æ€»æ˜¯ä½¿ç”¨ <code>safe_load/safe_dump</code></h2>
<p>PyYAML çš„ <code>load</code> å‡½æ•°å¯ä»¥æ„é€ ä»»æ„ Python å¯¹è±¡ï¼ˆPickle åè®®ï¼‰ï¼Œè¿™æ„å‘³ç€ä¸€æ¬¡ <code>load</code> å¯èƒ½å¯¼è‡´ä»»æ„ Python å‡½æ•°è¢«æ‰§è¡Œã€‚</p>
<p>ä¸ºäº†ç¡®ä¿åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ï¼Œå°½é‡åœ¨ä»»ä½•æƒ…å†µä¸‹ä½¿ç”¨ <code>yaml.safe_load</code> å’Œ <code>yaml.safe_dump</code>ã€‚</p>
<h2 id="ä¿ç•™å­—æ®µé¡ºåº">ä¿ç•™å­—æ®µé¡ºåº</h2>
<p>Python 3.7+ ä¸­ï¼Œ<code>dict</code> keys å…·å¤‡ä¿ç•™æ’å…¥é¡ºåºçš„ç‰¹æ€§ï¼Œæ‰€ä»¥é€šè¿‡ <code>yaml.safe_load</code> å¾—åˆ°çš„ <code>dict</code>ï¼Œå…¶ keys é¡ºåºä¼šä¸åŸå§‹æ–‡ä»¶ä¿æŒä¸€è‡´ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">yaml</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;---
</span><span class="s2">... c: 1
</span><span class="s2">... b: 1
</span><span class="s2">... d: 1
</span><span class="s2">... a: 1
</span><span class="s2">... &#34;&#34;&#34;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span>
<span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span>
</code></pre></div><p>å½“æŠŠ <code>dict</code> å¯¼å‡ºä¸º YAML å­—ç¬¦ä¸²æ—¶ï¼Œä¸º <code>yaml.safe_dump</code> ä¼ é€’ <code>sort_keys=False</code> æ¥ä¿ç•™ keys çš„é¡ºåºã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<span class="n">a</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">b</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">c</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">d</span><span class="p">:</span> <span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">c</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">b</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">d</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">a</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">e</span><span class="p">:</span> <span class="mi">1</span>
</code></pre></div><p>å¦‚æœ Python ç‰ˆæœ¬è¾ƒä½ï¼Œæˆ–è€…ä½ æƒ³ç¡®ä¿ä»£ç èƒ½åœ¨æ›´å¹¿æ³›çš„ç¯å¢ƒä¸‹å·¥ä½œï¼Œä½ å¯ä»¥ä½¿ç”¨ <a href="https://github.com/wimglenn/oyaml">oyaml</a> åº“æ¥ä»£æ›¿ PyYAML çš„ <code>yaml</code> åŒ…ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">oyaml</span> <span class="k">as</span> <span class="nn">yaml</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span>
<span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">c</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">b</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">d</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">a</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">e</span><span class="p">:</span> <span class="mi">1</span>
</code></pre></div><h2 id="ä¼˜åŒ–åˆ—è¡¨é¡¹çš„ç¼©è¿›">ä¼˜åŒ–åˆ—è¡¨é¡¹çš„ç¼©è¿›</h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒPyYAML è¾“å‡ºçš„åˆ—è¡¨ç¼©è¿›ä¸å…¶çˆ¶å…ƒç´ ä¸€è‡´ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<span class="n">a</span><span class="p">:</span>
<span class="o">-</span> <span class="mi">1</span>
<span class="o">-</span> <span class="mi">2</span>
<span class="o">-</span> <span class="mi">3</span>
</code></pre></div><p>è¿™å¹¶ä¸æ˜¯å¾ˆå¥½çš„æ ¼å¼ï¼Œæ ¹æ®
<a href="https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html">Ansible</a>
å’Œ <a href="https://developers.home-assistant.io/docs/documenting/yaml-style-guide/#block-style-sequences">HomeAssistant</a>
ç­‰ YAML ä¹¦å†™è§„èŒƒï¼Œåˆ—è¡¨é¡¹åº”è¯¥ç¼©è¿› 2 ç©ºæ ¼ã€‚</p>
<p>è¿™ç§æ ¼å¼ä¹Ÿä¼šå¯¹å¯¼è‡´åˆ—è¡¨é¡¹ä¸ä¼šè¢«å¦‚ VSCode ç­‰ç¼–è¾‘å™¨è¯†åˆ«ï¼Œè¿›è€Œæ— æ³•ä½¿ç”¨ç¼–è¾‘å™¨çš„æŠ˜å åŠŸèƒ½ã€‚</p>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨å¦‚ä¸‹ä»£ç ç‰‡æ®µï¼Œåœ¨ä»£ç ä¸­å®šä¹‰ <code>IndentDumper</code> class:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">IndentDumper</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">Dumper</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">increase_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indentless</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">IndentDumper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">increase_indent</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div><p>ç„¶åå°†å®ƒä¼ é€’ç»™ <code>yaml.dump</code> çš„ <code>Dumper</code> å…³é”®å­—å‚æ•°ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">Dumper</span><span class="o">=</span><span class="n">IndentDumper</span><span class="p">))</span>
<span class="n">a</span><span class="p">:</span>
  <span class="o">-</span> <span class="mi">1</span>
  <span class="o">-</span> <span class="mi">2</span>
  <span class="o">-</span> <span class="mi">3</span>
</code></pre></div><blockquote>
<p>æ³¨æ„ï¼Œ<code>yaml.safe_dump</code> ç”±äºæœ‰è‡ªå·±çš„ Dumper classï¼Œä¼ é€’æ­¤å‚æ•°ä¼šé€ æˆå†²çªã€‚</p>
</blockquote>
<h2 id="è¾“å‡ºå¯è¯»çš„-utf-8-å­—ç¬¦">è¾“å‡ºå¯è¯»çš„ UTF-8 å­—ç¬¦</h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒPyYAML å‡è®¾ä½ å¸Œæœ›è¾“å‡ºçš„ç»“æœé‡Œåªæœ‰ ASCII å­—ç¬¦ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;ä½ å¥½&#39;</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<span class="n">a</span><span class="p">:</span> <span class="s2">&#34;</span><span class="se">\u4F60\u597D</span><span class="s2">&#34;</span>
</code></pre></div><p>è¿™ä¼šè®©è¾“å‡ºç»“æœéå¸¸éš¾ä»¥é˜…è¯»ã€‚</p>
<p>åœ¨ UTF-8 è¶³å¤Ÿæ™®åŠçš„ä»Šå¤©ï¼Œç›´æ¥è¾“å‡º UTF-8 å­—ç¬¦æ˜¯éå¸¸å®‰å…¨çš„ã€‚
å› æ­¤æˆ‘ä»¬å¯ä»¥å°† <code>allow_unicode=True</code> ä¼ å…¥ <code>yaml.safe_dump</code> ä½¿ PyYAML å°† Unicode è½¬æ¢æˆ UTF-8 å­—ç¬¦ä¸²ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">a</span><span class="p">:</span> <span class="n">ä½ å¥½</span>
</code></pre></div><h2 id="ä¸€äº›-yaml-ç›¸å…³çš„åº“">ä¸€äº› YAML ç›¸å…³çš„åº“</h2>
<h3 id="oyaml">oyaml</h3>
<p>Link: <a href="https://github.com/wimglenn/oyaml">https://github.com/wimglenn/oyaml</a></p>
<p>æ­£å¦‚ä¸Šæ–‡ä¸­æåˆ°çš„ï¼Œoyaml æ˜¯ <code>yaml</code> åŒ…çš„æ›¿æ¢å“ï¼Œä½¿ <code>dict</code> keys çš„é¡ºåºåœ¨ dump/load çš„æ—¶å€™å¾—ä»¥ä¿ç•™ã€‚</p>
<p>oyaml æ˜¯ä¸€ä¸ªå•æ–‡ä»¶åº“ï¼Œåªæœ‰ <a href="https://github.com/wimglenn/oyaml/blob/d0195070d26bd982f1e4e604bded5510dd035cd7/oyaml.py">53 è¡Œä»£ç </a>ï¼Œå› æ­¤ä½¿ç”¨èµ·æ¥éå¸¸çµæ´»ï¼Œä½ å¯ä»¥ç›´æ¥æŠŠå®ƒçš„ä»£ç å¤åˆ¶åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œç„¶åæ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œä¿®æ”¹ã€‚</p>
<h3 id="strictyaml">strictyaml</h3>
<p>Link: <a href="https://github.com/crdoconnor/strictyaml">https://github.com/crdoconnor/strictyaml</a></p>
<p>æœ‰çš„äººè¯´ YAML è¿‡äºå¤æ‚å’Œçµæ´»ï¼Œä¸æ˜¯ä¸€ä¸ªå¥½çš„é…ç½®è¯­è¨€ã€‚ä½†æˆ‘è®¤ä¸ºè¿™ä¸æ˜¯ YAML çš„é—®é¢˜ï¼Œè€Œæ˜¯ä½¿ç”¨æ–¹å¼çš„é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬é™åˆ¶ç¨‹åºåªä½¿ç”¨ YAML çš„éƒ¨åˆ†åŠŸèƒ½ï¼ŒYAML å…¶å®å¯ä»¥å˜å¾—åƒå®ƒè®¾è®¡çš„é‚£èˆ¬å¥½ç”¨ã€‚</p>
<p>è¿™å°±æ˜¯ StrictYAML çš„è®¾è®¡æ„å›¾ï¼Œå®ƒæ˜¯ä¸€ä¸ªç±»å‹å®‰å…¨çš„ YAML è§£æå™¨ï¼Œå®ç°äº† YAML è§„èŒƒè¯´æ˜ä¸­çš„ä¸€ä¸ª<a href="https:c//hitchdev.com/strictyaml/features-removed">å­é›†</a>Â ã€‚</p>
<p>å¦‚æœä½ å¯¹ YAML çš„è¾“å…¥è¾“å‡ºæœ‰è¾ƒå¼ºçš„å®‰å…¨è€ƒè™‘ï¼Œå»ºè®®ä½¿ç”¨ StrictYAML ä»£æ›¿ PyYAMLã€‚</p>
<p>é¡ºå¸¦ä¸€æçš„æ˜¯ï¼ŒStrictYAML çš„<a href="https://hitchdev.com/strictyaml/">æ–‡æ¡£ç«™</a>æœ‰å¾ˆå¤šå…³äºè®¾è®¡ç»†èŠ‚å’Œé…ç½®è¯­è¨€æ€è€ƒçš„æ–‡ç« ï¼Œéå¸¸å€¼å¾—ä¸€çœ‹ã€‚</p>
<h3 id="ruamelyaml">ruamel.yaml</h3>
<p>Link: <a href="https://yaml.readthedocs.io/en/latest/overview.html">https://yaml.readthedocs.io/en/latest/overview.html</a></p>
<p>ruamel.yaml æ˜¯ PyYAML çš„ä¸€ä¸ªåˆ†å‰ï¼Œäº 2009 å¹´å‘å¸ƒå¹¶æŒç»­ç»´æŠ¤è‡³ä»Šã€‚</p>
<p>ruamel.yaml çš„æ–‡æ¡£é‡Œè¯¦ç»†è¯´æ˜äº†å®ƒå’Œ PyYAML çš„<a href="https://yaml.readthedocs.io/en/latest/pyyaml.html#yaml-1-2-support">å·®å¼‚</a>ã€‚
æ€»ä½“æ¥è¯´ï¼Œruamel.yaml ä¸“æ³¨åœ¨ <a href="https://yaml.org/spec/1.2.2/">YAML 1.2</a>  ä¸Šï¼Œå¯¹ä¸€äº›è¯­æ³•è¿›è¡Œäº†ä¼˜åŒ–ã€‚</p>
<p>ruamel.yaml æœ€ä»¤æˆ‘æ„Ÿå…´è¶£çš„ç‰¹æ€§æ˜¯è¾“å…¥è¾“å‡ºçš„ â€œround-tripâ€ï¼Œå¯ä»¥æœ€å¤§ç¨‹åº¦åœ°ä¿ç•™è¾“å…¥æºçš„åŸå§‹æ ¼å¼ã€‚å®˜æ–¹æ–‡æ¡£ä¸­çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p>
<blockquote>
<p>A round-trip is a YAML load-modify-save sequence and ruamel.yaml tries to preserve, among others:</p>
<ul>
<li>comments</li>
<li>block style and key ordering are kept, so you can diff the round-tripped source</li>
<li>flow style sequences ( â€˜a: b, c, dâ€™) (based on request and test by Anthony Sottile)</li>
<li>anchor names that are hand-crafted (i.e. not of the form<code>idNNN</code>)</li>
<li>mergesÂ in dictionaries are preserved</li>
</ul>
</blockquote>
<p>å¦‚æœä½ æœ‰å°½å¯èƒ½ä¿ç•™åŸå§‹æ ¼å¼çš„éœ€æ±‚ï¼Œå»ºè®®ä½¿ç”¨ ruamel.yaml ä»£æ›¿ PyYAMLã€‚</p>
<blockquote>
<p>åœ¨ä½¿ç”¨ä¸­æˆ‘æ³¨æ„åˆ° ruamel.yaml çš„ safe load æ–¹æ³• (<code>YAML(typ='safe').load</code>) ä¸ PyYAML æœ‰äº›ä¸åŒï¼Œå®ƒæ— æ³•è§£æ flow style çš„é›†åˆå®šä¹‰ (å¦‚ <code>a: {&quot;foo&quot;: &quot;bar&quot;}</code>)ï¼Œè¿™ç‚¹æ²¡æœ‰åœ¨æ–‡æ¡£ä¸­æåŠï¼Œä½¿ç”¨æ—¶é¡»å¤šåŠ æ³¨æ„ã€‚</p>
</blockquote>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>YAML æœ‰å®ƒå¥½çš„åœ°æ–¹å’Œåçš„åœ°æ–¹ã€‚å®ƒæ˜“äºé˜…è¯»ï¼ŒåˆæœŸçš„å­¦ä¹ æ›²çº¿éå¸¸å¹³ç¼“ã€‚
ä½† YAML çš„è§„èŒƒè¯´æ˜éå¸¸å¤æ‚ï¼Œä¸ä»…é€ æˆäº†ä½¿ç”¨ä¸­çš„æ··ä¹±ï¼Œä¹Ÿä½¿ä¸åŒè¯­è¨€çš„å®ç°åœ¨å¾ˆå¤šç»†å¾®çš„åœ°æ–¹éš¾ä»¥ä¿æŒä¸€è‡´ã€‚</p>
<p>å°½ç®¡æœ‰è¿™äº›å°æ¯›ç—…ï¼ŒYAML ä»ç„¶æ˜¯æˆ‘å¿ƒä¸­æœ€å¥½çš„é…ç½®è¯­è¨€ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« æ‰€ä»‹ç»çš„æŠ€å·§èƒ½å¤Ÿå¸®åŠ©ä½ é¿å…é—®é¢˜ï¼Œè·å¾—æ›´å¥½çš„å¼€å‘å’Œä½¿ç”¨ä½“éªŒã€‚</p>
]]></content:encoded></item><item><title>Tips that may save you from the hell of PyYAML</title><link>https://reorx.com/blog/python-yaml-tips/</link><pubDate>Sun, 15 May 2022 00:00:00 +0000</pubDate><guid>https://reorx.com/blog/python-yaml-tips/</guid><description>Try to make our life with PyYAML easier.</description><content:encoded><![CDATA[<p>YAML is a data-serialization language that is widely used.
As a developer, I&rsquo;m always dealing with YAML from time to time.
But processing YAML, especially using PyYAML in Python is painful and full of traps.
Here I want to share some tips and snippets that can make your life with PyYAML easier.</p>
<blockquote>
<p>Code in this article is only guaranteed to work in Python 3</p>
</blockquote>
<h2 id="always-use-safe_loadsafe_dump">Always use safe_load/safe_dump</h2>
<p>YAML&rsquo;s ability to construct an arbitrary Python object makes it dangerous to use blindly.
It might be harmful to your application to simply <code>yaml.load</code> a document from an untrusted source such as the Internet and user input.</p>
<p>See from <a href="https://pyyaml.org/wiki/PyYAMLDocumentation#loading-yaml">PyYAML official documentation</a>:</p>
<blockquote>
<p><strong>Warning</strong>: It is not safe to callÂ <code>yaml.load</code>Â with any data received from an untrusted source!Â <code>yaml.load</code>Â is as powerful asÂ <code>pickle.load</code>Â and so may call any Python function.</p>
</blockquote>
<p>In short, you should always use <code>yaml.safe_load</code> and <code>yaml.safe_dump</code> as the standard I/O methods for YAML.</p>
<h2 id="keep-keys-in-order-loaddump">Keep keys in order (load/dump)</h2>
<p>In Python 3.7+, the order of dict keys is naturally preserved <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>, thus the dict you get from <code>yaml.safe_load</code> has the same order of keys as the original file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">yaml</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;---
</span><span class="s2">... c: 1
</span><span class="s2">... b: 1
</span><span class="s2">... d: 1
</span><span class="s2">... a: 1
</span><span class="s2">... &#34;&#34;&#34;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span>
<span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span>
</code></pre></div><p>When dumping dict into a YAML string, make sure to add keyword argument <code>sort_keys=False</code> to preserve the order of keys.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<span class="n">a</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">b</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">c</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">d</span><span class="p">:</span> <span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">c</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">b</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">d</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">a</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">e</span><span class="p">:</span> <span class="mi">1</span>
</code></pre></div><p>If your Python version is lower, or you want to make sure the keys order preserving always works, you can use this library called <a href="https://github.com/wimglenn/oyaml">oyaml</a> as a drop-in replacement for <code>pyyaml</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">oyaml</span> <span class="k">as</span> <span class="nn">yaml</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span>
<span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">c</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">b</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">d</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">a</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">e</span><span class="p">:</span> <span class="mi">1</span>
</code></pre></div><h2 id="enhance-list-indentation-dump">Enhance list indentation (dump)</h2>
<p>By default, PyYAML indent list items on the same level as their parent.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<span class="n">a</span><span class="p">:</span>
<span class="o">-</span> <span class="mi">1</span>
<span class="o">-</span> <span class="mi">2</span>
<span class="o">-</span> <span class="mi">3</span>
</code></pre></div><p>This is not a good format according to style guides like
<a href="https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html">Ansible</a>
and <a href="https://developers.home-assistant.io/docs/documenting/yaml-style-guide/#block-style-sequences">HomeAssistant</a>.
It is also not recognized by code editors like VSCode, making the list items unfoldable in the editor.</p>
<p>To solve this problem, you can use the snippet below to define an <code>IndentDumper</code> class:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">IndentDumper</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">Dumper</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">increase_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indentless</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">IndentDumper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">increase_indent</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div><p>Then pass it to the <code>Dumper</code> keyword argument in <code>yaml.dump</code> function.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">Dumper</span><span class="o">=</span><span class="n">IndentDumper</span><span class="p">))</span>
<span class="n">a</span><span class="p">:</span>
  <span class="o">-</span> <span class="mi">1</span>
  <span class="o">-</span> <span class="mi">2</span>
  <span class="o">-</span> <span class="mi">3</span>
</code></pre></div><blockquote>
<p>Note that <code>Dumper</code> cannot be passed to <code>yaml.safe_dump</code> which has its owner dumper class defined.</p>
</blockquote>
<h2 id="output-readable-utf-8-dump">Output readable UTF-8 (dump)</h2>
<p>By default, PyYAML assumes the user only wants ASCII code in the output,
so it converts UTF-8 characters to Python&rsquo;s Unicode representation.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;ä½ å¥½&#39;</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<span class="n">a</span><span class="p">:</span> <span class="s2">&#34;</span><span class="se">\u4F60\u597D</span><span class="s2">&#34;</span>
</code></pre></div><p>This makes the output hard to read for humans.</p>
<p>In the modern world, UTF-8 is widely supported, it&rsquo;s safe to write UTF-8 in the output.
Pass <code>allow_unicode=True</code> to <code>yaml.safe_dump</code> to enable that.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">a</span><span class="p">:</span> <span class="n">ä½ å¥½</span>
</code></pre></div><h2 id="no-default_flow_style-needed-dump">No <code>default_flow_style</code> needed (dump)</h2>
<p>Most of the time we don&rsquo;t want <a href="https://yaml.org/spec/1.2.2/#chapter-7-flow-style-productions">flow style productions</a> in the output (i.e. no JSON in YAML).
According to <a href="https://pyyaml.org/wiki/PyYAMLDocumentation#dictionaries-without-nested-collections-are-not-dumped-correctly">PyYAML documentation</a>, <code>default_flow_style=False</code> should be passed to <code>yaml.safe_dump</code> to achieve that.</p>
<p>After digging into the source code of the latest PyYaml (6.0), I find it is not needed anymore.
You should remove this keyword argument to keep the code cleaner and less confusing.</p>
<p><img loading="lazy" src="/blog/python-yaml-tips/images/yaml-dump-all.png" alt=""  /></p>
<h2 id="libraries">Libraries</h2>
<h3 id="oyaml">oyaml</h3>
<p>Link: <a href="https://github.com/wimglenn/oyaml">https://github.com/wimglenn/oyaml</a></p>
<p>As mentioned above, oyaml is a drop-in replacement for PyYAML which preserves dict ordering.</p>
<p>I suggest using oyaml if you already use PyYAML in your code.</p>
<p>It&rsquo;s worth mentioning that oyaml is a single-file library with only <a href="https://github.com/wimglenn/oyaml/blob/d0195070d26bd982f1e4e604bded5510dd035cd7/oyaml.py">53 lines of code</a>.
This makes it very flexible to use, you can just copy the code to your library and customize it according to your need.</p>
<h3 id="strictyaml">strictyaml</h3>
<p>Link: <a href="https://github.com/crdoconnor/strictyaml">https://github.com/crdoconnor/strictyaml</a></p>
<p>Some people say YAML is too complex and flexible to be a good configuration language,
but I think this is not the problem of YAML, but the problem of how we use it.
If we restrict our usage to only a subset of its features, it will be as good as it should be.</p>
<p>This is where StrictYAML came up. It is aÂ type-safeÂ YAML parser that parses and validates aÂ <a href="https://hitchdev.com/strictyaml/features-removed">restricted subset</a>Â of theÂ YAMLÂ specification.</p>
<p>I suggest using StrictYAML if you have strong security concerns for your application.</p>
<p>There are tons of great articles on the <a href="https://hitchdev.com/strictyaml/">documentation site</a> of strictyaml, definitely worth having a look at if you have thought about YAML and other configuration languages.</p>
<h3 id="ruamel-yaml">ruamel. yaml</h3>
<p>Link: <a href="https://yaml.readthedocs.io/en/latest/overview.html">https://yaml.readthedocs.io/en/latest/overview.html</a></p>
<p>ruamel.yaml is a fork of PyYAML, it was released in 2009 and continuously maintained in the past decade.</p>
<p>The differences with PyYAML are listed <a href="https://yaml.readthedocs.io/en/latest/pyyaml.html#yaml-1-2-support">here</a>. Generally, ruamel.yaml focuses on <a href="https://yaml.org/spec/1.2.2/">YAML 1.2</a>  with some opinionated enhancements for the syntax.</p>
<p>What interests me most is the ability to round-trip in the loading/dumping process. It works like black magic. Here&rsquo;s the explanation from ruamel.yaml documentation:</p>
<blockquote>
<p>A round-trip is a YAML load-modify-save sequence and ruamel.yaml tries to preserve, among others:</p>
<ul>
<li>comments</li>
<li>block style and key ordering are kept, so you can diff the round-tripped source</li>
<li>flow style sequences ( â€˜a: b, c, dâ€™) (based on request and test by Anthony Sottile)</li>
<li>anchor names that are hand-crafted (i.e. not of the form<code>idNNN</code>)</li>
<li>mergesÂ in dictionaries are preserved</li>
</ul>
</blockquote>
<p>I suggest using ruamel.yaml if you have the requirement to preserve the original content as much as possible.</p>
<blockquote>
<p>One thing I notice is that ruamel.yaml&rsquo;s <code>safe_load</code> method (<code>YAML(typ='safe').load</code>) cannot parse flow style collection (<code>a: {&quot;foo&quot;: &quot;bar&quot;}</code>), this is a undocumented difference with PyYAML.</p>
</blockquote>
<h2 id="summary">Summary</h2>
<p>YAML has its good and bad. It&rsquo;s easy to read, the learning curve is mild at the beginning,
but the specification is complex, which not only causes chaos in practice, but also makes implementations in different languages inconsistent with each other in many trivial aspects.</p>
<p>Despite these quirks, YAML is still the best configuration language for me, and as long as we can use it properly, problems will be avoided and the experience will be much better.</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>See <a href="https://docs.python.org/3/whatsnew/3.7.html#:~:text=the%20insertion%2Dorder%20preservation%20nature%20of%20dict%20objects%20has%20been%20declared%20to%20be%20an%20official%20part%20of%20the%20Python%20language%20spec.">Whatâ€™s New In Python 3.7</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></content:encoded></item><item><title>é‡æ–°å¼€å§‹ä½¿ç”¨ RSS é˜…è¯»å™¨</title><link>https://reorx.com/blog/reinitiate-rss-reader/</link><pubDate>Thu, 12 May 2022 00:00:00 +0000</pubDate><guid>https://reorx.com/blog/reinitiate-rss-reader/</guid><description>ç®€å•æ˜ç¡®çš„å°è¯•ï¼Œå¸¦æ¥æ„æƒ³ä¸åˆ°çš„æ”¶è·</description><content:encoded><![CDATA[<h2 id="ä¸ç®—æˆåŠŸçš„å¼€ç«¯">ä¸ç®—æˆåŠŸçš„å¼€ç«¯</h2>
<p>æˆ‘æ›¾ç»æ˜¯ä¸€ä¸ªç³Ÿç³•çš„ RSS ç”¨æˆ·ã€‚</p>
<p>æ—©åœ¨ Google Reader æµè¡Œçš„æ—¶æœŸï¼Œæˆ‘å°±çƒ­è¡·äºå°†æˆ‘æ„Ÿå…´è¶£çš„èµ„è®¯ç½‘ç«™å’Œåšå®¢è®¢é˜…åˆ° Google Reader ä¸­ <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>ï¼ŒæœŸç›¼ç€èƒ½ä»è¿™äº›ä¿¡æ¯ä¸­è·å¾—æœ‰ä»·å€¼çš„ä¸œè¥¿ï¼Œå´æ€»æ˜¯å› ä¸ºæ‡’æˆ–è€…å¿˜äº†è€Œä¸èƒ½åŠæ—¶æŸ¥çœ‹ã€‚éšç€æœªè¯»æ•°çš„å¢å¤šï¼Œç„¦è™‘æ„Ÿè¶Šæ¥è¶Šå¼ºçƒˆï¼Œæœ€åç´¢æ€§ä¸å†æ‰“å¼€é˜…è¯»å™¨ï¼Œå®‰æ…°è‡ªå·±ä»¥åæ€»ä¼šå»çœ‹çš„ï¼Œåªè¦è®¢é˜…äº†å°±è¡Œï¼Œæ²‰æµ¸åœ¨è™šå‡çš„æ»¡è¶³æ„Ÿä¸­ã€‚</p>
<p>æˆ‘å°±åƒä¸€ä¸ªå–œæ¬¢å±¯ä¹¦çš„äººï¼Œåœ¨ RSS é˜…è¯»å™¨è¿™ä¸ªä¹¦æ¶ä¸Šæ‘†æ»¡äº†æ”¾ä¸Šå»å°±å†ä¹Ÿæ²¡åŠ¨è¿‡çš„ä¹¦<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>ã€‚</p>
<p>åæ¥æˆ‘è®¤è¯†åˆ°ï¼Œè‡ªå·±å¾—äº†ä¿¡æ¯èµ„æºçš„å›¤ç§¯ç—…ï¼Œç»è¿‡é•¿æ—¶é—´çš„åæ€åï¼Œæˆ‘ä¸‹å†³å¿ƒæ¸…ç† RSS è®¢é˜…æºã€‚</p>
<p>æˆ‘åˆ é™¤äº†æ‰€æœ‰èµ„è®¯ç±»ç½‘ç«™ï¼Œåªç•™ä¸‹ä¸ªäººåšå®¢ï¼›å»æ‰é•¿æœŸæœªæ›´æ–°çš„ï¼Œå¹¶é‡æ–°å®¡è§†æ¯ä¸ªåšå®¢æ˜¯å¦æ˜¯æˆ‘çœŸæ­£æƒ³è¦å»é˜…è¯»çš„ã€‚æœ€ç»ˆç•™ä¸‹å¤§çº¦ 30 å¤šä¸ª RSS æºï¼Œæ¯å‘¨çš„æ›´æ–°é‡è¢«æ§åˆ¶åœ¨ 10-20 ä¹‹é—´ã€‚è‡ªæ­¤ä»¥åï¼Œæˆ‘æ‰çœŸæ­£åšåˆ°é˜…è¯»æ¯ç¯‡æ›´æ–°ï¼Œä¹Ÿæ²¡æœ‰å†å› ä¸ºæœªè¯»æ•°é‡è€Œç„¦è™‘äº†ã€‚</p>
<p>å†ä¹‹åï¼Œæˆ‘çœ‹åˆ°è®¸å¤šäººåˆ†äº«è‡ªå·±çš„ RSS ä½¿ç”¨ç»éªŒ<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>ï¼Œå°† RSS ä½œä¸ºè·å–ä¿¡æ¯çš„æ•ˆç‡å·¥å…·ï¼Œèšåˆå’Œç­›é€‰èµ„è®¯ï¼Œç”šè‡³æˆä¸º all-in-one çš„ä¿¡æ¯è¾“å…¥æ¸ é“ã€‚è¿™äº›æ–‡ç« å¶å°”ä¼šè®©æˆ‘è ¢è ¢æ¬²åŠ¨ï¼Œä½†å› æ‹…å¿ƒæ‘„å…¥å‹åŠ›è¿‡å¤§è€Œé‡è¹ˆè¦†è¾™ï¼Œæˆ‘æ€»æ˜¯å¾ˆå¿«ç†„ç­äº†å°è¯•çš„æƒ³æ³•ã€‚</p>
<p>å°±è¿™æ ·ï¼Œæˆ‘ä»ä¸€ä¸ªç³Ÿç³•çš„ RSS ç”¨æˆ·ï¼Œå˜æˆäº†ä¸€ä¸ªå…‹åˆ¶ä½†ä½æ•ˆçš„ç”¨æˆ·ï¼Œä¸å†æ¯å¤©ä½¿ç”¨ï¼Œåªåœ¨æœ‰æé†’æ—¶æ‰“å¼€çœ‹çœ‹åšå®¢çš„æ›´æ–°ã€‚ç”Ÿæ´»ç»§ç»­ã€‚</p>
<h2 id="é‡æ–°å‘ç°-rss">é‡æ–°å‘ç° RSS</h2>
<p>æœ€è¿‘æˆ‘å¼€å§‹ç»å¸¸é€› V2EX ã€‚æˆ‘æœ€æ—©çš„æ´»è·ƒæ—¶æœŸæ˜¯ 2010~2013ï¼Œåæ¥å› ä¸ºæ²‰è¿·å·¥ä½œï¼Œå’Œé™Œç”Ÿäººçš„äº¤æµæ¬²é™ä½ï¼Œå…´è¶£è½¬ç§»åˆ° Twitterã€‚ä»Šå¹´è‡ªç”±å·¥ä½œåï¼Œæ€ç»´åˆæ´»è·ƒèµ·æ¥ï¼Œå›è¿‡å¤´æ¥å‘ç°ç»è¿‡ 10 å¹´æ—¶é—´ï¼ŒV2EX ä¾ç„¶æ˜¯å›½å†…æœ€å¥½çš„å¼€å‘è€…ç¤¾åŒºã€‚</p>
<p>V2EX æœ‰ç€ä¸°å¯Œçš„ RSS æ”¯æŒï¼Œåœ¨ <a href="https://v2ex.com/notifications">V2EX Â â€ºÂ  æé†’ç³»ç»Ÿ</a> é¡µé¢å¯ä»¥è·å¾—æé†’çš„ RSS è®¢é˜…æºã€‚ä¸ºäº†åŠæ—¶æ”¶åˆ°æ¶ˆæ¯é€šçŸ¥ï¼Œæˆ‘å¼€å§‹ç¢ç£¨å¦‚ä½•åˆ©ç”¨è¿™ä¸€åŠŸèƒ½ï¼Œäºæ˜¯æ•´ç†äº†ä¸‹éœ€æ±‚ï¼š</p>
<ul>
<li>ç›´æ¥è®¢é˜… RSSï¼Œä¸éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹æœåŠ¡</li>
<li>æ”¯æŒ macOS å’Œ iOSï¼ŒåŒæ­¥æœªè¯»æ¡ç›®</li>
<li>ç®€æ´æ¸…çˆ½çš„ç•Œé¢</li>
</ul>
<p>å¾ˆå¿«ï¼Œæˆ‘é”å®šäº†å®Œç¾æ»¡è¶³è¿™ä¸‰ç‚¹çš„ <a href="https://github.com/Ranchero-Software/NetNewsWire">NetNewsWire</a></p>
<p><img loading="lazy" src="/blog/reinitiate-rss-reader/images/netnewswire-1.png" alt=""  /></p>
<p>NetNewsWire å‘å¸ƒäº 20 å¹´å‰ï¼Œæ˜¯ macOS ä¸Šå†å²æœ€æ‚ ä¹…çš„ RSS é˜…è¯»å™¨ã€‚æˆ‘è™½ç„¶å¾ˆæ—©å°±çŸ¥é“å®ƒï¼Œå´ä¸€ç›´æ²¡æœ‰å°è¯•ï¼Œä½¿ç”¨çš„æ˜¯æ›´å—è¿½æ§çš„ Reederï¼Œä½† Reeder æœ€è¿‘çš„å‡ æ¬¡ä»˜è´¹æ›´æ–°æœ‰äº›ä»¤äººå¤±æœ›ï¼Œæ²¡æœ‰ä»€ä¹ˆæœ‰è¶£çš„å˜æ›´ï¼Œæˆ‘ä¹ŸåŒå€¦äº†å®ƒé‚£è½¯ç»µç»µçš„ UI é£æ ¼ã€‚</p>
<p>NetNewsWire è®©æˆ‘çœ¼å‰ä¸€äº®ï¼Œå®ƒä½¿ç”¨ macOS åŸç”Ÿçš„ UI ç»„ä»¶ï¼Œé€‚åº”èµ·æ¥æ²¡æœ‰ä»»ä½•éšœç¢ã€‚æ‰“å¼€å°±ç®—ç»å…¸çš„ä¸‰æ å¸ƒå±€ï¼Œæ²¡æœ‰å¤šä½™çš„é€‰é¡¹ï¼Œè®©æˆ‘æ„Ÿè§‰çœŸæ­£åœ¨ä½¿ç”¨ä¸€ä¸ªä¿¡æ¯ç»„ç»‡å·¥å…·ï¼Œè€Œéå¦ä¸€ä¸ªæ¼‚äº®çš„ç©å…·ã€‚</p>
<p>Minimal and no distraction, è¿™æ˜¯æˆ‘å¯¹ NetNewsWire çš„æ•´ä½“å°è±¡ã€‚æˆ‘å¾ˆå¿«å°±çˆ±ä¸Šäº†å®ƒï¼Œé€æ¸æŠŠæˆ‘å…¶ä»–å‡ ä¸ªæ­£åœ¨æ‘„å–çš„ä¿¡æ¯æºä¹Ÿæ·»åŠ äº†ä¸Šå»ã€‚</p>
<p>ç°åœ¨æˆ‘çš„ RSS è®¢é˜…ç»“æ„æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>
<p>V2EX</p>
<ul>
<li>
<p>èŠ‚ç‚¹</p>
<p>æˆ‘åªå¯¹ä¸€äº›ç‰¹å®šçš„èŠ‚ç‚¹æœ‰é€æ¡æµè§ˆçš„å…´è¶£ï¼ŒV2EX æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥è¾“å‡º RSSï¼Œåªéœ€è¦å°† <code>https://v2ex.com/feed/{node}.xml</code> çš„ <code>{node}</code> æ›¿æ¢ä¸ºèŠ‚ç‚¹çš„è‹±æ–‡åå³å¯ã€‚</p>
<ul>
<li><a href="https://v2ex.com/feed/create.xml">åˆ†äº«åˆ›é€ </a></li>
<li><a href="https://v2ex.com/feed/share.xml">åˆ†äº«å‘ç°</a></li>
<li><a href="https://v2ex.com/feed/programmer.xml">ç¨‹åºå‘˜</a></li>
</ul>
</li>
<li>
<p><a href="https://rsshub.app/v2ex/topics/hot">Top Topics</a></p>
<p>V2EX æœ¬èº«æ²¡æœ‰æœ€çƒ­è¯é¢˜çš„ RSSï¼Œå¹¸è¿çš„æ˜¯ï¼ŒRSSHub æä¾›äº†ä¸€ä¸ªå…¬å¼€çš„æºã€‚</p>
</li>
</ul>
</li>
<li>
<p><a href="https://rsshub.app/telegram/channel/hacker_news_feed">Hacker News</a></p>
<p>Hackers News çš„ä¿¡æ¯é‡å¤ªå¤§ï¼Œä¸é€‚åˆç›´æ¥è®¢é˜…ï¼Œå¥½åœ¨ <a href="https://t.me/hacker_news_feed">hacker_news_feed</a> è¿™ä¸ª Telegram é¢‘é“å¯¹å†…å®¹è¿›è¡Œäº†ç­›é€‰ï¼Œåªæ¨é€åˆ†æ•°å¤§äº 100 çš„æ¡ç›®ã€‚åŒæ ·è¦æ„Ÿè°¢ RSSHubï¼Œç”¨å®ƒå°† Telegram é¢‘é“è½¬æ¢æˆäº† RSS feedã€‚</p>
</li>
<li>
<p>Obsidian</p>
<p>ä½œä¸º Obsidian é‡åº¦ä½¿ç”¨è€…å’Œæ’ä»¶ç»´æŠ¤è€…ï¼Œæˆ‘éå¸¸å…³æ³¨ç¤¾åŒºçš„åŠ¨å‘ã€‚Obsidian ç¤¾åŒºä¿¡æ¯ä¸»è¦æ¥è‡ªäº<a href="https://forum.obsidian.md/">å®˜æ–¹ Discourse è®ºå›</a>å’Œ <a href="https://www.reddit.com/r/ObsidianMD/">subreddit</a>ã€‚ä¸¤è€…éƒ½æ˜¯é€šè¿‡åœ¨ URL åé¢åŠ ä¸Š <code>.rss</code> å³å¯è·å¾—è®¢é˜…æºï¼ˆå¦‚ <a href="https://forum.obsidian.md/c/share-showcase/9.rss">Showcase</a> å’Œ <a href="https://www.reddit.com/r/ObsidianMD.rss">ObsidianMD</a>ï¼‰</p>
</li>
<li>
<p>æé†’</p>
<ul>
<li>V2EX</li>
<li><a href="https://www.reddit.com/prefs/feeds/">Reddit Unread</a></li>
</ul>
</li>
</ul>
<p>ç»è¿‡ä¸€æ®µæ—¶é—´çš„ä½¿ç”¨ï¼Œæˆ‘å¼€å¿ƒåœ°å‘ç°ï¼Œè‡ªå·±å·²ç»èƒ½æ¯æ—¥æœ‰æ•ˆæ‘„å…¥ä¸Šç™¾æ¡ä¿¡æ¯è€Œæ²¡æœ‰ç„¦è™‘ã€‚æˆ‘é€šå¸¸æ˜¯åœ¨ç¢ç‰‡æ—¶é—´æ‰“å¼€æ‰‹æœºè§‚çœ‹ï¼Œæ¯”å¦‚æ—©ä¸Šè¹²é©¬æ¡¶æ—¶ã€è¿åŠ¨åå’Œç¡å‰ã€‚å½“é‡åˆ°æœ‰è¶£çš„ä¿¡æ¯æ—¶ï¼Œå°±ç‚¹å‡» Star æ”¶è—ï¼Œå¦‚æœç‰¹åˆ«éœ€è¦å…³æ³¨æˆ–åç»­è°ƒç ”ï¼Œå°±åœ¨ TickTick æ·»åŠ ä¸€ä¸ªå¯¹åº”çš„ TODO é¡¹ã€‚è¦æ˜¯å¿™èµ·æ¥ç§¯æ”’äº†è®¸å¤šæœªè¯»ï¼Œæˆ‘å°±å¿«é€Ÿåˆ’è¿‡å¿«é€Ÿ Starï¼Œç„¶åä¸€æ¬¡æ€§ Mark All as Readã€‚</p>
<h2 id="è¿›ä¸€æ­¥ä¼˜åŒ–">è¿›ä¸€æ­¥ä¼˜åŒ–</h2>
<p>V2EX çš„ç¨‹åºå‘˜èŠ‚ç‚¹ä¸­ç»å¸¸å‡ºç° Java ç›¸å…³çš„è¯é¢˜ï¼Œä½†æˆ‘çš„æŠ€èƒ½ä½“ç³»ä¸ Java æ— å…³ï¼Œå› æ­¤æˆ‘æƒ³è¿‡æ»¤æ‰è¿™äº›å¯¹æˆ‘è€Œè¨€æ— ç”¨çš„ä¿¡æ¯ã€‚</p>
<p>NetNewsWire æœ‰ä¸€ä¸ªç›¸å…³çš„ <a href="https://github.com/Ranchero-Software/NetNewsWire/issues/1864">issue</a>ï¼Œå´å¹¶æ²¡æœ‰å®ç°ã€‚Inoreader å’Œ Tiny Tiny RSS ç­‰èšåˆå™¨è™½ç„¶æ”¯æŒï¼Œä½†æˆ‘å¸Œæœ›ä¿æŒç›®å‰ç›´æ¥è®¢é˜…åŸå§‹ RSS æºçš„å·¥ä½œæµï¼Œä¸æƒ³å¼•å…¥å¦ä¸€ä¸ªå·¥å…·å¢åŠ å¤æ‚åº¦ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>æˆ‘å†³å®šè‡ªå·±å¼€å‘ä¸€ä¸ªè½»é‡çš„ serverless æœåŠ¡: <a href="https://github.com/reorx/rss-filter">rss-filter</a>ã€‚ï¼ˆç°åœ¨è¿˜æ²¡æœ‰å®Œæˆï¼Œæ‰€ä»¥è¯»è€…æœ‹å‹ä»¬å¯ä»¥ä¸æ€¥ç€ star é¼“åŠ±ã€‚ï¼‰</p>
<p>rss-filter çš„å¤§è‡´è®¾è®¡å¦‚ä¸‹ï¼š</p>
<ul>
<li>éƒ¨ç½²åœ¨ serverless å¹³å°</li>
<li>é€šè¿‡ url å‚æ•°ä½¿ç”¨
<ul>
<li><code>rss</code>: rss url</li>
<li><code>exclude_text[]</code>: regex to exclude items from text (title, description, content)</li>
<li><code>exclude_text[]</code>: regex to include items from text
<ul>
<li>if both include and exclude are provided, apply include before exclude.</li>
</ul>
</li>
<li><code>cache_seconds</code>: seconds to cache the result</li>
<li><code>debug</code>: if true, return a json to debug</li>
<li><code>token</code>: prevent abuse by anonymous users</li>
<li><code>full_content</code>: fetch full content of each item</li>
</ul>
</li>
</ul>
<p>æˆ‘è®¾æƒ³  rss-filter å®Œæˆåï¼Œåªéœ€è¦ç®€å•çš„è®¾å®šå‚æ•°å³å¯åˆ›é€ ä¸€ä¸ªè¿‡æ»¤åçš„ RSS æºã€‚æ¯”å¦‚æˆ‘æƒ³è¦ä»ç¨‹åºå‘˜èŠ‚ç‚¹è¿‡æ»¤æ‰ Java ç›¸å…³çš„æ¡ç›®ï¼Œé‚£ä¹ˆæ–°çš„ RSS æºåº”ä¸º:</p>
<pre tabindex="0"><code>https://rss-filter.reorx.com/filter?rss=https%3A%2F%2Fv2ex.com%2Ffeed%2Fprogrammer.xml&amp;exclude_text=java%7Cspring+%3Fboot%7Clog4j&amp;cache_seconds=600
</code></pre><p>å…¶ä¸­ <code>exclude_text</code> ä¸º <code>java|spring ?boot|log4j</code>ï¼Œç”¨æ­£åˆ™åŒ¹é…å¤šç§ä¸åŒçš„å…³é”®è¯ã€‚</p>
<h2 id="ä¸€äº›æ€è€ƒ">ä¸€äº›æ€è€ƒ</h2>
<p>RSS çš„ç”¨æ³•å› äººè€Œå¼‚ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦ç›®çš„æ˜¯åˆ†äº«æˆ‘ä¸ªäººçš„æ¢ç´¢è¿‡ç¨‹ï¼Œå¸Œæœ›å¸¦ç»™è¯»è€…ä¸€äº›å€Ÿé‰´ã€‚é€‰æ‹©é€‚åˆè‡ªå·±çš„ï¼Œä¸è¦ç›²ç›®è¿½æ±‚åˆ«äººçœ‹èµ·æ¥ã€Œé«˜æ•ˆã€ã€Œå¼ºå¤§ã€çš„å·¥ä½œæµã€‚</p>
<p>å‰å‡ å¤© <a href="https://taoshu.in/">æ¶›å”</a> å‘æˆ‘æ¨èäº†ä»–çš„ <a href="https://taoshu.in/webfeed/web-feed.html">WebFeed</a> æ’ä»¶ (for Firefox)ï¼Œå®ƒæŠŠæµè§ˆå™¨å˜æˆ RSS é˜…è¯»å™¨ï¼Œå¹¶èƒ½è‡ªåŠ¨å‘ç°ç½‘ç«™çš„ RSS æºã€‚</p>
<p><img loading="lazy" src="/blog/reinitiate-rss-reader/images/webfeed.png" alt=""  /></p>
<p>æˆ‘å¾ˆå–œæ¬¢å®ƒçš„ Web ä¸ RSS ä¸€ä½“çš„ä½¿ç”¨ä½“éªŒï¼Œè¿™è®©æˆ‘å¼€å§‹æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä½•è¿‘äº›å¹´æ¥ RSS é€æ¸å¼å¾®ï¼Œä¸»æµæµè§ˆå™¨å‚å•†æ²¡æœ‰åšä»»ä½•ç›¸å…³çš„æ”¯æŒ<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>ï¼Œåªæœ‰å°‘éƒ¨åˆ†å¼€æºçˆ±å¥½è€…è¿˜åœ¨åšæŒä½¿ç”¨å¹¶ä¸º RSS ç¤¾åŒºåšå‡ºè´¡çŒ®ã€‚</p>
<p>æˆ‘èƒ½æƒ³åˆ°çš„ç­”æ¡ˆä¹‹ä¸€æ˜¯ï¼Œå•†ä¸šå…¬å¸åœ¨æ§åˆ¶å’Œå¼•å¯¼äº’è”ç½‘ç”Ÿæ€ï¼Œå°†å…¬å¼€æµé‡å˜æˆè‡ªå·±çš„ç§åŸŸæµé‡ã€‚è€Œä¸»æµæµè§ˆå™¨èƒŒåæ­£å¥½ä¹Ÿéƒ½æ˜¯å•†ä¸šå…¬å¸ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ‰€æœ‰å†…å®¹éƒ½æ¥è‡ªäºç‹¬ç«‹åšå®¢çš„ RSSï¼Œä½œè€…å¯ä»¥ç›´è¾¾å—ä¼—ï¼Œé‚£å†…å®¹åˆ†å‘å¸‚åœºçš„å•†ä¸šä»·å€¼å°±æ²¡ä»–ä»¬ä»€ä¹ˆäº‹äº†ï¼Œæ›´ä¸ç”¨è¯´å°†ç”¨æˆ·ç»‘å®šåœ¨è‡ªå·±çš„å¹³å°ä¸Šã€‚</p>
<p>å¦ä¸€ä¸ªåŸå› å¯èƒ½æ˜¯å†…å®¹å†œåœºçš„è‚†è™ï¼Œç‹¬ç«‹åˆ›ä½œè€…å¾ˆéš¾é è‡ªå·±å°†åŸåˆ›å†…å®¹æ¨å¹¿ï¼Œå†…å®¹å†œåœºå´é€šè¿‡ SEO æŠ€æœ¯å°†è‡ªå·±æ´—ç¨¿åçš„æ–‡ç« é¡¶åœ¨äº†æœç´¢ç»“æœçš„å‰é¢ã€‚å…³äºè¿™ä¸ªé—®é¢˜ï¼Œå°‘æ•°æ´¾æœ‰ä¸€ç¯‡æ–‡ç« å€¼å¾—ä¸€è¯»ï¼š <a href="https://sspai.com/post/71637">å°‘æ•°æ´¾æ€è€ƒ 007ï¼šå…³äº RSS</a>ã€‚</p>
<p>è¿™æ˜¯ä¸€åœºæ²¡æœ‰ç¡çƒŸçš„æˆ˜äº‰ï¼Œå•†ä¸šå·¨å¤´ä»¬å°±åƒ<a href="https://zh.wikipedia.org/wiki/%E5%9C%B0%E7%90%86%E5%A4%A7%E5%8F%91%E7%8E%B0">åœ°ç†å¤§å‘ç°</a>æ—¶æœŸçš„è¥¿æ–¹æ–‡æ˜ï¼Œåœ¨å¼€æ”¾äº’è”ç½‘çš„è’™æ˜§ä¹‹åœ°å¤§è‚†å¼€æ‹“æ®–æ°‘åœ°ã€‚å›½å¤–è¿‘äº›å¹´æ¥è¿˜æœ‰ Mediumã€Newsletter ç­‰å¤šç§å½¢å¼çš„å†…å®¹åˆ†å‘æ¨¡å¼ç™¾èŠ±é½æ”¾ï¼Œå›½å†…å·²ç»è¢«å¤´æ¡ã€å¾®ä¿¡ã€å¾®åšã€ç™¾åº¦å®Œæˆç“œåˆ†å’Œé•‡å‹ï¼Œæ²¦ä¸ºæ²¡æœ‰ç”Ÿæœºçš„ç„¦åœŸã€‚</p>
<p>ä½†å³ä½¿åœ¨è¿™æ ·çš„ç¯å¢ƒä¸‹ï¼Œæˆ‘è¿˜æ˜¯å¸Œæœ›èƒ½æˆä¸ºä¸€ä¸ªçº¯ç²¹çš„å†…å®¹åˆ›ä½œè€…ï¼Œä¸ºåˆ«äººå¸¦æ¥å¯å‘å’Œå¸®åŠ©ï¼Œä¸ºè‡ªå·±å®ç°å­¦ä¹ å’Œæ€è€ƒçš„ä»·å€¼ã€‚</p>
<p>æ¬¢è¿ä½ æ¥è®¢é˜…æˆ‘çš„åšå®¢:</p>
<p class="standout">
  <a href="https://reorx.com/feed.xml">https://reorx.com/feed.xml</a>
</p>

<p>æœ€åæ¨èä¸€ç¯‡æ–‡ç«  <a href="https://kevincox.ca/2022/05/06/rss-feed-best-practices/">RSS Feed Best Practises</a>ï¼Œ å¦‚æœä½ ä¹Ÿæ˜¯ä¸€åç»´æŠ¤è‡ªå·±åšå®¢çš„ webmasterï¼Œå¯ä»¥äº†è§£ä¸‹å¦‚ä½•ä¼˜åŒ–è‡ªå·±ç½‘ç«™è¾“å‡ºçš„ RSSã€‚</p>
<p>æ¯”å¦‚åŠ ä¸Š <code>&lt;link&gt;</code> tag ä½¿ RSS URL å¯ä»¥è¢«ä¸»æµå·¥å…·è‡ªåŠ¨å‘ç°:</p>
<pre tabindex="0"><code>&lt;link rel=alternate title=&quot;Blog Posts&quot; type=application/atom+xml href=&quot;/feed.atom&quot;&gt;
</code></pre><p>æ¯”å¦‚æœ€å¥½åœ¨ RSS ä¸­é™„å¸¦å…¨æ–‡ï¼š</p>
<blockquote>
<p>It is generally recommended to provide the full content of your posts in the feed. This is what most readers prefer. Atom has both <code>&lt;summary&gt;</code> element for readers that prefer it. For RSS and the Atom <code>&lt;content&gt;</code> element the full article should be included.</p>
</blockquote>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>å½“æ—¶ä½¿ç”¨äº†ä¸€æ¬¾ Chrome æ’ä»¶ï¼Œä¼šè‡ªåŠ¨æ£€æµ‹å½“å‰ç½‘é¡µå¯ç”¨çš„ RSS æºï¼Œå¦‚æœæœ‰çš„è¯ï¼Œä¼šåœ¨åœ°å€æ é‡Œæ˜¾ç¤º RSS å›¾æ ‡ï¼Œç‚¹å‡»å›¾æ ‡å°±èƒ½çœ‹è§ Google Reader ä¸­çš„ç›®å½•åˆ†ç±»ï¼Œå‹¾é€‰å³æ˜¯å°† RSS è®¢é˜…åˆ°æŒ‡å®šåˆ†ç±»ä¸­ã€‚æˆ‘éå¸¸å–œæ¬¢è¿™ä¸ªæ’ä»¶ï¼Œå¯æƒœåæ¥ Chrome å»æ‰äº†åœ°å€æ å›¾æ ‡çš„ APIï¼Œå†ä¹Ÿæ— æ³•å®ç°ç›¸ä¼¼çš„åŠŸèƒ½äº†ã€‚&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>äº¦åƒä¸€ä¸ªå–œæ¬¢åœ¨ Steam å±¯æ¸¸æˆçš„äººï¼Œä¹°äº†ä¸Šåƒä¸ªæ¸¸æˆï¼Œä½†æ¯å¤©ç©çš„è¿˜æ˜¯ Dota 2, CS GO, GTA 5&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>Chrome èƒŒåçš„ Googleï¼Œåœ¨æ‰‹æœº app ä¸Šå®ç°äº†è‡ªå·±çš„ <a href="https://support.google.com/websearch/answer/2819496?hl=en&amp;co=GENIE.Platform%3DAndroid">Discover Feed</a> ; Edge æœ‰ä¸€ä¸ªå« <a href="https://support.microsoft.com/en-us/microsoft-edge/organize-your-ideas-with-collections-in-microsoft-edge-60fd7bba-6cfd-00b9-3787-b197231b507e">Collections</a> çš„åŠŸèƒ½ï¼Œå¯ä»¥ â€œFollowâ€ ä¸€ä¸ªç½‘ç«™çš„æ›´æ–°ã€‚é‚£ä¸ºä»€ä¹ˆæˆ‘è¦è¯´æ²¡æœ‰æ”¯æŒå‘¢ï¼Ÿå› ä¸ºè¿™äº›éƒ½ä¸æ˜¯çœŸæ­£çš„ RSSï¼Œå®ƒä»¬èƒŒåçš„æŠ€æœ¯å¯èƒ½è¿˜æ˜¯ RSS ï¼Œä½†åœ¨äº§å“ä¸Šéƒ½åˆ»æ„å¿½ç•¥ RSSã€å¼ºè°ƒè‡ªå·±çš„åè¯ã€‚ä»–ä»¬å„é€ è½®å­å®ç°è‡ªå·±çš„ç§æœ‰åŠŸèƒ½ï¼Œä»æ˜¯ä¸ºäº†å°†ç”¨æˆ·å…³åœ¨è‡ªå·±çš„ä¿¡æ¯èŒ§æˆ¿ä¸­ã€‚&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></content:encoded></item><item><title>æˆ‘çš„ Vim è‡ªåŠ¨è¡¥å…¨é…ç½®å˜è¿å²</title><link>https://reorx.com/blog/the-history-of-my-vim-completion-config/</link><pubDate>Sat, 07 May 2022 00:00:00 +0000</pubDate><guid>https://reorx.com/blog/the-history-of-my-vim-completion-config/</guid><description>è®°å½•äº†ä» 2017 å¹´è‡³ä»Šï¼Œæˆ‘çš„ Vim è‡ªåŠ¨è¡¥å…¨é…ç½®çš„æ¯æ¬¡å˜æ›´ï¼Œä»ä¸­çª¥è§ Vim ç”Ÿæ€å‘å±•çš„ä¸€è§’ï¼Œä¹Ÿçºªå¿µè¿™äº›æ›¾ç»ç»™æˆ‘å¸¦æ¥è¿‡ä¾¿åˆ©ï¼Œæœ€ç»ˆåœ¨æŠ€æœ¯å‘å±•ä¸­è¢«è½®æ›¿çš„æ’ä»¶</description><content:encoded><![CDATA[<p>Vim æ˜¯æˆ‘ç³»ç»Ÿå­¦ä¹ çš„ç¬¬ä¸€ä¸ªç»ˆç«¯ç¼–è¾‘å™¨ï¼Œä»å­¦ç”Ÿæ—¶ä»£è‡³ä»Šï¼Œæˆ‘å‡ ä¹æ¯å¤©éƒ½ä¼šä½¿ç”¨åˆ°å®ƒï¼ˆé•¿æ—¶é—´å†™å‰ç«¯ä»£ç æ—¶é™¤å¤–ï¼‰ã€‚</p>
<p>è‡ªåŠ¨è¡¥å…¨ï¼ˆauto completionï¼‰å¤§æ¦‚æ˜¯æ¯ä¸ª Vim ç”¨æˆ·åœ¨æŒæ¡äº†åŸºæœ¬ç”¨æ³•åï¼Œç¬¬ä¸€ä¸ªæƒ³è¦è¿›é˜¶é…ç½®çš„åŠŸèƒ½ã€‚è¿™ç¯‡æ–‡ç« è®°å½•äº†ä» 2017 å¹´è‡³ä»Šï¼Œæˆ‘çš„ Vim è‡ªåŠ¨è¡¥å…¨é…ç½®çš„æ¯æ¬¡å˜æ›´ï¼Œä»ä¸­çª¥è§ Vim ç”Ÿæ€å‘å±•çš„ä¸€è§’ï¼Œä¹Ÿçºªå¿µè¿™äº›æ›¾ç»ç»™æˆ‘å¸¦æ¥è¿‡ä¾¿åˆ©ï¼Œæœ€ç»ˆåœ¨æŠ€æœ¯å‘å±•ä¸­è¢«è½®æ›¿çš„æ’ä»¶ã€‚</p>
<h2 id="before-2017">Before 2017</h2>
<p>2017 å¹´æˆ‘ä» Vim åˆ‡æ¢åˆ° <a href="https://neovim.io/">Neovim</a>ï¼ˆä¸‹æ–‡ç®€ç§° nvimï¼‰ï¼Œé™¤äº†å¢åŠ  nvim ç‰¹æ®Šçš„ <code>init.vim</code>ï¼ŒåŸºæœ¬æ²¿ç”¨äº†ä»¥å¾€çš„é…ç½®å’Œæ’ä»¶ã€‚</p>
<p>å½¼æ—¶æˆ‘ä½¿ç”¨çš„è¯­è¨€ä»¥ Python ä¸ºä¸»ï¼Œè‡ªåŠ¨è¡¥å…¨æ’ä»¶ä¸º <a href="https://github.com/davidhalter/jedi-vim">jedi-vim</a>ã€‚</p>
<p>æˆ‘å¯¹ jedi-vim çš„äº†è§£æœ€æ—©å¯ä»¥è¿½æº¯åˆ° 2012 å¹´ï¼Œé‚£æ—¶è¿˜æ²¡æœ‰ LSP çš„æ¦‚å¿µã€‚å¼€å‘è€…ä»¬é’ˆå¯¹è‡ªå·±çš„éœ€æ±‚ï¼Œç¼–å†™å¦‚è¯­æ³•å¢å¼ºã€æ–‡æ¡£æŸ¥çœ‹ã€è‡ªåŠ¨è¡¥å…¨ç­‰å„ç±»æ’ä»¶ï¼Œéå¸¸é›¶æ•£ã€‚jedi-vim å¯¹è¿™äº›æ’ä»¶çš„åŠŸèƒ½è¿›è¡Œäº†é‡æ„å’Œé›†æˆï¼Œæä¾›äº†å¼€ç®±å³ç”¨çš„ç»Ÿä¸€è§£å†³æ–¹æ¡ˆï¼Œä¸€ç»æ¨å‡ºä¾¿å¹¿å—å¥½è¯„ï¼Œæˆä¸ºä½¿ç”¨ Vim è¿›è¡Œ Python å¼€å‘çš„æ ‡é…ã€‚åœ¨åæ¥çš„åå¹´é‡Œï¼Œå®ƒçš„åˆå¿ƒå§‹ç»ˆä¸å˜ï¼Œå¾—åˆ°æŒç»­çš„ç»´æŠ¤å¹¶æ²¿ç”¨è‡³ä»Šã€‚</p>
<p>jedi-vim çš„æµè¡Œå’Œé•¿å¯¿æˆ–è®¸å¯ä»¥è¯´æ˜ä¸€ä¸ªè§‚ç‚¹ï¼Œå³æ˜“ç”¨å’ŒåŠŸèƒ½å…¨é¢æ‰æ˜¯è½¯ä»¶æµè¡Œçš„ç¬¬ä¸€å› ç´ ï¼Œæ— è®ºå®ƒçš„å®ç°æœ‰å¤šä¹ˆä¸ä¼˜é›…ã€æ•ˆç‡æœ‰å¤šä¹ˆä½ï¼Œåªè¦æ˜¯èƒ½ç”¨çš„ã€å¯æ¥å—çš„å°±è¡Œï¼Œç”¨æˆ·åœ¨ä½¿ç”¨ä½“éªŒä¸Šå¾—åˆ°æ»¡è¶³åï¼Œå¯¹äºå°é—®é¢˜çš„å®¹å¿åº¦æ˜¯ç›¸å½“é«˜çš„ã€‚</p>
<h2 id="2017">2017</h2>
<p>è¿˜æ˜¯ 2017 å¹´ï¼Œåœ¨åˆ‡æ¢åˆ° nvim åä¸ä¹…ï¼Œæˆ‘å‘ç°äº† <a href="https://github.com/Shougo/deoplete.nvim">deoplete</a> æ’ä»¶ï¼Œç»è¿‡ä¸€ç•ªå°è¯•å°† jedi-vim æ›¿æ¢æˆäº† deoplete + deoplete-jediã€‚</p>
<p>Commit: <a href="https://github.com/reorx/dotfiles/commit/0760ba6f7d11526e38e15b36a0d1db8709834825">0760ba6f7d11526e38e15b36a0d1db8709834825</a></p>
<blockquote>
<p><strong>use deoplete, remove jedi-vim</strong></p>
<p><em>committedÂ on Jun 28, 2017</em></p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="gd">-Plug &#39;davidhalter/jedi-vim&#39;, { &#39;for&#39;: &#39;python&#39; }
</span><span class="gd"></span><span class="gi">+Plug &#39;Shougo/deoplete.nvim&#39;, { &#39;do&#39;: &#39;:UpdateRemotePlugins&#39; }
</span><span class="gi">+Plug &#39;zchee/deoplete-jedi&#39;, { &#39;for&#39;: &#39;python&#39; }
</span></code></pre></div><p>deoplete çš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªé€šç”¨çš„å¼‚æ­¥è‡ªåŠ¨è¡¥å…¨æ¡†æ¶ï¼Œè¿™åœ¨è®¾è®¡ç†å¿µä¸Šæ˜¯ä¸€ä¸ªå·¨å¤§çš„è¿›æ­¥ã€‚jedi-vim è™½ç„¶å¼€ç®±å³ç”¨ï¼Œä½†å´æ˜¯ä¸€å †ç²˜åˆåœ¨ä¸€èµ·çš„ spaghetti codeï¼Œä¸ä»…éšç€é¡¹ç›®åŠŸèƒ½çš„å¢åŠ å˜å¾—è¶Šå‘åºå¤§å’Œè¿Ÿç¼“ï¼ˆè¿™æ˜¯æˆ‘æƒ³è¦ç¦»å¼€ jedi-vim çš„ä¸»è¦åŸå› ï¼Œæ–‡ä»¶ä¸€å¤§å„ç§æ“ä½œéƒ½å˜å¾—è‚‰çœ¼å¯è§çš„æ…¢ï¼‰ï¼Œä»£ç çš„å¯è¯»æ€§ä¹Ÿéå¸¸ç³Ÿç³•ï¼Œéš¾ä»¥ç»´æŠ¤å’Œå‚ä¸ã€‚è€Œ deoplete æœ¬èº«å¹¶ä¸æä¾›é’ˆå¯¹ä»»ä½•è¯­è¨€çš„åˆ†æèƒ½åŠ›ï¼Œåªä¸“æ³¨äºä¸ nvim çš„æ•´åˆå’Œ completion source çš„è°ƒåº¦ï¼Œå¹¶ä¸”åˆ©ç”¨ nvim çš„å¼‚æ­¥åŠŸèƒ½ï¼ˆåæ¥ vim 8 ä¹Ÿæ¨å‡ºäº†è‡ªå·±çš„ async æ¥å£ï¼‰ï¼Œå¤§å¤§æå‡äº†è¡¥å…¨çš„æµç•…åº¦ã€‚</p>
<p>ä½† deoplete ä¹Ÿæœ‰ç€è‡ªèº«çš„å±€é™æ€§ã€‚é¦–å…ˆé…ç½®å˜å¾—å¤æ‚ä¸”éº»çƒ¦ï¼Œç”¨æˆ·å¾—ç†è§£å…¶æ¶æ„å’Œè®¾è®¡ï¼Œå­¦ä¼šå¦‚ä½•é€šè¿‡ deoplete å¯¹æ¥ç¼–ç¨‹è¯­è¨€çš„ completion sourceã€‚ä¸ºäº†ä½¿æ£€æŸ¥ç»“æœçš„æç¤ºè´´åˆè‡ªå·±çš„ä½¿ç”¨ä¹ æƒ¯ï¼Œè¿˜è¦å†å»å­¦ä¹  completion source çš„é…ç½®ï¼Œæ¯ä¸ªè¯­è¨€çš„å®ç°ä¸åŒï¼Œé…ç½®ä¹Ÿä¸ä¸€æ ·ã€‚</p>
<blockquote>
<p>å½“æ—¶æˆ‘å´æ²¡æœ‰æ–™åˆ°ï¼Œé…ç½®å¤æ‚çš„é—®é¢˜åœ¨ LSP æ—¶ä»£ä¸ä»…æ²¡èƒ½å¾—åˆ°è§£å†³ï¼Œåè€Œå˜æœ¬åŠ å‰ï¼Œç›´åˆ°æœ¬æ–‡å®Œæˆæ—¶ä¹Ÿä¾æ—§æ˜¯ä½¿ç”¨è€…çš„å·¨å¤§ç—›ç‚¹</p>
</blockquote>
<p>deoplete çš„ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ï¼Œå®ƒåªä¸“æ³¨åœ¨ completionï¼Œç¼ºå°‘å¯¹äº go to definition å’Œæ˜¾ç¤º function siguature ç­‰åŠŸèƒ½çš„æ”¯æŒï¼Œè¿™å¯¹äºä» jedi-vim çš„ all-in-one ä½“éªŒåˆ‡æ¢è¿‡æ¥çš„æˆ‘ï¼Œæ˜¾ç„¶æ˜¯ä¸ªå·¨å¤§çš„è½å·®ã€‚å¥½åœ¨æˆ‘æ‰¾åˆ°äº†å…¶ä»–æ’ä»¶æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚</p>
<p>å¯¹äº â€œgo to definitionâ€ï¼Œé€šè¿‡è£…å› jedi-vim å¹¶æ‰“å¼€æ— è¡¥å…¨æ¨¡å¼å¯ä»¥è§£å†³ã€‚è¿™æ ·æ—¢å¯ä»¥ä½¿ç”¨ jedi-vim æä¾›çš„ go to definition ç­‰è¾…åŠ©åŠŸèƒ½ï¼Œä¹Ÿä¸ä¼šä¸ deoplete çš„è¡¥å…¨äº§ç”Ÿå†²çªã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vim" data-lang="vim"><span class="nx">Plug</span> <span class="s1">&#39;davidhalter/jedi-vim&#39;</span><span class="p">,</span> { <span class="s1">&#39;for&#39;</span>: <span class="s1">&#39;python&#39;</span> }<span class="err">
</span><span class="err"></span><span class="c">
</span><span class="c">&#34; jedi (only for go to definition)</span><span class="err">
</span><span class="err"></span><span class="k">let</span> <span class="nx">g</span>:<span class="nx">jedi</span>#<span class="nx">completions_enabled</span> <span class="p">=</span> <span class="m">0</span><span class="err">
</span></code></pre></div><p>å¯¹äº â€œfunction signatureâ€ï¼Œæˆ‘æ‰¾åˆ°äº† deoplete ä½œè€…çš„å¦ä¸€ä¸ªæ’ä»¶ <a href="https://github.com/Shougo/echodoc.vim">echodoc</a> æ¥å®ç°ã€‚å®ƒå°†å‡½æ•°çš„ç­¾åä¿¡æ¯æ˜¾ç¤ºåœ¨ cmd åŒºåŸŸï¼Œè§„é¿äº† deoplete å ç”¨ <code>completeopt</code> å¯¼è‡´ç¼–è¾‘ç•Œé¢æ— æ³•æ˜¾ç¤ºè¡¥å…¨èœå•ä»¥å¤–çš„å…¶ä»–ä¿¡æ¯çš„é—®é¢˜ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vim" data-lang="vim"><span class="nx">Plug</span> <span class="s1">&#39;Shougo/echodoc.vim&#39;</span><span class="err">
</span><span class="err"></span><span class="c">
</span><span class="c">&#34; echodoc</span><span class="err">
</span><span class="err"></span><span class="nx">set</span> <span class="nx">noshowmode</span><span class="err">
</span><span class="err"></span><span class="k">let</span> <span class="nx">g</span>:<span class="nx">echodoc</span>#<span class="nx">enable_at_startup</span><span class="p">=</span><span class="m">1</span><span class="err">
</span></code></pre></div><h2 id="2018">2018</h2>
<p>2018 å¹´æ˜¯é‡Œç¨‹ç¢‘å¼çš„ä¸€å¹´ï¼Œ<a href="https://microsoft.github.io/language-server-protocol/">Language Server Protocol</a> çš„ç”Ÿæ€é€æ¸æˆç†Ÿï¼Œæ–°çš„è¡¥å…¨å·¥å…·æ¶Œç°ã€‚æˆ‘å¯¹ LSP æ„Ÿåˆ°ç›¸å½“å…´å¥‹å’Œå¥½å¥‡ï¼Œè¿«ä¸åŠå¾…åœ°ä» deoplete æ›´æ¢åˆ°äº†å¯¹ LSP æœ‰æ›´å¥½æ”¯æŒçš„ <a href="https://github.com/ncm2/ncm2">ncm2</a>ã€‚</p>
<p>Commit: <a href="https://github.com/reorx/dotfiles/commit/7a1442c2334673ac17162c101663e220ef43a3c8">7a1442c2334673ac17162c101663e220ef43a3c8</a></p>
<blockquote>
<p><strong>nvim: update completion plugins (a lot!)</strong></p>
<ul>
<li>move and reorg completion plugins definitions and configurations</li>
<li>use LSP completion instead of deoplete</li>
<li>remove eslint from ale_linters</li>
<li>enable virtualenv display for airline</li>
<li>still working on passing settings to pyls through LanguageClient-neovim</li>
</ul>
<p><em>committedÂ on Dec 7, 2018</em></p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="gd">-Plug &#39;Shougo/deoplete.nvim&#39;, { &#39;do&#39;: &#39;:UpdateRemotePlugins&#39; }
</span><span class="gd">-Plug &#39;zchee/deoplete-jedi&#39;, { &#39;for&#39;: &#39;python&#39; }
</span><span class="gd"></span><span class="gi">+Plug &#39;ervandew/supertab&#39;
</span><span class="gi">+Plug &#39;ncm2/ncm2&#39;
</span><span class="gi">+Plug &#39;roxma/nvim-yarp&#39;
</span><span class="gi">+Plug &#39;autozimu/LanguageClient-neovim&#39;, { &#39;branch&#39;: &#39;next&#39;, &#39;do&#39;: &#39;bash install.sh&#39;, }
</span></code></pre></div><p>ä»è®¾è®¡ç†å¿µä¸Šçœ‹ï¼Œncm2 ä¸ deoplete å¹¶æ— å·®åˆ«ï¼Œéƒ½æ˜¯é€šç”¨çš„å¼‚æ­¥è‡ªåŠ¨è¡¥å…¨æ¡†æ¶ï¼Œå”¯æœ‰ä¸<a href="https://en.wikipedia.org/wiki/Static_program_analysis">é™æ€åˆ†æ</a>å™¨çš„é›†æˆæ–¹å¼ä¸åŒï¼Œdeoplete æ˜¯è‡ªå·±çš„ç§æœ‰åè®®ï¼Œncm2 åˆ™æ‹¥æŠ±äº†æ›´åŠ é€šç”¨çš„ä¸šç•Œæ ‡å‡† LSPã€‚</p>
<p>æˆ‘ä¸º deoplete çš„ä½œè€…æ„Ÿåˆ°æƒ‹æƒœï¼Œä»–åœ¨ LSP è¿˜ä¸å¤Ÿæˆç†Ÿçš„æ—¶æœŸï¼Œè‡ªå·±è®¾è®¡äº†ä¸é™æ€åˆ†æå™¨çš„é›†æˆåè®®ï¼Œæ„å»ºäº†ä¸€ä¸ªå®Œæ•´çš„è¡¥å…¨æ’ä»¶ç”Ÿæ€<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>ã€‚è¿˜å†™äº†å¾ˆå¤šå°å·§å®ç”¨çš„æ’ä»¶ï¼Œä»£ç ä¹Ÿéå¸¸ä¼˜ç¾ï¼Œè®©äººæ„Ÿåˆ°èµå¿ƒæ‚¦ç›®ã€‚ä½†å› ä¸º LSP çš„å‘å±•å’Œæ–°ä¸€ä»£æ›´åŠ  LSP native çš„è¡¥å…¨æ’ä»¶çš„æ¶Œç°ï¼Œå®ƒå·²ä¸å†æ˜¯å½“ä¸‹çš„ç¬¬ä¸€é€‰æ‹©ï¼ŒåŠ¿å¿…å› ä¸ºå†å²åŒ…è¢±è€Œé€æ¸è¢«æ·˜æ±°ã€‚</p>
<p>è¯´å› ncm2ï¼Œå…¶å®å®ƒä¹Ÿæœ‰è®¸å¤šç‘•ç–µï¼Œå°è±¡ä¸­é…ç½®è¿‡ç¨‹æ¯” deoplete è¿˜è¦ç—›è‹¦ï¼Œä½†å½“æ—¶å·²ç»æ˜¯è®© nvim ç”¨ä¸Š LSP çš„æœ€å¥½æ’ä»¶äº†ã€‚ä¹‹åæˆ‘å¯¹ JetBrains å’Œ VSCode çš„ä½¿ç”¨é¢‘ç‡å˜é«˜ï¼Œç–äºå¯¹ nvim æ’ä»¶çš„æŒç»­è·Ÿè¿›ï¼Œncm2 äºæ˜¯ä¸€ç›´æœå½¹åˆ° 2021 å¹´ã€‚</p>
<p>ncm2 å‡ºç°åæ²¡è¿‡å¤šä¹…ï¼Œ<a href="https://github.com/neoclide/coc.nvim">coc</a> ä¹Ÿè¯ç”Ÿäº†ï¼Œåœ¨ 2019 å¹´æˆä¸ºæœ€å—äººå…³æ³¨çš„ vim è¡¥å…¨æ’ä»¶ï¼Œå›½å†…ä¹Ÿçœ‹åˆ°å¾ˆå¤šæ–‡ç« ï¼ˆä¼¼ä¹ä½œè€…å°±æ˜¯å›½å†…å¼€å‘è€…ï¼‰ã€‚ç”±äºé•¿æœŸå— Webpack å’Œ Nodejs æŠ€æœ¯æ ˆçš„æŠ˜ç£¨ï¼Œå½“æˆ‘äº†è§£åˆ° coc æ˜¯ Nodejs å®ç°çš„ï¼Œå°±æ”¾å¼ƒäº†å°è¯•çš„å¿µå¤´ <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>ã€‚ä¸€æƒ³åˆ° jedi-vim çš„ç¼“æ…¢ï¼Œæˆ‘å®åœ¨æ²¡åŠæ³•å¯¹åŒæ ·å¤§è€Œå…¨çš„ coc æŠ±æœ‰è¶³å¤Ÿçš„ä¿¡å¿ƒ<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>ã€‚</p>
<p>P.S. ä»å½“å¹´çš„ç¬”è®°ä¸­æ‰¾åˆ°äº†æ‰€å‚è€ƒçš„é¡¹ç›®å’Œæ–‡ç« ï¼š</p>
<ul>
<li><a href="https://www.reddit.com/r/neovim/comments/8ejfg0/state_of_lsp_servers/">https://www.reddit.com/r/neovim/comments/8ejfg0/state_of_lsp_servers/</a></li>
<li><a href="https://github.com/autozimu/LanguageClient-neovim">https://github.com/autozimu/LanguageClient-neovim</a></li>
<li><a href="https://github.com/prabirshrestha/vim-lsp">https://github.com/prabirshrestha/vim-lsp</a></li>
<li><a href="https://github.com/ncm2/ncm2">https://github.com/ncm2/ncm2</a></li>
<li><a href="https://github.com/palantir/python-language-server">https://github.com/palantir/python-language-server</a></li>
</ul>
<h2 id="2021">2021</h2>
<p>2021 å¹´çš„æŸä¸€å¤©ï¼Œå› ä¸º ncm2 é•¿æœŸå­˜åœ¨çš„ä¸€ä¸ªå°é—®é¢˜ï¼ˆç°åœ¨å·²ç»å¿˜äº†ï¼‰ï¼Œæˆ‘ä¸€æ°”ä¹‹ä¸‹å†æ¬¡æ‰“å¼€äº† deoplete çš„é¡¹ç›®é¡µé¢ï¼ŒæƒŠå–œåœ°å‘ç°å®ƒå·²ç»å®Œå–„äº†å¯¹ LSP çš„æ”¯æŒï¼Œäºæ˜¯ç«‹åˆ»å°±å¼€å§‹è¿ç§»ï¼Œæ¢å›äº†æˆ‘æ›´æ¬£èµä¸”ä»£ç å“è´¨æ›´èƒœä¸€ç­¹çš„ deopleteã€‚</p>
<p>Commit: <a href="https://github.com/reorx/dotfiles/commit/cd044fcda603ad5b9ee16bd4d7d7873c9ade9a31">cd044fcda603ad5b9ee16bd4d7d7873c9ade9a31</a></p>
<blockquote>
<p><strong>nvim: rework on languageserver &amp; python completion</strong></p>
<p><em>committedÂ on Mar 26, 2021</em></p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="gd">-Plug &#39;ervandew/supertab&#39;
</span><span class="gd">-Plug &#39;ncm2/ncm2&#39;
</span><span class="gd">-Plug &#39;roxma/nvim-yarp&#39;
</span><span class="gd">-Plug &#39;autozimu/LanguageClient-neovim&#39;, { &#39;branch&#39;: &#39;next&#39;, &#39;do&#39;: &#39;bash install.sh&#39;,
</span><span class="gd"></span><span class="gi">+Plug &#39;Shougo/deoplete.nvim&#39;, { &#39;do&#39;: &#39;:UpdateRemotePlugins&#39; }
</span><span class="gi">+Plug &#39;prabirshrestha/vim-lsp&#39;
</span><span class="gi">+Plug &#39;mattn/vim-lsp-settings&#39;
</span><span class="gi">+Plug &#39;lighttiger2505/deoplete-vim-lsp&#39;
</span></code></pre></div><p>è¿™æ¬¡å˜æ›´é™¤äº†æ¢å› deoplete ï¼Œè¿˜å»æ‰äº†é™ªä¼´å¤šå¹´çš„ supertabï¼Œåœ¨æŠ„äº†ä¸€æ®µçœ‹ä¸æ‡‚çš„é…ç½®åï¼Œå®ç°äº†æˆ‘æ›´ä¸ºä¹ æƒ¯çš„ tab é”®è§¦å‘è¡¥å…¨çš„æ–¹å¼ã€‚</p>
<h2 id="2022">2022</h2>
<p>åœ¨å’–å•¡é¦†ç»“æŸäº†ä¸€å¤©çš„ä¸»è¦å·¥ä½œåï¼Œçœ‹ç€å¥½å‹ <a href="https://github.com/xwjdsh">@iwendellsun</a> æµç•…çš„ vim æ“ä½œï¼Œæˆ‘é—®èµ·äº†ä»–çš„ nvim è‡ªåŠ¨è¡¥å…¨é…ç½®ï¼Œæœç„¶æœ‰è®¸å¤šæˆ‘ä»æœªå¬è¿‡çš„ä¸œè¥¿ã€‚äºæ˜¯è¶æ­¤æœºä¼šèµ¶ç´§å‘ä»–è¯·æ•™ï¼Œåœ¨ä»–çš„æŒ‡å¯¼ä¸‹å®Œæˆäº† 2022 å¹´çš„é…ç½®å‡çº§ã€‚</p>
<p>Commit: <a href="https://github.com/reorx/dotfiles/commit/3de43d030ca40b498911c6752a7396af38202fe6">3de43d030ca40b498911c6752a7396af38202fe6</a></p>
<blockquote>
<p><strong>nvim: use nvim-cmp for completion</strong></p>
<p><em>committedÂ on May 08, 2022</em></p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="gd">-Plug &#39;Shougo/deoplete.nvim&#39;, { &#39;do&#39;: &#39;:UpdateRemotePlugins&#39; }
</span><span class="gd">-Plug &#39;prabirshrestha/vim-lsp&#39;
</span><span class="gd">-Plug &#39;mattn/vim-lsp-settings&#39;
</span><span class="gd">-Plug &#39;lighttiger2505/deoplete-vim-lsp&#39;
</span><span class="gd">-Plug &#39;w0rp/ale&#39;
</span><span class="gd">-Plug &#39;rhysd/vim-lsp-ale&#39;
</span><span class="gd"></span><span class="gi">+Plug &#39;williamboman/nvim-lsp-installer&#39;
</span><span class="gi">+Plug &#39;neovim/nvim-lspconfig&#39;
</span><span class="gi">+Plug &#39;hrsh7th/cmp-nvim-lsp&#39;
</span><span class="gi">+Plug &#39;hrsh7th/cmp-buffer&#39;
</span><span class="gi">+Plug &#39;hrsh7th/cmp-path&#39;
</span><span class="gi">+Plug &#39;hrsh7th/cmp-cmdline&#39;
</span><span class="gi">+Plug &#39;hrsh7th/nvim-cmp&#39;
</span></code></pre></div><p>è¿™æ¬¡å˜æ›´åˆ†ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ol>
<li>è¡¥å…¨æ¡†æ¶ä» deoplete å˜ä¸º <a href="https://github.com/hrsh7th/nvim-cmp">nvim-cmp</a>ï¼Œæˆ‘è¿˜æ²¡ç»†çœ‹ï¼Œä¸è¿‡æ®è¯´å®ƒå°±æ˜¯ç°åœ¨çš„ meta &amp; state of the art.</li>
<li>LSP é›†æˆä» vim-lsp æ¢æˆäº† nvim-lspconfigã€‚è¿Ÿæ¥çš„å®˜æ–¹å‡ºå“ã€‚</li>
<li>å»æ‰äº† ale å’Œ vim-lsp-aleã€‚nvim-cmp å¯ä»¥å°† LSP client è¿”å›çš„é”™è¯¯æç¤ºç›´æ¥åœ¨è¡Œå†…æ˜¾ç¤ºï¼Œä¸éœ€è¦å†ä¾èµ– ALE è¿™ä¸ª linter æ¡†æ¶äº†ã€‚</li>
<li>Last but not least, è¿™äº›æ’ä»¶çš„é…ç½®è¯­æ³•å‡ ä¹éƒ½æ˜¯ç”¨ Lua å†™çš„ï¼Œè¿™è®©ç”¨äº† 10 å¹´ Vimscript çš„æˆ‘æ„Ÿåˆ°æåº¦é™Œç”Ÿå’Œææ…Œã€‚</li>
</ol>
<p>ç›¸æ¯”ä¹‹å‰çš„å˜æ›´ï¼Œè¿™æ˜¯å”¯ä¸€ä¸€æ¬¡ç”Ÿæ¬ç¡¬å¥—è€Œéå…¨éƒ¨ç†è§£çš„ï¼Œæˆ‘æƒ³å¿«é€Ÿä¸Šè½¦ï¼Œå…å¾—è¢«ç¤¾åŒºå‘å±•æŠ›åœ¨äº†åé¢ï¼Œç°åœ¨å®åœ¨æ²¡æœ‰å¤ªå¤šç²¾åŠ›å¯ä»¥æ‚ é—²åœ°æ…¢æ…¢å°è¯•ã€‚è™½ç„¶æœ‰äººæŒ‡å¯¼å…å»äº†åˆæ¬¡ä¸Šæ‰‹çš„ç—›è‹¦ï¼Œä½†å¯ä»¥é¢„è§çš„æ˜¯ï¼Œæƒ³è¦è®©è¿™å¥—æ’ä»¶å’Œæˆ‘çš„ç¼–ç¨‹ä¹ æƒ¯å®Œç¾å¥‘åˆï¼Œè¿˜æœ‰è®¸å¤šå‘ç­‰ç€æˆ‘å»æŠ˜è…¾å‘¢ã€‚</p>
<p><strong>å‚è€ƒé“¾æ¥</strong>:</p>
<ul>
<li><a href="https://github.com/hrsh7th/nvim-cmp#setup">Setup | nvim-cmp</a>
<ul>
<li><a href="https://github.com/hrsh7th/nvim-cmp/wiki/List-of-sources">List of sources Â· hrsh7th/nvim-cmp Wiki</a></li>
<li><a href="https://github.com/hrsh7th/nvim-cmp/wiki/Example-mappings">Example mappings Â· hrsh7th/nvim-cmp Wiki</a></li>
</ul>
</li>
<li><a href="https://github.com/williamboman/nvim-lsp-installer#default-configuration">Default configuration | nvim-lsp-installer</a></li>
<li><a href="https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md">Server Configurations | nvim-lspconfig</a>
<ul>
<li><a href="https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#pylsp">pylsp</a></li>
<li><a href="https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#pyright">pyright</a></li>
<li><a href="https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#gopls">gopls</a></li>
</ul>
</li>
<li><a href="https://github.com/ray-x/lsp_signature.nvim">ray-x/lsp_signature.nvim: LSP signature hint as you type</a></li>
</ul>
<p><strong>å‚è€ƒé…ç½®</strong>:</p>
<ul>
<li><a href="https://github.com/xwjdsh/dotfiles/blob/master/nvim1/lua/plugins.lua">https://github.com/xwjdsh/dotfiles/blob/master/nvim1/lua/plugins.lua</a></li>
<li><a href="https://github.com/Avimitin/nvim/blob/master/lua/plugins/load.lua">https://github.com/Avimitin/nvim/blob/master/lua/plugins/load.lua</a></li>
</ul>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>Vim çš„ LSP æ’ä»¶ç”Ÿæ€è¿˜æœ‰è®¸å¤šæœ‰å¾…ä¼˜åŒ–çš„ç©ºé—´ï¼Œå¼€å‘è€…ä»¬å¯¹ç”Ÿäº§åŠ›çš„è¿½æ±‚æ˜¯æ°¸æ— æ­¢å¢ƒçš„ï¼Œä¸‹ä¸€ä¸ª 5 å¹´ç¼–è¾‘å™¨çš„ä½“éªŒä¼šæœ‰ç€æ€æ ·æ¿€åŠ¨äººå¿ƒçš„å˜åŒ–ï¼Œæˆ‘å¯¹æ­¤å……æ»¡æœŸå¾…ã€‚</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p><a href="https://github.com/Shougo/deoplete.nvim/wiki/Completion-Sources">https://github.com/Shougo/deoplete.nvim/wiki/Completion-Sources</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>å…¶å® Nodejs åœ¨æœåŠ¡ç«¯çš„æ€§èƒ½ä¸å·®ï¼Œä½† Webpack å’Œ Electron ç»™æˆ‘é€ æˆçš„å°è±¡å·²ç»æ ¹æ·±è’‚å›ºï¼Œä½¿æˆ‘çœ‹åˆ° Nodejs å°±ä¼šç«‹åˆ»è”æƒ³åˆ° slow and bloated.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>2022-05-09: æœ¬æ–‡å‘å¸ƒåï¼Œè®¸å¤šæœ‹å‹å‘æˆ‘æ¨èäº† cocï¼Œå¹¶å‘ŠçŸ¥å®ƒçš„é€Ÿåº¦å¾ˆå¿«ï¼Œä¿®æ­£äº†æˆ‘åœ¨æ²¡æœ‰ä½¿ç”¨è¿‡çš„æƒ…å†µä¸‹äº§ç”Ÿçš„åè§è®¤çŸ¥ã€‚&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></content:encoded></item><item><title>ä½¿ç”¨ Sonarr æ­å»ºè‡ªåŠ¨åŒ–è¿½ç•ªç³»ç»Ÿ</title><link>https://reorx.com/blog/track-and-download-shows-automatically-with-sonarr/</link><pubDate>Mon, 02 May 2022 00:00:00 +0000</pubDate><guid>https://reorx.com/blog/track-and-download-shows-automatically-with-sonarr/</guid><description>A complete guide to deploy and configure Sonarr + Jackett + FlareSolverr + qBittorrent to track and download anime shows automatically.</description><content:encoded><![CDATA[<p>ä½œä¸ºä¸€ä¸ªæ‡’äººï¼Œæˆ‘å¾ˆå°‘æŠ˜è…¾ self-hosted æœåŠ¡ï¼Œå¯¹äºè¿½ç•ªè¿™ç§å¨±ä¹åŒ–çš„éœ€æ±‚ï¼Œæ›´æ˜¯æœ‰ä»€ä¹ˆç”¨ä»€ä¹ˆå°†å°±åº¦æ—¥ã€‚æ‰€ä»¥è®¸å¤šå¹´æ¥ä¸€ç›´æ˜¯ç”¨ Bilibili è§‚çœ‹æ–°ç•ªï¼Œä¸­é€”ä¹Ÿå°è¯•è¿‡ ebb.io è¿™ç±»å°ä¼—æœåŠ¡ï¼Œä½†æœ€åéƒ½å› ä¸ºè¿æ¥ä¸ç•…æˆ–æ•°æ®æ»åç­‰åŸå› æ”¾å¼ƒäº†ã€‚</p>
<p>å»å¹´ä¸ºäº†å®ç° Home Assistant å®¶ç”µè‡ªåŠ¨åŒ– (<a href="https://twitter.com/novoreorx/status/1450334462177263618">tweet</a>)ï¼Œæˆ‘è´­ä¹°äº†ä¸€å° QNAP NASï¼Œä½¿å®¶é‡Œæœ‰äº† 24 å°æ—¶å¸¸é©»çš„ Linux server å’Œ Docker hostã€‚å¹´åˆç”±äº Bilibili è¿Ÿè¿Ÿä¸ä¸Šæ¶ã€Šé¬¼æ»…ä¹‹åˆƒéŠéƒ­ç¯‡ã€‹ï¼Œæˆ‘åˆåœ¨ NAS ä¸Šå®‰è£…äº† Plexï¼Œå°†ä» <a href="https://share.dmhy.org/">dmhy</a> æ‰‹åŠ¨ä¸‹è½½çš„å½±ç‰‡ä¸²æµåˆ°ç”µè§†ä¸Šè§‚çœ‹ã€‚æœ€è¿‘åˆé€¢ 4 æœˆæ–°ç•ªæ’­å‡ºï¼Œæƒ³åˆ°å®¶é‡Œçš„åŸºç¡€è®¾æ–½é€æ¸å®Œå¤‡ï¼Œä¾¿åŠ¨èµ·äº†æ­å»ºè‡ªåŠ¨è¿½ç•ªç³»ç»Ÿçš„å¿ƒæ€ã€‚ä»¥ä¸‹ä¾¿æ˜¯å¯¹è¿™æ¬¡å°è¯•çš„è®°å½•å’Œæ€»ç»“ï¼Œå¸Œæœ›èƒ½å¸®åŠ©æœ‰åŒæ ·éœ€æ±‚çš„äººè§£å†³é—®é¢˜ã€èŠ‚çœæ—¶é—´ã€‚</p>
<h2 id="ä½¿ç”¨-qnap-download-station">ä½¿ç”¨ QNAP Download Station</h2>
<p>æœ¬ç€å°½é‡ä¸å¢åŠ æ–°çš„ç³»ç»Ÿæ¥è§£å†³é—®é¢˜çš„æ€æƒ³ï¼Œæˆ‘é¦–å…ˆç ”ç©¶äº† QNAP çš„ä¸‹è½½å™¨ Download Stationï¼Œå‘ç°å®ƒè‡ªå¸¦ RSS è®¢é˜…åŠŸèƒ½ï¼Œåœ¨è¿›è¡Œä¸€äº›æ‰‹åŠ¨é…ç½®åï¼Œå³å¯å®Œæˆè‡ªåŠ¨è¿½ç•ªå’Œä¸‹è½½ã€‚</p>
<p>å¦‚æœå¯¹è¿™ä¸€ç« èŠ‚ä¸æ„Ÿå…´è¶£ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥è·³åˆ° <a href="#%E4%BD%BF%E7%94%A8-sonarr-%E5%92%8C%E5%AE%83%E7%9A%84%E6%9C%8B%E5%8F%8B%E4%BB%AC">ä½¿ç”¨ Sonarr å’Œå®ƒçš„æœ‹å‹ä»¬</a>ã€‚</p>
<h3 id="1-æ‰¾åˆ°ç•ªå‰§çš„-rss-url">1. æ‰¾åˆ°ç•ªå‰§çš„ RSS URL</h3>
<p><a href="https://bangumi.moe/">Bangume Moe</a> æ˜¯æˆ‘ç»å¸¸ä½¿ç”¨çš„èµ„æºç«™ï¼Œå®ƒæä¾›åŸºäº tag çš„ RSS æœç´¢åŠŸèƒ½ï¼Œå¯ä»¥éå¸¸ç²¾ç¡®åœ°å®šä½åˆ°ç•ªå‰§åœ¨ç‰¹å®šå­—å¹•ç»„ã€è¯­è¨€ã€åˆ†è¾¨ç‡ççš„è§†é¢‘å‘å¸ƒé“¾æ¥ã€‚</p>
<ul>
<li>é¦–å…ˆåœ¨å³ä¸Šè§’çš„æœç´¢æ¡†ä¸­è¾“å…¥æƒ³çœ‹çš„ç•ªå‰§åç§°ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨ã€Œå¤æ—¥é‡ç°ã€ä½œä¸ºä¾‹å­ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹æ–¹è‡ªåŠ¨åŒ¹é…äº† <code>Summertime Render</code> è¿™ä¸ª tagã€‚
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/qnap-rss-anime-2.png" alt=""  /></li>
<li>ç‚¹å‡»è¿™ä¸ª tagï¼Œæœç´¢ç»“æœä¸­ä¼šå‡ºç°è®¸å¤šä¸åŒå­—å¹•ç»„å‘å¸ƒçš„èµ„æºï¼Œæˆ‘ä»¬é€‰æ‹©å…¶ä¸­ä¸€ä¸ªå­—å¹•ç»„ã€Œå–µèŒå¥¶èŒ¶å±‹ã€çš„èµ„æºï¼Œåœ¨ Torrent Details ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å…¶æ ‡æ³¨çš„ tagsï¼Œæœ‰ <code>å–µèŒå¥¶èŒ¶å±‹</code>, <code>720p</code>, <code>chs-jpn</code> ç­‰ï¼Œå¦¥å–„ä½¿ç”¨è¿™äº› tags èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ç¼©å°æœç´¢ç»“æœèŒƒå›´
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/qnap-rss-anime-1.png" alt=""  /></li>
<li>å°† <code>å–µèŒå¥¶èŒ¶å±‹</code>, <code>chs-jpn</code> æ·»åŠ åˆ° Selected tags ä¸­ï¼Œç°åœ¨æˆ‘ä»¬ä¸€å…±æœ‰ 3 ä¸ª tagsï¼Œæœç´¢ç»“æœç¼©çŸ­åˆ°äº† 2 æ¡ï¼Œå·²ç»éå¸¸æ¸…æ™°äº†ï¼Œç‚¹å‡»å³ä¸Šè§’çš„ RSS å›¾æ ‡å³å¯å¾—åˆ°ç”¨äºè®¢é˜…çš„é“¾æ¥ã€‚ï¼ˆç¾ä¸­ä¸è¶³çš„æ˜¯ï¼Œå–µèŒå¥¶èŒ¶å±‹å°† 1080p çš„èµ„æºé”™æ ‡ä¸ºäº† <code>720p</code>ï¼Œä¸è¿‡è¿™ç‚¹æˆ‘ä»¬å¯ä»¥åœ¨åé¢çš„ä¸‹è½½ç®¡ç†å™¨ä¸­è§£å†³ï¼‰
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/qnap-rss-anime.png" alt=""  /></li>
</ul>
<h3 id="2-å°†-rss-url-æ·»åŠ åˆ°ä¸‹è½½å™¨">2. å°† RSS URL æ·»åŠ åˆ°ä¸‹è½½å™¨</h3>
<p>RSS è®¢é˜…æ˜¯è®¸å¤šä¸‹è½½ç®¡ç†å™¨çš„é€šç”¨åŠŸèƒ½ï¼Œå¦‚ Synologyã€qBittorrent ä¹Ÿéƒ½å…·æœ‰ï¼Œä½¿ç”¨æ–¹å¼ä¸ Download Station å¤§åŒå°å¼‚ã€‚</p>
<ul>
<li>æ‰“å¼€ RSS Download Managerï¼Œå°†ä¸Šä¸€æ­¥å¾—åˆ°çš„è®¢é˜…é“¾æ¥å¤åˆ¶åˆ° Feed URL ä¸­ã€‚Label å¡«å†™ç•ªå‰§åç§°ï¼Œä¸¤ä¸ª Location æ ¹æ®è‡ªå·± NAS çš„ç›®å½•ç»“æ„é€‰æ‹©ã€‚ç‚¹å‡» Apply æ·»åŠ ã€‚
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/qnap-rss-anime-filter.png" alt=""  /></li>
<li>æ·»åŠ å®Œæˆåï¼Œæ‰“å¼€ Filter Settingsï¼Œå®ƒå¯ä»¥ç”¨äºè¿›ä¸€æ­¥è¿‡æ»¤ RSS è¿”å›çš„ç»“æœï¼Œé¿å…ä¸‹è½½ä¸éœ€è¦çš„èµ„æºã€‚ä¹‹å‰åœ¨è¿›è¡Œèµ„æºæœç´¢æ—¶ï¼Œæˆ‘ä»¬æ²¡èƒ½é€šè¿‡ tag è¿‡æ»¤æ‰ 720p çš„ç»“æœï¼Œåœ¨ Filter Settings ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹© 1080pï¼Œè¿™æ · 720p å°±è¢«å¿½ç•¥äº†ã€‚
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/qnap-rss-anime-filter-1.png" alt=""  /></li>
<li>å›åˆ°ä¸»ç•Œé¢ï¼Œåˆ·æ–°æ·»åŠ çš„ RSSï¼Œå¯ä»¥çœ‹åˆ°ä¸¤æ¡ç»“æœä¸­åªæœ‰ 1080p è¢«åŠ å…¥åˆ°ä¸‹è½½åˆ—è¡¨ã€‚Status ä¸º Finished ä»£è¡¨ä¸‹è½½å®Œæˆï¼ŒNew ä»£è¡¨æ–°æ·»åŠ åˆ° RSSï¼Œä½†ä¸åœ¨ä¸‹è½½åˆ—è¡¨ä¸­ã€‚</li>
</ul>
<h3 id="å°ç»“">å°ç»“</h3>
<p><strong>Pros</strong></p>
<ul>
<li>æ— éœ€é…ç½®å’Œå¢åŠ æ–°ç³»ç»Ÿ</li>
<li>æ“ä½œè¿‡ç¨‹é€æ˜æ¸…æ™°ï¼Œå¯æ§æ€§å¼º</li>
</ul>
<p><strong>Cons</strong></p>
<ul>
<li>æ­¥éª¤è¾ƒä¸ºç¹çï¼Œéœ€è¦åœ¨å¤šä¸ªæœåŠ¡ä¹‹é—´åˆ‡æ¢</li>
<li>ä¸‹è½½çš„æ–‡ä»¶å› ä¸ºä¸ç¬¦åˆ Plex çš„æ ¼å¼éœ€æ±‚ï¼Œéœ€è¦æ‰‹åŠ¨é‡å‘½åæ‰èƒ½åœ¨ Plex ä¸Šè§‚çœ‹ã€‚ä½†å¦‚æœä½ ä½¿ç”¨ DLNA è¿™ç±»åŸºäºæ–‡ä»¶ç³»ç»Ÿå®šä½è§†é¢‘çš„æ–¹å¼ï¼Œå€’æ˜¯å¯ä»¥å¿½ç•¥è¿™ä¸ªç¼ºç‚¹ã€‚</li>
</ul>
<h2 id="ä½¿ç”¨-sonarr-å’Œå®ƒçš„æœ‹å‹ä»¬">ä½¿ç”¨ Sonarr å’Œå®ƒçš„æœ‹å‹ä»¬</h2>
<p>Download Station RSS è™½ç„¶è§£å†³äº†åŸºæœ¬çš„æ¸©é¥±é—®é¢˜ï¼Œä½†ä¸çœŸæ­£çš„è‡ªåŠ¨åŒ–ä¹‹é—´æ˜¾ç„¶è¿˜æœ‰å¾ˆå¤§å·®è·ï¼Œå¦‚æœä½ æƒ³å……åˆ†åˆ©ç”¨ NAS çš„åŠŸèƒ½ï¼Œåœ¨å®¶åº­å¤šåª’ä½“è®¾æ–½ä¸Šæ›´è¿›ä¸€æ­¥ï¼Œè¯·ç»§ç»­å‘ä¸‹é˜…è¯»ï¼Œèµ°è¿› Sonarr å’Œå®ƒçš„æœ‹å‹ä»¬çš„ä¸–ç•Œã€‚</p>
<h3 id="sonarr">Sonarr</h3>
<blockquote>
<p>Sonarr is a PVR (Personal Video Recorder) for Usenet and BitTorrent users. It can monitor multiple RSS feeds for new episodes of your favorite shows and will grab, sort and rename them.</p>
</blockquote>
<p><a href="https://wiki.servarr.com/sonarr">Sonarr</a> æ˜¯ä¸€ä¸ª PVR ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç›‘æ§å¤šç§ä¿¡æ¯æºçš„å‰§é›†å‘å¸ƒä¿¡æ¯ï¼Œå¯¹å‰§é›†è¿›è¡Œè‡ªåŠ¨ä¸‹è½½ã€åˆ®å‰Šå’Œé‡å‘½åã€‚</p>
<p>Sonarr æ˜¯ Sick Beard çš„ç»§ä»»è€…ï¼ŒSick Beard åŸºäº Python å¼€å‘ï¼Œæ›¾ç»æ˜¯æœ€è‘—åçš„ PVR ç³»ç»Ÿï¼Œä½†åæ¥é€æ¸å¼å¾®ï¼Œåç»­è™½ç„¶æœ‰ Sick Gear ç­‰ forkï¼Œä½†æœ€ç»ˆéƒ½æ²¡èƒ½æ»¡è¶³äººä»¬æ—¥ç›Šå¢é•¿çš„çœ‹ç‰‡éœ€æ±‚ï¼Œæœ€åè¢«ä¸€ç¾¤ C# çˆ±å¥½è€…ä»¬å¼€å‘å‡º Sonarr ç»™æ›¿ä»£äº†ã€‚ç»è¿‡å¤šå¹´å‘å±•ï¼ŒSonarr çš„è½¯ä»¶è´¨é‡è¶‹äºæˆç†Ÿå’Œç¨³å®šï¼Œæˆä¸ºæ„æ¶è‡ªåŠ¨åŒ–çš„å®¶åº­å¤šåª’ä½“ä¸­å¿ƒä¸å¯ç¼ºå°‘çš„ç»„ä»¶ã€‚</p>
<p>Sonarr ä¸€å¼€å§‹å°±ä»¥å¤šç³»ç»Ÿä½è€¦åˆçš„æ–¹å¼è¿›è¡Œè®¾è®¡ï¼Œè¿™å¤§å¤§é™ä½äº†ä»£ç çš„å¤æ‚åº¦ï¼Œä½¿å…¶æ›´æ˜“äºç»´æŠ¤ï¼Œä¹Ÿä¸ºå…¶ç¹ç››çš„ç¤¾åŒºå‘å±•æä¾›äº†åŸºçŸ³ã€‚ä¸ºäº†æ»¡è¶³ä¸åŒçš„ç”¨æˆ·éœ€æ±‚ï¼ŒSonarr çš„ä½œè€…ä»¬å¼€å‘ä¸€ç³»åˆ—ä»¥ <code>rr</code> æˆ–å…¶ä»–åŒå­—æ¯ç»“å°¾çš„å·¥å…·ï¼Œä»¥è‡³äºè¿™ç§å‘½åæ–¹å¼æˆä¸ºäº† Sonarr ç”Ÿæ€åœˆçš„ä¸€ä¸ªæ ‡è¯†å’Œäº‹å®æ ‡å‡†ã€‚</p>
<h3 id="jackett">Jackett</h3>
<blockquote>
<p>Jackett works as a proxy server: it translates queries from apps into tracker-site-specific http queries, parses the html or json response, and then sends results back to the requesting software.</p>
</blockquote>
<p><a href="https://github.com/Jackett/Jackett">Jackett</a> æ˜¯ä¸€ä¸ªä»£ç†ï¼Œç”¨äºå°† Sonarr ç­‰ç³»ç»Ÿå¯¹å‰§é›†ä¿¡æ¯çš„æŸ¥è¯¢è¯·æ±‚è½¬è¯‘æˆå„ç§ torrent tracker/indexer ï¼ˆå³èµ„æºå‘å¸ƒç«™ï¼‰æ‰€æ”¯æŒçš„è¯·æ±‚ã€‚Jackett çš„äº§ç”Ÿæ˜¯ Sonarr ç¤¾åŒºæ¶æ„åˆç†æ€§çš„ä¸€ä¸ªä½“ç°ï¼Œå®ƒæ¥ç®¡äº†é€‚é…ä¸åŒ indexer æ¥å£çš„è„æ´»ç´¯æ´»ï¼Œä½¿ Sonarr å¯ä»¥ä¸“æ³¨åœ¨ä»»åŠ¡è°ƒåº¦å’Œå‰§é›†ç®¡ç†ä¸Šã€‚</p>
<p>Jackett æ—¢ç„¶è¢«ç”¨ä½œèµ„æºæŸ¥è¯¢çš„ç½‘å…³ï¼Œå®ç°ç¼“å­˜åŠŸèƒ½å°±é¡ºç†æˆç« äº†ï¼Œè¿™æ ·ä¸€æ–¹é¢å¯ä»¥åº”å¯¹ Sonarr é¢‘ç¹çš„æŸ¥è¯¢éœ€æ±‚ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå‡å°‘äº† indexer ç«™ç‚¹çš„è´Ÿè½½é‡ï¼Œå®ç°äº†åŒèµ¢ã€‚å› æ­¤è™½ç„¶å®ƒä¸æ˜¯ä¸€ä¸ªå¿…é¡»çš„ç»„ä»¶ï¼Œä½†æˆ‘å¼ºçƒˆå»ºè®®æ¯ä¸ªä½¿ç”¨ Sonarr çš„ç”¨æˆ·éƒ½å®‰è£…å®ƒã€‚</p>
<h3 id="flaresolverr">FlareSolverr</h3>
<blockquote>
<p>FlareSolverr is a proxy server to bypass Cloudflare and DDoS-GUARD protection.</p>
</blockquote>
<p><a href="https://github.com/FlareSolverr/FlareSolverr">FlareSolverr</a> ä¹Ÿæ˜¯ä¸€ä¸ªä»£ç†ï¼Œå®ƒå¸®åŠ© Jackett è§£å†³å‘ indexer çš„è¯·æ±‚èƒ½å¦æˆåŠŸçš„é—®é¢˜ã€‚ä¸€äº› indexer ä¸ºäº†ä¿æŠ¤è‡ªå·±å…äº DDoS æ”»å‡»æˆ–å‡å°‘çˆ¬è™«è¯·æ±‚ï¼Œä¼šä½¿ç”¨ Cloudflare æˆ–ä¸€äº›å…¶ä»–çš„å®‰å…¨é˜²æŠ¤æœåŠ¡ï¼Œå¦‚æœä¸åšå¤„ç†ï¼Œç›´æ¥è¯·æ±‚å¾ˆå¯èƒ½å› è§¦å‘äººæœºéªŒè¯è€Œå¤±è´¥ã€‚FlareSolverr å°±æ˜¯ä¸ºè§£å†³è¿™ç±»é—®é¢˜è¯ç”Ÿçš„ã€‚</p>
<p>åœ¨ Jackett ä¸­æ·»åŠ æ–°çš„ indexer æ—¶ï¼Œä¼šæ ¹æ®ç«™ç‚¹æƒ…å†µæç¤ºæ˜¯å¦éœ€è¦æ¥å…¥ FlareSolverr ä»¥ç»•è¿‡ç«™ç‚¹çš„ä¿æŠ¤æªæ–½ã€‚</p>
<h3 id="qbittorrent">qBittorrent</h3>
<p>å¤§éƒ¨åˆ†å½±è§†èµ„æºéƒ½ä½¿ç”¨ BT åè®®è¿›è¡Œç‚¹å¯¹ç‚¹ä¼ è¾“ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ä¸ª BT ä¸‹è½½å™¨ï¼ŒqBittorrent å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå®ƒçš„åŠŸèƒ½éå¸¸å…¨é¢ï¼Œä¸”ä¸ Sonarr æœ‰å¾ˆå¥½çš„æ¥å…¥æ”¯æŒã€‚å¦‚æœä½ å·²ç»è¿è¡Œäº†å…¶ä»–ä¸‹è½½å™¨å¦‚ Aria2ï¼Œç”šè‡³ QNAP/Synology è‡ªå¸¦çš„ Download Stationï¼Œé‚£ä¹ˆä½ ä¹Ÿå¯ä»¥å‚è€ƒ <a href="https://wiki.servarr.com/sonarr/supported#downloadclient">Sonarr æ”¯æŒçš„ä¸‹è½½å™¨åˆ—è¡¨</a>ï¼Œå°è¯•è¿›è¡Œé…ç½®ã€‚ï¼ˆæˆ‘å¹¶æ²¡æœ‰æˆåŠŸä½¿ Sonarr å’Œ QNAP Download Station ååŒå·¥ä½œèµ·æ¥ï¼‰</p>
<h3 id="éƒ¨ç½²è¯´æ˜">éƒ¨ç½²è¯´æ˜</h3>
<p>å„ä¸ªç»„ä»¶ä»‹ç»å®Œæ¯•ï¼Œç°åœ¨è®©æˆ‘ä»¬è¿›å…¥æ­£é¢˜ï¼Œäº†è§£å¦‚ä½•é…ç½®å’Œéƒ¨ç½²æ•´ä¸ª Sonarr æœåŠ¡ç»„ã€‚</p>
<p>Sonarr ç°ä»£åŒ–åœ°æä¾› Docker é•œåƒçš„éƒ¨ç½²æ–¹å¼ï¼Œå› æ­¤è¿™ä¸ªç« èŠ‚å°†ä¼šå›´ç»• Docker ç›¸å…³çš„æŠ€æœ¯è¿›è¡Œè¯´æ˜ã€‚è™½ç„¶ <a href="https://www.qnapclub.eu/en/qpkg/652">Qnapclub</a> ä¹Ÿæœ‰ Sonarr çš„å®‰è£…åŒ…ï¼Œä½†ç»è¿‡ä¸€ç•ªç³Ÿå¿ƒçš„å°è¯•ï¼Œæœ€ç»ˆæˆ‘åªå¾—å‡ºä¸€ä¸ªç»“è®ºï¼Œé‚£å°±æ˜¯ä»¥åéƒ¨ç½²ä»»ä½•æœåŠ¡ï¼Œèƒ½ Docker å°±å°½é‡ Docker å§ã€‚</p>
<p><details >
  <summary markdown="span">A failed attempt to install Sonarr by qpkg</summary>
  <ul>
<li>error after install: <code>MediaInfo Library could not be loaded libmediainfo.so.0 assembly:&lt;unknown assembly&gt; type:&lt;unknown type&gt; member:(null)</code></li>
<li>dependencies
<ul>
<li><a href="https://www.qnapclub.eu/en/qpkg/193">Qmono</a>: the package is crazily 3GB in size</li>
<li><a href="https://www.qnapclub.eu/en/qpkg/712">MediaInfoCLI</a>
<ul>
<li><a href="https://forum.qnap.com/viewtopic.php?t=147702">https://forum.qnap.com/viewtopic.php?t=147702</a></li>
<li>this is not useful at all</li>
</ul>
</li>
</ul>
</li>
</ul>

</details></p>

<p>æˆ‘ä»¬çš„éƒ¨ç½²æ–¹æ¡ˆçš„åŸºæœ¬åŸç†æ˜¯åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šé€šè¿‡ Docker å’Œ Docker compose CLI å¯¹è¿œç«¯ NAS ä¸Šçš„ Docker host è¿›è¡Œæ“ä½œã€‚è¿™è¦æ±‚è¯»è€…å…·å¤‡åŸºç¡€çš„ Docker ç›¸å…³çš„çŸ¥è¯†ã€‚</p>
<p>QNAP/Synology ç­‰ NAS ç³»ç»Ÿæä¾›çš„ Docker host ä¸æ ‡å‡†å®ç°åŸºæœ¬æ²¡æœ‰å·®å¼‚ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ Docker å®˜æ–¹è½¯ä»¶åŒ…æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ NAS æä¾›çš„å›¾å½¢åŒ–ç•Œé¢ï¼Œä½†ä¸€åˆ™é‚£æ ·åœ¨éƒ¨ç½²å¤šä¸ªæœåŠ¡æ—¶éå¸¸ä¸ä¾¿ï¼ŒäºŒåˆ™å¦‚æœä½ äº†è§£äº†å¦‚ä½•ä½¿ç”¨ Docker compose éƒ¨ç½²ï¼Œè‡ªç„¶ä¹Ÿå¯ä»¥åæ¨åˆ°å›¾å½¢åŒ–ç•Œé¢çš„æ“ä½œæ–¹å¼ä¸Šã€‚</p>
<h4 id="docker-context">Docker context</h4>
<p>ä¸ºäº†ä¸æœ¬åœ°çš„ Docker host åŒºåˆ†å¼€ï¼Œæˆ‘ä»¬è¦ä¸º NAS ä¸Šçš„ Docker host åˆ›å»ºä¸€ä¸ªæ–°çš„ <a href="https://docs.docker.com/engine/context/working-with-contexts/">context</a>ã€‚</p>
<blockquote>
<p><code>harrogath</code> æ˜¯æˆ‘çš„ NAS çš„ hostnameï¼Œå¯ä»¥ä½¿ç”¨ IP ä»£æ›¿</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># åˆ›å»º context</span>
docker context create harrogath

<span class="c1"># æ›´æ–° context çš„é…ç½®ä¿¡æ¯</span>
docker context update harrogath --docker <span class="s2">&#34;host=tcp://harrogath:2376,ca=</span><span class="nv">$HOME</span><span class="s2">/.docker/ca.pem,cert=</span><span class="nv">$HOME</span><span class="s2">/.docker/cert.pem,key=</span><span class="nv">$HOME</span><span class="s2">/.docker/key.pem&#34;</span>
</code></pre></div><p>QNAP çš„ Docker éœ€è¦é€šè¿‡è¯ä¹¦æ¥è®¿é—®ï¼Œå› æ­¤è¦åœ¨ Container Station çš„è®¾ç½®ä¸­ä¸‹è½½è¯ä¹¦ã€‚
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/qnap-docker-certs.png" alt=""  /></p>
<p>å®Œæˆ context åˆ›å»ºåï¼Œé€šè¿‡ <code>use</code> å‘½ä»¤åˆ‡æ¢åˆ° contextï¼Œä¹‹åæ‰€æœ‰çš„ Docker å‘½ä»¤éƒ½æ˜¯ä¸ NAS Docker è¿›è¡Œé€šè®¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="l">docker context use harrogath</span><span class="w">
</span><span class="w"></span><span class="l">docker context ls</span><span class="w">
</span><span class="w"></span><span class="l">NAME                TYPE                DESCRIPTION                               DOCKER ENDPOINT                               KUBERNETES ENDPOINT   ORCHESTRATOR</span><span class="w">
</span><span class="w"></span><span class="l">default             moby                Current DOCKER_HOST based configuration   unix:///var/run/docker.sock                                         swarm</span><span class="w">
</span><span class="w"></span><span class="l">harrogath *         moby</span><span class="w">
</span></code></pre></div><h4 id="images">Images</h4>
<p>ç›®å‰ä¸»è¦æœ‰ä¸¤ä¸ªç»„ç»‡åœ¨ç»´æŠ¤ Sonarr åŠç›¸å…³æœåŠ¡çš„ Docker é•œåƒï¼Œ<a href="https://www.linuxserver.io/">linuxserver.io</a> å’Œ <a href="https://hotio.dev/">hotio.dev</a>, æˆ‘é€‰æ‹©å‰è€…ä½œä¸ºæœ¬æ¬¡éƒ¨ç½²çš„é•œåƒæºã€‚ä¸‹é¢æ˜¯ä½¿ç”¨åˆ°çš„é•œåƒåˆ—è¡¨ï¼Œå¯ä»¥åœ¨å…¶é¡µé¢ä¸ŠæŸ¥çœ‹é•œåƒçš„ä½¿ç”¨è¯´æ˜ã€‚</p>
<ul>
<li><a href="https://hub.docker.com/r/linuxserver/sonarr">linuxserver/sonarr - Docker Image | Docker Hub</a></li>
<li><a href="https://hub.docker.com/r/linuxserver/jackett">linuxserver/jackett - Docker Image | Docker Hub</a></li>
<li><a href="https://hub.docker.com/r/linuxserver/qbittorrent">linuxserver/qbittorrent - Docker Image | Docker Hub</a></li>
<li><a href="https://hub.docker.com/r/flaresolverr/flaresolverr">flaresolverr/flaresolverr - Docker Image | Docker Hub</a></li>
</ul>
<h4 id="hierarchy">Hierarchy</h4>
<p>Sonarr å’Œå®ƒçš„æœ‹å‹ä»¬éœ€è¦å¯¹ NAS çš„å­˜å‚¨è¿›è¡Œè¯»å†™ï¼Œå› æ­¤åœ¨è¿è¡ŒæœåŠ¡ä¹‹å‰ï¼Œé¦–å…ˆè¦ç†è§£å¹¶è®¾è®¡ä¸€ä¸ªå¥½ç”¨çš„ç›®å½•ç»“æ„ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦åœ¨ NAS ä¸Šåˆ›å»ºä¸€ä¸ª AppData ç›®å½•ï¼Œä½œä¸ºå®¹çº³æ‰€æœ‰æœåŠ¡äº§ç”Ÿçš„æ–‡ä»¶çš„æ ¹ç›®å½•ã€‚AppData æ‰€åœ¨çš„ Volume å»ºè®®é€‰æ‹©é€‚åˆå­˜æ”¾å¤§é‡åª’ä½“æ•°æ®çš„ç²¾ç®€å· (Thin Volume)ã€‚</p>
<pre tabindex="0"><code>AppData
â”œâ”€â”€ jackett
â”‚Â Â  â”œâ”€â”€ config
â”‚Â Â  â””â”€â”€ downloads
â”œâ”€â”€ qbittorrent
â”‚Â Â  â””â”€â”€ config
â””â”€â”€ sonarr
 Â Â  â”œâ”€â”€ config
 Â Â  â”œâ”€â”€ downloads
 Â Â  â”œâ”€â”€ media
 Â Â  â”œâ”€â”€ torrents
 Â Â  â””â”€â”€ usenet
</code></pre><p>åœ¨ AppData ä¹‹ä¸‹ï¼Œä¾æ¬¡ä¸º sonarr, jackett, qbittorrent åˆ›å»ºç›®å½•ï¼Œæ¯ä¸ªç›®å½•ä¸‹å¿…é¡»æœ‰ <code>config</code> å­ç›®å½•ï¼Œç”¨äºå­˜æ”¾é…ç½®æ–‡ä»¶ã€‚flaresolverr ç”±äºæ˜¯çº¯ç½‘ç»œä»£ç†æœåŠ¡ä¸éœ€è¦å¯¹åº”ç›®å½•å­˜åœ¨ã€‚</p>
<p>ä¸‹é¢å¯¹å„ä¸ªæœåŠ¡çš„ NAS ç›®å½•ä¸å®¹å™¨å†…ç›®å½•çš„æ˜ å°„å…³ç³»è¿›è¡Œè¯´æ˜</p>
<blockquote>
<p>è¡¨ç¤ºä¸º <code>NAS Directory -&gt; Container Directory</code></p>
</blockquote>
<ul>
<li><strong>sonarr</strong>
<ul>
<li><code>sonarr/config -&gt; /config</code>: é…ç½®æ–‡ä»¶</li>
<li><code>sonarr -&gt; /data</code>: æ•°æ®æ–‡ä»¶ï¼Œå¯åœ¨ Sonarr ç®¡ç†ç•Œé¢å‘ä¸‹åˆ›å»ºå­ç›®å½•</li>
</ul>
</li>
<li><strong>qbittorrent</strong>
<ul>
<li><code>qbittorrent/config -&gt; /config</code>: é…ç½®æ–‡ä»¶</li>
<li><code>sonarr -&gt; /data</code>: æ•°æ®æ–‡ä»¶ï¼Œä¸ sonarr ä¿æŒä¸€è‡´ï¼Œä»¥ä¾¿ sonarr åœ¨é‡å‘½åæˆ–ç§»åŠ¨æ–‡ä»¶æ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨ qbittorrent è¿”å›çš„æ–‡ä»¶è·¯å¾„</li>
</ul>
</li>
<li><strong>jackett</strong>
<ul>
<li><code>jackett/config -&gt; /config</code>: é…ç½®æ–‡ä»¶</li>
<li><code>jackett/downloads -&gt; /downloads</code>: é»˜è®¤ç§å­æ–‡ä»¶ä¸‹è½½è·¯å¾„</li>
</ul>
</li>
</ul>
<h4 id="compose-file">Compose file</h4>
<p>ä»¥æˆ‘æ­£åœ¨ä½¿ç”¨çš„ <code>docker-compose.yml</code> æ–‡ä»¶ä½œä¸ºç¤ºä¾‹ï¼Œä½ å¯ä»¥å¤åˆ¶ä¸‹æ¥ä¿®æ”¹è‡ªå·±çš„ç‰ˆæœ¬ï¼Œåªéœ€è¦å°† <code>/share/CACHEDEV2_DATA/Misc/AppData</code> æ›¿æ¢ä¸ºè‡ªå·±åœ¨ NAS ä¸Šåˆ›å»ºçš„ <code>AppData</code> è·¯å¾„å³å¯ã€‚</p>
<p>ç«¯å£çš„é…ç½®éœ€è¦é¢å¤–æ³¨æ„ï¼Œè¿™ä»½é…ç½®ä¸­æˆ‘å°½é‡ä¿æŒå„æœåŠ¡é»˜è®¤é…ç½®ç«¯å£ä¸å˜ï¼Œè‹¥ä¸å·²æœ‰æœåŠ¡å†²çªï¼Œä¿®æ”¹åˆ°æœªè¢«å ç”¨çš„ç«¯å£å³å¯ã€‚ä¾‹å¦‚ QNAP è‡ªå¸¦çš„ Download Station å·²å ç”¨ 6881 ç«¯å£ï¼Œå› æ­¤æˆ‘å°† qbittorrent ä¿®æ”¹åˆ°äº† 16881 ç«¯å£ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="w">
</span><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">sonarr</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">linuxserver/sonarr</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="m">8989</span><span class="p">:</span><span class="m">8989</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">/share/CACHEDEV2_DATA/Misc/AppData/sonarr/config:/config</span><span class="w">
</span><span class="w">      </span>- <span class="l">/share/CACHEDEV2_DATA/Misc/AppData/sonarr:/data</span><span class="w">
</span><span class="w">      </span>- <span class="l">/etc/localtime:/etc/localtime:ro</span><span class="w">
</span><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">PUID=1000</span><span class="w">
</span><span class="w">      </span>- <span class="l">PGID=1000</span><span class="w">
</span><span class="w">      </span>- <span class="l">TZ=Asia/Shanghai</span><span class="w">
</span><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped</span><span class="w">
</span><span class="w">  </span><span class="nt">jackett</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">linuxserver/jackett</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="m">9117</span><span class="p">:</span><span class="m">9117</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">/share/CACHEDEV2_DATA/Misc/AppData/jackett/config:/config</span><span class="w">
</span><span class="w">      </span>- <span class="l">/share/CACHEDEV2_DATA/Misc/AppData/jackett/downloads:/downloads</span><span class="w">
</span><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">PUID=1000</span><span class="w">
</span><span class="w">      </span>- <span class="l">PGID=1000</span><span class="w">
</span><span class="w">      </span>- <span class="l">TZ=Asia/Shanghai</span><span class="w">
</span><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped</span><span class="w">
</span><span class="w">  </span><span class="nt">qbittorrent</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">linuxserver/qbittorrent</span><span class="w">
</span><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">PUID=1000</span><span class="w">
</span><span class="w">      </span>- <span class="l">PGID=1000</span><span class="w">
</span><span class="w">      </span>- <span class="l">TZ=Asia/Shanghai</span><span class="w">
</span><span class="w">      </span>- <span class="l">WEBUI_PORT=8080</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">/share/CACHEDEV2_DATA/Misc/AppData/qbittorrent/config:/config</span><span class="w">
</span><span class="w">      </span>- <span class="l">/share/CACHEDEV2_DATA/Misc/AppData/sonarr:/data</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="m">8080</span><span class="p">:</span><span class="m">8080</span><span class="w">
</span><span class="w">      </span>- <span class="m">16881</span><span class="p">:</span><span class="m">6881</span><span class="w">
</span><span class="w">      </span>- <span class="m">16881</span><span class="p">:</span><span class="m">6881</span><span class="l">/udp</span><span class="w">
</span><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped</span><span class="w">
</span><span class="w">  </span><span class="nt">flaresolverr</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">flaresolverr/flaresolverr</span><span class="w">
</span><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">LOG_LEVEL=info</span><span class="w">
</span><span class="w">      </span>- <span class="l">LOG_HTML=false</span><span class="w">
</span><span class="w">      </span>- <span class="l">CAPTCHA_SOLVER=${CAPTCHA_SOLVER:-none}</span><span class="w">
</span><span class="w">      </span>- <span class="l">TZ=Asia/Shanghai</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="m">8191</span><span class="p">:</span><span class="m">8191</span><span class="w">
</span><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped</span><span class="w">
</span></code></pre></div><h4 id="run">Run</h4>
<p>ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤:</p>
<pre tabindex="0"><code>docker compose up
</code></pre><p>è¿™ä¼šå¯åŠ¨æ‰€æœ‰æœåŠ¡å¹¶ attach åˆ°ç»ˆç«¯è¾“å‡ºæ—¥å¿—ï¼Œæ–¹ä¾¿æŸ¥çœ‹æœåŠ¡çš„è¿è¡Œæ—¥å¿—ã€‚ç­‰ç¡®è®¤æ‰€æœ‰æœåŠ¡ç¨³å®šè¿è¡Œåï¼ŒåŠ ä¸Š <code>-d</code> å‚æ•°ä½¿å…¶è¿è¡Œåœ¨åå°ã€‚</p>
<pre tabindex="0"><code>docker compose up -d
</code></pre><h3 id="ä½¿ç”¨è¯´æ˜">ä½¿ç”¨è¯´æ˜</h3>
<p>ä¸‹é¢å¯¹å„ä¸ªæœåŠ¡çš„ Web UI çš„ä½¿ç”¨æ–¹æ³•è¿›è¡Œè¯´æ˜ï¼Œä»¥æˆ‘çš„ NAS hostname  <code>harrogath</code> ä¸ºä¾‹å±•ç¤ºæœåŠ¡çš„è®¿é—®åœ°å€ã€‚</p>
<h4 id="jackett-1">Jackett</h4>
<p>æ‰“å¼€ <code>http://harrogath:9117</code>, Jackett çš„ç•Œé¢å±•ç¤ºå¦‚ä¸‹:</p>
<p><img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/jackett.png" alt=""  /></p>
<p>ä½¿ç”¨æ–¹å¼éå¸¸ç®€å•ï¼ŒJackett å·²ç»å°†è¿™ä¸ªä¸–ç•Œä¸Šç»å¤§éƒ¨åˆ† indexer éƒ½å†…ç½®äº†ï¼Œåªéœ€è¦ç‚¹å‡» Add indexer æœç´¢å¹¶æ·»åŠ å³å¯ã€‚é™¤äº†éƒ¨åˆ†æœ‰è®¿é—®é™åˆ¶çš„ indexer éœ€è¦é…ç½®å¤–ï¼ŒåŸºæœ¬ä¸Šéƒ½å¯ä»¥ä¸€è·¯ç‚¹å‡»ç¡®è®¤å®Œæˆæ·»åŠ ã€‚ä¹‹ååœ¨ Sonarr ä¸­å¯¹æ¥æ—¶ï¼Œéœ€è¦å¤åˆ¶è®¢é˜… URL å’Œ API keyï¼Œå‚ç…§æˆªå›¾ä¸­æ‰€ç¤ºå³å¯ã€‚</p>
<p>æˆ‘ç›®å‰ä½¿ç”¨äº† 4 ä¸ª indexerï¼Œå…¶ä¸­ Bangumi Moe å’Œ dmhy ç”¨äºä¸‹è½½åŠ¨ç”»ç•ªå‰§ï¼ŒEZTV å’Œ RARBG ç”¨äºä¸‹è½½ç¾å‰§ã€‚</p>
<p>ä¸ºäº†ä½¿ FlareSolverr å‘æŒ¥ä½œç”¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å®ƒçš„ URL å¡«åœ¨æœ€ä¸‹æ–¹çš„é…ç½®ä¸­ï¼Œç„¶åç‚¹å‡» Apply server settings ä¿å­˜ç”Ÿæ•ˆã€‚
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/jackett-1.png" alt=""  /></p>
<h4 id="qbittorrent-1">qBittorrent</h4>
<p>æ‰“å¼€ <code>http://harrogath:8080</code>ï¼Œä½¿ç”¨é»˜è®¤ç”¨æˆ·åå¯†ç  <code>admin:adminadmin</code> ç™»å½•ã€‚</p>
<p>æ‰“å¼€ Tools Â» Optionsï¼Œå°† Default Save Path ä¿®æ”¹ä¸º <code>/data/downloads</code>ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†ä½¿ qBittorrnet æ‰€è®°å½•çš„æ–‡ä»¶è·¯å¾„ä¸ Sonarr ä¿æŒä¸€è‡´ï¼Œä»¥ä¾¿ä¸éœ€è¦é¢å¤–é…ç½®å°±èƒ½ä½¿ Sonarr çš„é‡å‘½ååŠŸèƒ½æ­£å¸¸å·¥ä½œã€‚è‹¥ä½ ä¸å¸Œæœ›ä¿®æ”¹ä¸‹è½½è·¯å¾„ï¼Œæˆ–ä½¿ç”¨çš„æ˜¯å…¶ä»–ä¸‹è½½å™¨ï¼Œå¯ä»¥å‚è€ƒ <a href="https://trash-guides.info/Sonarr/Sonarr-remote-path-mapping/">Remote Path Mappings</a> æ¥è§£å†³è·¯å¾„ä¸ä¸€è‡´çš„é—®é¢˜ã€‚
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/qbittorrent.png" alt=""  /></p>
<p>åœ¨ Options ä¸­åˆ‡æ¢åˆ° BitTorrent é€‰é¡¹å¡ï¼Œå°† Seeding Limits ä¸‹çš„ &ldquo;then&rdquo; ä¿®æ”¹ä¸º &ldquo;Pause torrent&rdquo;ï¼Œè¿™æ˜¯ä¸ºäº†é¿å… Sonarr åœ¨åˆ é™¤ç§å­æ—¶äº§ç”Ÿå†²çªã€‚&ldquo;When ratio reaches&rdquo; ä»£è¡¨åšç§åˆ†äº«èµ„æºçš„æ¯”ç‡ã€‚BT åè®®æå€¡å…±äº«ç²¾ç¥ï¼Œæ—¢ç„¶ä»åˆ«äººé‚£é‡Œè·å–åˆ°è‡ªå·±æƒ³è¦çš„èµ„æºï¼Œç†åº”åšå‡ºå›é¦ˆã€‚æ¨èå°†åˆ†äº«ç‡è®¾ç½®ä¸º 2.0ï¼Œå³ä¸Šä¼ é‡ä¸ºä¸‹è½½é‡çš„ä¸¤å€ä¹‹ååœæ­¢åˆ†äº«ã€‚å¦‚æœä½ æ‹…å¿ƒç¡¬ç›˜è¿‡åº¦æŸè€—ï¼Œå¯ä»¥å°†æ¯”ç‡é™ä½ã€‚(<em>ä¹Ÿå¯ä»¥ä¿®æ”¹ä¸º 0 å…³é—­åšç§åŠŸèƒ½ï¼Œå¦‚æœå…‹æœäº†é“å¾·æ„Ÿçš„çº¦æŸ</em>)
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/qbittorrent-3.png" alt=""  /></p>
<h4 id="sonarr-1">Sonarr</h4>
<p>ç»ˆäºåˆ°äº†è¿½ç•ªå¤§è®¡æœ€æ ¸å¿ƒçš„ç»„ä»¶â€”â€”Sonarrï¼Œä½†å…ˆä¸è¦æ€¥ï¼Œåœ¨æ·»åŠ ç•ªå‰§å‰ï¼Œè¿˜æœ‰ä¸€äº›è®¾ç½®è¦åšã€‚</p>
<ol>
<li>
<p>Indexers</p>
<ul>
<li>å°†å…ˆå‰åœ¨ Jackett ä¸­æ·»åŠ çš„ indexers é€ä¸ªå¯¹æ¥åˆ° Sonarrï¼Œä½¿ç”¨ Torznab åè®®ã€‚
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/sonarr-1.png" alt=""  /></li>
<li>Bangumi.moe çš„é…ç½®å±•ç¤ºï¼ŒURL å’Œ API Key éƒ½æ˜¯ä» Jackett ä¸­å¤åˆ¶è¿‡æ¥ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ Categories æ˜¯å½±è§†å‰§çš„åˆ†ç±»ï¼Œåº”è¯¥ç•™ç©ºï¼Œè€Œåœ¨ Anime Categories ä¸­å‹¾é€‰æ‰€æœ‰ä¸ç•ªå‰§ç›¸å…³çš„åˆ†ç±»é¡¹ã€‚
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/sonarr-2.png" alt=""  />
<ul>
<li>è‹¥ä¸ç¡®å®šè‡ªå·±è¦æœç´¢åœ¨èµ„æºå±äºå“ªä¸ªåˆ†ç±»é¡¹ï¼Œå¯åœ¨ Jackett ä¸­ä½¿ç”¨ Manual Search æ¥ç¡®è®¤
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/jackett-2.png" alt=""  /></li>
</ul>
</li>
<li>rarbg çš„é…ç½®å±•ç¤ºï¼Œç”±äº rarbg æ˜¯å½±è§†å‰§ indexerï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Categories ä¸­å‹¾é€‰åˆ†ç±»é¡¹è€Œå°† Anime Categories ç•™ç©º
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/sonarr-3.png" alt=""  /></li>
</ul>
</li>
<li>
<p>Download Clients</p>
<ul>
<li>qBittorrent é…ç½®å±•ç¤ºã€‚Host æœ€å¥½å¡«å†™ IPï¼Œä½¿ç”¨ hostname å¯èƒ½ä¼šå¤±è´¥ã€‚
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/sonarr-qbittorrent.png" alt=""  /></li>
</ul>
</li>
<li>
<p>Profiles</p>
<p>é»˜è®¤åªæœ‰ Englishï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªä¸­æ–‡çš„ Profile ä»¥åœ¨æ·»åŠ ç•ªå‰§æ—¶è®¾å®šè¯­è¨€ã€‚<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/sonarr-profile.png" alt=""  /></p>
</li>
<li>
<p>Media Management</p>
<p>è¿™ä¸ªè®¾ç½®å…³ç³»åˆ°ä¸‹è½½çš„æ–‡ä»¶èƒ½å¦è¢« Plex æˆ–å…¶ä»– media server è¯†åˆ«ï¼Œä½†åˆ«è¢«çœ¼èŠ±ç¼­ä¹±çš„è®¾ç½®é¡¹å“åˆ°ï¼Œ æˆ‘ä»¬åªéœ€è¦å…³å¿ƒä¸‹å›¾çº¢æ¡†åœˆèµ·çš„éƒ¨åˆ†ã€‚
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/sonarr-mediamanagement.png" alt=""  /></p>
<ul>
<li>é¦–å…ˆæ‰“å¼€ Rename Episodes åŠŸèƒ½</li>
<li>ç„¶åé…ç½® Anime Episode Format å’Œ Season Folder Formatï¼Œè¿™ä»£è¡¨ç•ªå‰§è¢«é‡å‘½ååçš„æ–‡ä»¶åæ ¼å¼å’Œä¸Šçº§ç›®å½•æ ¼å¼ã€‚ä½ ä¸ç”¨å…³å¿ƒæºæ–‡ä»¶çš„åç§°å¦‚ä½•è¢« Sonarr è§£æï¼Œä½ åªç”¨çŸ¥é“å®ƒè‡ªä¿¡å¹¶å‡ºè‰²åœ°å®Œæˆäº†è¿™é¡¹è„æ´»ï¼Œè®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å˜é‡å®šä¹‰æƒ³è¦çš„æ–‡ä»¶å’Œç›®å½•åç§°ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ Plex çš„ <a href="https://support.plex.tv/articles/naming-and-organizing-your-tv-show-files/">TV Show Files</a> æ ¼å¼ï¼Œå®ç°çš„ç»“æœå¦‚ä¸‹: <img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/finder.png" alt=""  /></li>
<li>æœ€åé…ç½® Root Foldersï¼Œå®ƒä»¬åœ¨æ·»åŠ ç•ªå‰§çš„æ—¶å€™ä¼šç”¨åˆ°ï¼Œä½œä¸ºæ”¾ç½®ç•ªå‰§çš„ç›®å½•ã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è®¾ç½®å¤šä¸ªï¼Œä¸€èˆ¬æ¥è¯´è®¾ç½®ä¸¤ä¸ªå°†å½±è§†å‰§å’ŒåŠ¨ç”»ç•ªå‰§åˆ†å¼€å­˜æ”¾å³å¯ã€‚è¿˜è®°å¾—æˆ‘ä»¬åœ¨ <code>docker-compose.yaml</code> ä¸­é…ç½®çš„ç›®å½•æ˜ å°„å—ï¼Ÿè¿™é‡Œçš„ç›®å½• <code>/data/media/anime tv</code> åœ¨ NAS ä¸­å¯¹åº”çš„æ˜¯ <code>AppData/sonarr/data/media/anime tv</code>ï¼Œåœ¨ Plex æ·»åŠ åª’ä½“åº“æ—¶ä¸è¦å¿˜äº†å¦‚ä½•æ‰¾åˆ°å®ƒã€‚</li>
<li>Optional: æ–‡ä»¶é‡å‘½åæ—¶ï¼ŒSonarr é»˜è®¤é‡‡å–ç§»åŠ¨ç­–ç•¥ï¼Œè¿™æ ·ä¼šå¯¼è‡´ BT ä¸‹è½½å™¨æ— æ³•ç»§ç»­å¯¹èµ„æºåšç§ï¼Œä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œåœ¨ Media Management é¡µé¢æ‰“å¼€ Advanced Settingsï¼Œæ‰¾åˆ°å¹¶æ‰“å¼€ &ldquo;Use Hardlinks instead of Copy&rdquo;ï¼Œè¿™æ ·æ—¢ä¿ç•™äº†ä¸‹è½½èµ„æºçš„åŸå§‹è·¯å¾„ï¼Œåˆä¸ä¼šé¢å¤–å ç”¨ç¡¬ç›˜ç©ºé—´ã€‚</li>
</ul>
</li>
<li>
<p>Connect</p>
<p>å®ç°è‡ªåŠ¨åŒ–è¿½å‰§çš„ç›®çš„æ˜¯ä¸ºäº†ä¸éœ€è¦äººå·¥æ£€æŸ¥å‰§é›†çš„æ›´æ–°æƒ…å†µï¼Œå› æ­¤é€šçŸ¥æ˜¯å¿…ä¸å¯å°‘çš„ã€‚Connect å¯ä»¥è¿æ¥è®¸å¤šé€šçŸ¥æœåŠ¡ï¼Œè®©ä½ ç¬¬ä¸€æ—¶é—´çŸ¥é“å‰§é›†ä½•æ—¶ä¸Šçº¿ï¼Œèµ„æºä½•æ—¶å‘å¸ƒï¼Œä½•æ—¶å®Œæˆä¸‹è½½ã€å¯ä»¥è§‚çœ‹ã€‚ä¸‹é¢è¯´æ˜å¦‚ä½•å¯¹æ¥ Telegram è·å–é€šçŸ¥ä¿¡æ¯ã€‚</p>
<ul>
<li>
<p>åœ¨ Telegram æœç´¢æœºå™¨äºº <code>@BotFather</code>ï¼ŒæŒ‰ç…§æç¤ºåˆ›å»ºä¸€ä¸ªæ–°çš„æœºå™¨äººï¼Œè·å– API Tokenã€‚æˆ‘çš„æœºå™¨äººåä¸º <code>@reorx_notify_bot</code>ã€‚ <img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/sonarr-telegram-2.png" alt=""  /></p>
</li>
<li>
<p>åˆ›å»ºä¸€ä¸ªç¾¤ç»„ï¼Œå°† bot åŠ å…¥åˆ°ç¾¤ç»„ä¸­ï¼Œè¯·æ±‚æ¥å£ <code>https://api.telegram.org/bot&lt;TOKEN&gt;/getUpdates</code>, å–å‡ºè¿”å›ç»“æœä¸­çš„ <code>result[0].channel_post.chat.id</code> ä½œä¸º chat id</p>
<blockquote>
<p>æ–¹æ³•æ¥è‡ª <a href="https://stackoverflow.com/a/61215414/596206">How to obtain Telegram chat_id for a specific user?</a></p>
</blockquote>
</li>
<li>
<p>åœ¨ Sonarr ä¸­æ·»åŠ  Telegram connectionï¼Œå‹¾é€‰è‡ªå·±å…³å¿ƒçš„é€šçŸ¥ç±»å‹ï¼Œä¸€èˆ¬è‡³å°‘ä¼šé€‰æ‹© On Downloadï¼Œä»£è¡¨æ–°å‰§é›†ä¸‹è½½å®Œæˆçš„æ—¶é—´ã€‚
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/sonarr-telegram.png" alt=""  /></p>
</li>
<li>
<p>é…ç½®å¥½åï¼Œå°±å¯ä»¥é€šè¿‡ Telegram ç¬¬ä¸€æ—¶é—´æŒæ¡ç•ªå‰§çš„æ›´æ–°æƒ…å†µäº†ã€‚ <img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/sonarr-telegram-1.png" alt=""  /></p>
</li>
</ul>
</li>
</ol>
<h4 id="å¼€å§‹è¿½å‰§">å¼€å§‹è¿½å‰§</h4>
<p>é…ç½®å®Œæˆï¼Œç°åœ¨å¯ä»¥å¼€å§‹è¿½å‰§äº†ã€‚ä¸‹é¢ä»¥ã€Œç›¾ä¹‹å‹‡è€…æˆåå½• ç¬¬äºŒå­£ã€ä¸ºä¾‹è¯´æ˜åœ¨ Sonarr æ·»åŠ ç•ªå‰§çš„è¿‡ç¨‹ã€‚</p>
<p>æ‰“å¼€ <a href="https://thetvdb.com/">TheTVDB.com</a>, æœç´¢åˆ°ä½ æƒ³è¦è¿½è¸ªçš„ç•ªå‰§çš„é¡µé¢ <a href="https://thetvdb.com/series/the-rising-of-the-shield-hero">The Rising of the Shield Hero</a>ï¼Œè·å– URL ä¸­çš„æœ€åä¸€æ®µ <code>the-rising-of-the-shield-hero</code> ä½œä¸ºåœ¨ Sonarr æœç´¢å…³é”®è¯ã€‚</p>
<p>æ‰“å¼€ Sonarrï¼Œåœ¨å·¦ä¸Šè§’çš„ Search æ¡†ä¸­è¾“å…¥ <code>the-rising-of-the-shield-hero</code>ï¼Œç‚¹å‡»æœç´¢ç»“æœï¼Œè¿›å…¥æ·»åŠ ç•ªå‰§çš„ç•Œé¢ã€‚</p>
<p><img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/sonarr-6.png" alt=""  /></p>
<ol>
<li>Root Folder: é€‰æ‹©å…ˆå‰åœ¨ Media Management ä¸­è®¾ç½®çš„ <code>anime tv</code></li>
<li>Monitor: ç”±äºæˆ‘ä»¬åªæƒ³çœ‹æœ€è¿‘çš„ç¬¬äºŒå­£ï¼Œå› æ­¤é€‰æ‹© Only Latest Season</li>
<li>Quality Profile: é€‰æ‹© HD-1080p æˆ–å…¶ä»–ä½ éœ€è¦çš„æ ¼å¼/åˆ†è¾¨ç‡</li>
<li>Language Profile: é€‰æ‹© Chinese</li>
<li>Series Type: é€‰æ‹© Animeï¼Œè¿™é‡Œå¯¹åº”çš„æ˜¯æ·»åŠ  Indexer æ—¶çš„ Anime Categories é€‰é¡¹ï¼Œå‘Šè¯‰ Sonarr ä» Indexer çš„ Anime Categories ä¸­æœç´¢èµ„æºã€‚å¦‚æœä½¿ç”¨é»˜è®¤çš„ Standardï¼ˆå¯¹åº” Indexer çš„ Categoriesï¼‰ï¼Œå°†ä¼šå¯¼è‡´æ— æ³•æœç´¢åˆ°èµ„æºã€‚</li>
<li>Season Folder: å‹¾é€‰ï¼Œä¸ºäº†å¯¹åº” Plex è¦æ±‚çš„ç›®å½•ç»“æ„</li>
<li>Start search for missing episodes: å‹¾é€‰ï¼Œè¿™ä¼šä½¿ Sonarr åœ¨æ·»åŠ ç•ªå‰§åç«‹åˆ»æ ¹æ® Monitor æ‰€è®¾ç½®çš„æ¡ä»¶å¼€å§‹æœç´¢èµ„æºã€‚ä¹Ÿå¯ä»¥åœ¨æ·»åŠ å®Œæˆååœ¨è¯¦æƒ…é¡µæ‰‹åŠ¨ç‚¹å‡»è§¦å‘ã€‚</li>
</ol>
<p>å®Œæˆæ·»åŠ åï¼Œç‚¹å‡»ç•ªå‰§è¿›å…¥è¯¦æƒ…é¡µã€‚</p>
<p><img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/sonarr-7.png" alt=""  /></p>
<ol>
<li>ç‚¹å‡»æ”¾å¤§é•œå›¾æ ‡å¯¹å…¶æ‰€åœ¨çš„ Season è¿›è¡Œå‰§é›†æœç´¢ã€‚</li>
<li>Status åˆ—çš„å›¾æ ‡è¯´æ˜
<ul>
<li>ğŸ•“: å°šæœªæ’­å‡ºï¼Œä¸ä¼šè¿›è¡Œç›‘æ§</li>
<li>âš ï¸: å·²æ’­å‡ºï¼Œç¡¬ç›˜ä¸­è¿˜æ²¡æœ‰èµ„æºï¼Œæ­£åœ¨è¿›è¡Œç›‘æ§</li>
<li>â˜ï¸ æˆ–è¿›åº¦æ¡: å·²å¼€å§‹ä¸‹è½½</li>
</ul>
</li>
<li>ä¹¦ç­¾ç¬¦å·æœ‰å¡«å……ä»£è¡¨è¯¥å­£å¤„äºæ­£åœ¨ç›‘æ§çŠ¶æ€ï¼Œæ— å¡«å……ä»£è¡¨æœªç›‘æ§ï¼Œå¯ä»¥ç‚¹å‡»æ‰‹åŠ¨è®¾ç½®ä¸ºç›‘æ§</li>
</ol>
<p>åœ¨ Sonarr é¦–é¡µå¯ä»¥çœ‹åˆ°å„ä¸ªç•ªå‰§çš„è¿½è¸ªçŠ¶æ€ï¼Œè“è‰²ä»£è¡¨æ ‡è®°è¿½è¸ªçš„å‰§é›†éƒ½å·²ä¸‹è½½å®Œæˆï¼Œçº¢è‰²ä»£è¡¨æœ‰ç¼ºå¤±ï¼Œæ­£åœ¨æŒç»­ç›‘æ§ä¸­ã€‚
<img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/sonarr-5.png" alt=""  /></p>
<p>ä¸‹è½½äº†ä¸€äº›èµ„æºåï¼Œæˆ‘ä»¬æ‰“å¼€ Plexï¼Œå°† <code>anime tv</code> å¯¹åº”çš„è·¯å¾„æ·»åŠ åˆ°ã€ŒåŠ¨ç”»ã€Library ä¸­ï¼ŒPlex å°±ä¼šå¼€å§‹è‡ªåŠ¨æ‰«ææ–‡ä»¶ã€åˆ®å‰Šå…ƒæ•°æ®ã€ä¸‹è½½ä¸­æ–‡å­—å¹•äº†ã€‚</p>
<p><img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/plex.png" alt=""  /></p>
<p>å¤§åŠŸå‘Šæˆï¼Œåœ¨ Plex ä¸Šæ„‰å¿«çœ‹ç•ªå§â˜ºï¸ã€‚</p>
<p><img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/plex-1.png" alt=""  /></p>
<h2 id="ç•ªå¤–">ç•ªå¤–</h2>
<h3 id="sonarr-çš„å…¶ä»–æœ‹å‹ä»¬">Sonarr çš„å…¶ä»–æœ‹å‹ä»¬</h3>
<ul>
<li><a href="https://radarr.video/">Radarr</a>
Radarr æ˜¯ Sonarr çš„å…„å¼Ÿé¡¹ç›®ï¼ŒSonarr ä¸“ç²¾äºè¿½å‰§ï¼ŒRadarr ä¸“ç²¾äºè¿½è¸ªç”µå½±</li>
<li><a href="https://www.bazarr.media/">Bazarr</a>
Bazarr ç”¨äºè‡ªåŠ¨ä¸‹è½½å­—å¹•æ–‡ä»¶ï¼Œç”±äº Plex æœ¬èº«å…·æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œä»¥åŠå¤§éƒ¨åˆ†åŠ¨æ¼«èµ„æºéƒ½æœ‰å†…ç½®å­—å¹•ï¼Œå› æ­¤ä¸æ˜¯ç‰¹åˆ«æœ‰å¿…è¦éƒ¨ç½²</li>
<li><a href="https://lidarr.audio/">Lidarr</a>
Lidarr æ˜¯éŸ³ä¹ä¸“è¾‘çš„è¿½è¸ªå’Œä¸‹è½½å™¨ï¼Œé€‚ç”¨äºå–œæ¬¢æ”¶è—æœ¬åœ°éŸ³ä¹æ–‡ä»¶çš„ç”¨æˆ·</li>
<li><a href="https://readarr.com/">Readarr</a>
Readarr æ˜¯ç”µå­ä¹¦çš„è¿½è¸ªå’Œä¸‹è½½å™¨ã€‚æˆ‘çœ‹ä¹¦ä¸å¤šï¼Œå¶å°”éœ€è¦çœ‹çš„ä¹¦ä¸€èˆ¬ä» zlibrary ä¸‹è½½ï¼ŒCalibre è¶³å¤Ÿæ»¡è¶³æˆ‘çš„ç®¡ç†éœ€æ±‚ã€‚</li>
</ul>
<h3 id="lunasea">LunaSea</h3>
<p><a href="https://www.lunasea.app/">LunaSea</a> æ˜¯ä¸€ä¸ª Sonarr å’Œ Usenet ç”Ÿæ€åœˆçš„è¿œç¨‹æ§åˆ¶å™¨ï¼Œèƒ½è®©ä½ åœ¨æ‰‹æœºä¸ŠæŸ¥çœ‹ Sonarr / Radarr / Lidarr çš„èµ„æºå’Œæ”¾é€æ—¶é—´è¡¨ã€‚</p>
<div class="image-size-control" style="height: 600px;">
  <img src="images/lunasea.jpeg" alt="">
</div>

<h3 id="seedboxio">Seedbox.io</h3>
<p>åœ¨å¾—çŸ¥æˆ‘æœ€è¿‘çš„æŠ˜è…¾ç»è¿‡åï¼Œæˆ‘çš„å¥½æœ‹å‹ <a href="https://wzyboy.im/">wzyboy</a> å‘æˆ‘ç§‘æ™®äº†ä¸€ç§åä¸º <a href="https://en.wikipedia.org/wiki/Seedbox">Seedbox</a> çš„ hosted serviceï¼Œæä¾›å¼€ç®±å³ç”¨çš„ BT ä¸‹è½½å’Œå®¶åº­åª’ä½“æœåŠ¡å™¨ï¼Œå¹¶èƒ½å¸¦æ¥ä»¥ä¸‹å‡ ç‚¹å¥½å¤„ï¼š</p>
<ul>
<li>å…äºæŠ˜è…¾å’Œç»´æŠ¤è¯¸å¤šæœåŠ¡/æœåŠ¡å™¨</li>
<li>å‘æ‰¬ BT åˆ†äº«ç²¾ç¥çš„åŒæ—¶æ— éœ€æŸè€—è‡ªå·±çš„ç¡¬ç›˜</li>
<li>è§„é¿ P2P ä¸‹è½½èµ„æºçš„ç‰ˆæƒé—®é¢˜</li>
</ul>
<p>å…¶ä¸­æœ‰ä¸€å®¶æœåŠ¡å•†å« seedbox.io, å®ƒä»¬çš„æœåŠ¡å™¨åŒ…å«æœ¬ç¯‡ä»‹ç»çš„æ‰€æœ‰ç»„ä»¶ã€‚å¦‚æœä½ æœ‰å…´è¶£çš„è¯ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ª <a href="https://panel.seedbox.io/aff.php?aff=1061">affiliate link</a> æ³¨å†Œå’Œè´­ä¹°ä»–ä»¬çš„æœåŠ¡ã€‚</p>
<p><img loading="lazy" src="/blog/track-and-download-shows-automatically-with-sonarr/images/seedbox-apps.png" alt=""  /></p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>Sonarr å’Œå®ƒçš„æœ‹å‹ä»¬è¿˜æœ‰è®¸å¤šåŠŸèƒ½ï¼Œæœ¬ç¯‡æ—¨åœ¨å¼•å¯¼ç”¨æˆ·å®Œæˆæœ€åŸºæœ¬çš„è‡ªåŠ¨åŒ–è¿½ç•ªé…ç½®ï¼Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œæ¢ç´¢ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€åˆ†äº«ã€‚</p>
<p>è¿‘ä¸¤å¹´æ¥ï¼Œåœ¨å®¶åŠå…¬è¶Šæ¥è¶Šèå…¥åˆ°æˆ‘ä»¬çš„ç”Ÿæ´»ï¼Œå®¶åº­ç½‘ç»œå’ŒæœåŠ¡çš„æ­å»ºä¹Ÿé€æ¸ä»ä»¥å¾€å¯¹ Geek çš„åˆ»æ¿å°è±¡ï¼Œå˜æˆæˆ–è®¸æ²¡è¢«æ„è¯†åˆ°ï¼Œä½†äººäººéƒ½æœ‰çš„éœ€æ±‚ã€‚ç…§ç‰‡å­˜å‚¨ã€æ•°æ®å¤‡ä»½ã€è¿œç¨‹æ§åˆ¶ã€ç¯å¢ƒç›‘æ§ã€æ™ºèƒ½å®¶å±…ã€å¤šåª’ä½“å¨±ä¹â€¦è¿™äº›æ— ä¸€ä¸æ˜¯æˆ‘ä»¬çš„æ—¥å¸¸æ‰€éœ€ã€‚å¾€åæˆ‘ä¼šå†™æ›´å¤šè¿™æ–¹é¢çš„æ–‡ç« ï¼Œå°†æˆ‘ä½¿ç”¨ NAS æ”¹å˜ç”Ÿæ´»æ–¹å¼çš„è¿‡ç¨‹è®°å½•ä¸‹æ¥ã€‚The digital life has just begun.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://wiki.servarr.com/">WikiArr</a></li>
<li><a href="https://trash-guides.info/">TRaSH Guides</a></li>
</ul>
<h2 id="revision">Revision</h2>
<ul>
<li>2022-04-19: created with &ldquo;ä½¿ç”¨ QNAP Download Station&rdquo;</li>
<li>2022-05-02: added &ldquo;ä½¿ç”¨ Sonarr å’Œå®ƒçš„æœ‹å‹ä»¬&rdquo;, finished &ldquo;éƒ¨ç½²è¯´æ˜&rdquo;</li>
<li>2022-05-04: finished &ldquo;ä½¿ç”¨è¯´æ˜&rdquo; and the whole article</li>
</ul>
]]></content:encoded></item><item><title>Switch open files quickly in Obsidian</title><link>https://reorx.com/blog/obsidian-switching-open-files-quickly/</link><pubDate>Thu, 21 Apr 2022 00:00:00 +0000</pubDate><guid>https://reorx.com/blog/obsidian-switching-open-files-quickly/</guid><description>Imagine a quick switcher with open files at the top.</description><content:encoded><![CDATA[<h2 id="the-problem">The problem</h2>
<p>since I use the â€œSliding Panesâ€ plugin, thereâ€™s always a bunch of files open in my Obsidian. Sometimes I switch to Obsidian with a very clear goal of opening a specific file, so I press Command+O and type in the file name to find it. Because I donâ€™t want to check whether the file is open or not (rather say thereâ€™s no way to check open files quickly), I always press Command+Enter to open the file in a new pane. As this process repeats, some files will have redundant panes, the panes are bloated and the workspace ends up being a mess.</p>
<p><a href="https://github.com/darlal/obsidian-switcher-plus">Quick Switcher++</a>Â is a very helpful tool, it allows me to search for open editors by typing a special prefix (<code>edt</code>Â by default) in the quick switcher. But after using it a while, I still feel itâ€™s not very intuitive, I want the â€œsearch any file and open itâ€ action and â€œsearch for existing open file and activate itâ€ to be combined into one thing to use.</p>
<h2 id="the-solution">The solution</h2>
<p>I forked Quicker Switcher ++ and added a new setting item called â€œInclude open filesâ€. When itâ€™s enabled, the switcher modal shows all the open files at the top with a different color style. If the open file is chosen, make that pane active; Other suggestions behave the same as the original, opening the file in the active pane.</p>
<figure>
<video class="video-shortcode" preload="" controls>
  <source src="https://i.imgur.com/bGLcQKl.mp4" type="">
  There should have been a video here but your browser does not seem
  to support it.
</video>
</figure>

<p>Iâ€™ll test this new feature in my workflow for a while to see if itâ€™s actually useful. Meanwhile, Iâ€™d love to hear from the Obsidian community. What do you think about it? Do you have a better idea for my problem? Feel free to leave a message to me.</p>
]]></content:encoded></item><item><title>A look into Heptabase's split writing experience</title><link>https://reorx.com/blog/heptabase-split-writing/</link><pubDate>Tue, 19 Apr 2022 00:00:00 +0000</pubDate><guid>https://reorx.com/blog/heptabase-split-writing/</guid><description>The amazing UX Heptabase creates to help reading, thinking, and writing with heavy context efficiently</description><content:encoded><![CDATA[<p>Yesterday I found Heptabase&rsquo;s new introduction video: <a href="https://www.youtube.com/watch?v=oVXQx9sz_Wk">The 3-step knowledge workflow in Heptabase</a>.</p>
<p>Heptabase is the most promising note-taking app for me in recent years. The idea of combining bi-directional links, cards, and whiteboards together is mind-blowing. The word note-taking or knowledge base is not accurate to define it, in fact, it&rsquo;s more like a tool that aims for boosting the process of thinking.</p>
<p>Traditional note-taking tools are keen on providing more than enough ways for dumping your thoughts into notes, but lack methodologies on how to retrieve and use notes. The way Heptabase organizes and interacts with the data is what really empowers the user to think and write more efficiently.</p>
<p>Back to the video at the beginning, after watching it I noticed a very interesting feature. I can&rsquo;t stop thinking of it and really wish to have something similar in other note-taking or PMK tools like Obsidian (yeah, I&rsquo;m an Obsidian fan).</p>
<h2 id="the-feature">The feature</h2>
<p>Here&rsquo;s the walk though of that amazing feature:</p>
<ul>
<li>On a whiteboard, select several cards you would like to refer to </li>
<li>Right-click on them and choose &ldquo;Open in new tab&rdquo;, a new page with a left-right split layout appears. The first card selected shows on the left; others show on the right as a folded list. </li>
<li>Click on the <code>+</code> sign button on the top menu bar; a new card is created on the left side, and the card that previously shows on the left is automatically moved to the card list on the right.  </li>
<li>You can fold/unfold notes while browsing the right side, and drag&rsquo;n drop blocks to copy them to the left side. </li>
</ul>
<p>This is the best way I&rsquo;ve ever seen to think and write a note while referring to many other notes. In other note-taking tools, take Obsidian for example, I can split the panes, but it is not convenient to organize the workspace well for more than 3 notes. As new panes are growing, it will become more and more interruptive to switch back and forth.</p>
<p>Even if I managed to build up a tidy workspace, it&rsquo;s still very frustrating to switch to another context. Obsidian has the functionality to manage workspaces, but you have to manually save before switching, otherwise, the context will be missing. In Heptabase, all the workspaces are clearly shown in the sidebar, switching around is fast and easy as a breath.</p>
<h2 id="conclusion">Conclusion</h2>
<p>It&rsquo;s a shock to me how easy and intuitive it could be in Heptabase to create a workspace and focus on writing. I believe anybody with note-taking experience could learn something from Heptabase&rsquo;s design.</p>
<p>Obsidian is still the best PKM tool for me. I&rsquo;m going to create a plugin to achieve a similar workflow in Obsidian, possibly by creating a special pane that can add and show notes in an accordion. Stay tuned for the updates.</p>
]]></content:encoded></item></channel></rss>